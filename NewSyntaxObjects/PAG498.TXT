OBJECT Page 498 Reservation
{
  OBJECT-PROPERTIES
  {
    Date=20171006D;
    Time=120000T;
    Version List=NAVW111.0;
  }
  PROPERTIES
  {
    CaptionML=ENU=Reservation;
    DeleteAllowed=false;
    SourceTable="Entry Summary";
    DataCaptionExpr=CaptionText;
    PageType=Worksheet;
    SourceTableTemporary=true;
    OnOpenPage=BEGIN
                 FormIsOpen := true;
               END;

    ActionList=ACTIONS
    {
      { 1900000003;0 ;ActionContainer;
                      Name=ActionContainer1900000003;
                      ActionContainerType=RelatedInformation }
      { 29      ;1   ;ActionGroup;
                      Name=&Line;
                      CaptionML=ENU=&Line;
                      Image=Line }
      { 30      ;2   ;Action    ;
                      Name=AvailableToReserve;
                      ShortCutKey=Ctrl+F7;
                      CaptionML=ENU=&Available to Reserve;
                      ToolTipML=ENU="View all the quantities on documents or in inventory that are available to reserve for the item on the line. The two actions, Auto Reserve and Reverse from Current Line make reservation from the quantities in this view. ";
                      ApplicationArea=#Advanced;
                      Promoted=true;
                      PromotedIsBig=true;
                      Image=ItemReservation;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 DrillDownTotalQuantity;
                               END;
                                }
      { 34      ;2   ;Action    ;
                      Name=&Reservation Entries;
                      AccessByPermission=TableData Item=R;
                      CaptionML=ENU=&Reservation Entries;
                      ToolTipML=ENU=View all reservations that are made for the item, either manually or automatically.;
                      ApplicationArea=#Advanced;
                      Promoted=true;
                      PromotedIsBig=true;
                      Image=ReservationLedger;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 DrillDownReservedThisLine;
                               END;
                                }
      { 1900000004;0 ;ActionContainer;
                      Name=ActionContainer1900000004;
                      ActionContainerType=ActionItems }
      { 35      ;1   ;ActionGroup;
                      Name=F&unctions;
                      CaptionML=ENU=F&unctions;
                      Image=Action }
      { 36      ;2   ;Action    ;
                      Name=Auto Reserve;
                      CaptionML=ENU=&Auto Reserve;
                      ToolTipML=ENU="Automatically reserve the first available quantity for the item on the line. ";
                      ApplicationArea=#Advanced;
                      Promoted=true;
                      PromotedIsBig=true;
                      Image=AutoReserve;
                      PromotedCategory=Process;
                      OnAction=BEGIN
                                 AutoReserve;
                               END;
                                }
      { 37      ;2   ;Action    ;
                      Name=Reserve from Current Line;
                      CaptionML=ENU=&Reserve from Current Line;
                      ToolTipML=ENU=Open the view of quantities available to reserve and select which to reserve.;
                      ApplicationArea=#Advanced;
                      Promoted=true;
                      PromotedIsBig=true;
                      Image=LineReserve;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 RemainingQtyToReserveBase@1000 : Decimal;
                                 QtyReservedBefore@1001 : Decimal;
                                 RemainingQtyToReserve@1002 : Decimal;
                               BEGIN
                                 RemainingQtyToReserveBase := QtyToReserveBase - QtyReservedBase;
                                 if RemainingQtyToReserveBase = 0 then
                                   ERROR(Text000);
                                 QtyReservedBefore := QtyReservedBase;
                                 if HandleItemTracking then
                                   ReservMgt.SetItemTrackingHandling(2);
                                 RemainingQtyToReserve := QtyToReserve - QtyReserved;
                                 ReservMgt.AutoReserveOneLine(
                                   "Entry No.",RemainingQtyToReserve,RemainingQtyToReserveBase,ReservEntry.Description,
                                   ReservEntry."Shipment Date");
                                 UpdateReservFrom;
                                 if QtyReservedBefore = QtyReservedBase then
                                   ERROR(Text002);
                               END;
                                }
      { 43      ;2   ;Action    ;
                      Name=CancelReservationCurrentLine;
                      AccessByPermission=TableData Item=R;
                      CaptionML=ENU=&Cancel Reservation from Current Line;
                      ToolTipML=ENU=Cancel the selected reservation entry.;
                      ApplicationArea=#Advanced;
                      Promoted=true;
                      PromotedIsBig=true;
                      Image=Cancel;
                      PromotedCategory=Process;
                      OnAction=VAR
                                 ReservEntry3@1001 : Record "Reservation Entry";
                                 RecordsFound@1002 : Boolean;
                               BEGIN
                                 if not CONFIRM(Text003,false,"Summary Type") then
                                   exit;
                                 CLEAR(ReservEntry2);
                                 ReservEntry2 := ReservEntry;
                                 ReservEntry2.SetPointerFilter;
                                 ReservEntry2.SETRANGE("Reservation Status",ReservEntry2."Reservation Status"::Reservation);
                                 ReservEntry2.SETRANGE("Disallow Cancellation",false);
                                 if ReservEntry2.FINDSET then
                                   repeat
                                     ReservEntry3.GET(ReservEntry2."Entry No.",not ReservEntry2.Positive);
                                     if RelatesToSummEntry(ReservEntry3,Rec) then begin
                                       ReservEngineMgt.CancelReservation(ReservEntry2);
                                       RecordsFound := true;
                                     end;
                                   until ReservEntry2.NEXT = 0;

                                 if RecordsFound then
                                   UpdateReservFrom
                                 else
                                   ERROR(Text005);
                               END;
                                }
    }
  }
  CONTROLS
  {
    { 1900000001;0;Container;
                Name=Container1900000001;
                ContainerType=ContentArea }

    { 13  ;1   ;Group     ;
                Name=General;
                CaptionML=ENU=General }

    { 9   ;2   ;Field     ;
                Name=ItemNo;
                CaptionML=ENU=Item No.;
                ToolTipML=ENU=Specifies the item number of the item that the reservation is for.;
                ApplicationArea=#Advanced;
                SourceExpr=ReservEntry."Item No.";
                Editable=FALSE }

    { 41  ;2   ;Field     ;
                Name=Shipment Date;
                CaptionML=ENU=Shipment Date;
                ToolTipML=ENU=Specifies the shipment date, expected receipt date, or posting date for the reservation.;
                ApplicationArea=#Advanced;
                SourceExpr=ReservEntry."Shipment Date";
                Editable=FALSE }

    { 7   ;2   ;Field     ;
                Name=Description;
                CaptionML=ENU=Description;
                ToolTipML=ENU=Specifies a description of the reservation in the window.;
                ApplicationArea=#Advanced;
                SourceExpr=ReservEntry.Description }

    { 25  ;2   ;Field     ;
                Name=QtyToReserveBase;
                CaptionML=ENU=Quantity to Reserve;
                ToolTipML=ENU=Specifies the total quantity of the item that must be reserved for the line.;
                ApplicationArea=#Advanced;
                DecimalPlaces=0:5;
                SourceExpr=QtyToReserveBase;
                Editable=FALSE;
                ImplicitType=Decimal }

    { 27  ;2   ;Field     ;
                Name=QtyReservedBase;
                CaptionML=ENU=Reserved Quantity;
                ToolTipML=ENU=Specifies the quantity of the item reserved for the line.;
                ApplicationArea=#Advanced;
                DecimalPlaces=0:5;
                SourceExpr=QtyReservedBase;
                Editable=FALSE;
                ImplicitType=Decimal }

    { 2   ;2   ;Field     ;
                Name=UnreservedQuantity;
                CaptionML=ENU=Unreserved Quantity;
                ToolTipML=ENU=Specifies the difference between the Quantity to Reserve field and the Reserved Quantity field.;
                ApplicationArea=#Advanced;
                DecimalPlaces=0:5;
                SourceExpr=QtyToReserveBase - QtyReservedBase;
                Editable=FALSE }

    { 1   ;1   ;Group     ;
                Name=Group1;
                Editable=FALSE;
                GroupType=Repeater }

    { 22  ;2   ;Field     ;
                Name=Summary Type;
                ToolTipML=ENU=Specifies which type of line or entry is summarized in the entry summary.;
                ApplicationArea=#Advanced;
                SourceExpr="Summary Type";
                Editable=FALSE;
                ImplicitType=Text80 }

    { 14  ;2   ;Field     ;
                Name=Total Quantity;
                CaptionML=ENU=Total Quantity;
                ToolTipML=ENU=Specifies the total quantity of the item in inventory.;
                ApplicationArea=#Advanced;
                DecimalPlaces=0:5;
                BlankZero=true;
                SourceExpr=ReservMgt.FormatQty("Total Quantity");
                Editable=FALSE;
                OnDrillDown=BEGIN
                              DrillDownTotalQuantity;
                            END;
                             }

    { 16  ;2   ;Field     ;
                Name=TotalReservedQuantity;
                CaptionML=ENU=Total Reserved Quantity;
                ToolTipML=ENU=Specifies the total quantity of the item that is reserved on documents or entries.;
                ApplicationArea=#Advanced;
                DecimalPlaces=0:5;
                BlankZero=true;
                SourceExpr=ReservMgt.FormatQty("Total Reserved Quantity");
                Editable=FALSE;
                OnDrillDown=BEGIN
                              DrillDownReservedQuantity;
                            END;
                             }

    { 8   ;2   ;Field     ;
                Name=QtyAllocatedInWarehouse;
                CaptionML=ENU=Qty. Allocated in Warehouse;
                ToolTipML=ENU=Specifies the quantity of the item that is allocated to activities in the warehouse.;
                ApplicationArea=#Warehouse;
                DecimalPlaces=0:5;
                BlankZero=true;
                SourceExpr=ReservMgt.FormatQty("Qty. Alloc. in Warehouse");
                Editable=FALSE }

    { 3   ;2   ;Field     ;
                Name=Reserved Qty. on Picks and Shipments;
                CaptionML=ENU=Reserved Qty. on Picks and Shipments;
                ToolTipML=ENU=Specifies the sum of the overlap quantities.;
                ApplicationArea=#Warehouse;
                DecimalPlaces=0:5;
                BlankZero=true;
                SourceExpr=ReservMgt.FormatQty("Res. Qty. on Picks & Shipmts.");
                Visible=FALSE;
                Editable=FALSE }

    { 18  ;2   ;Field     ;
                Name=TotalAvailableQuantity;
                CaptionML=ENU=Total Available Quantity;
                ToolTipML=ENU=Specifies the quantity that is available for the user to reserve from entries of the type.;
                ApplicationArea=#Advanced;
                DecimalPlaces=0:5;
                BlankZero=true;
                SourceExpr=ReservMgt.FormatQty("Total Available Quantity");
                Editable=FALSE }

    { 4   ;2   ;Field     ;
                Name=Non-specific Reserved Qty.;
                ToolTipML=ENU=Specifies the quantity of the item that is reserved but does not have specific item tracking numbers in the reservation.;
                ApplicationArea=#Advanced;
                DecimalPlaces=0:5;
                SourceExpr="Non-specific Reserved Qty.";
                Visible=FALSE;
                ImplicitType=Decimal }

    { 20  ;2   ;Field     ;
                Name=Current Reserved Quantity;
                CaptionML=ENU=Current Reserved Quantity;
                ToolTipML=ENU=Specifies how many items in the entry are reserved for the line opened in the Reservation window.;
                ApplicationArea=#Advanced;
                DecimalPlaces=0:5;
                BlankZero=true;
                SourceExpr=ReservMgt.FormatQty(ReservedThisLine(Rec));
                OnDrillDown=BEGIN
                              DrillDownReservedThisLine;
                            END;
                             }

    { 38  ;1   ;Field     ;
                Name=NoteText;
                ApplicationArea=#Advanced;
                CaptionClass=FORMAT(STRSUBSTNO(Text009,NonSpecificQty,FIELDCAPTION("Total Reserved Quantity")));
                Visible=NoteTextVisible;
                Editable=FALSE;
                MultiLine=true }

    { 1907524401;1;Group  ;
                Name=Filters;
                CaptionML=ENU=Filters }

    { 46  ;2   ;Field     ;
                Name=Variant Code;
                CaptionML=ENU=Variant Code;
                ToolTipML=ENU=Specifies the variant code for the reservation.;
                ApplicationArea=#Advanced;
                SourceExpr=ReservEntry."Variant Code";
                Editable=FALSE }

    { 31  ;2   ;Field     ;
                Name=Location Code;
                CaptionML=ENU=Location Code;
                ToolTipML=ENU=Specifies the location code for the reservation.;
                ApplicationArea=#Advanced;
                SourceExpr=ReservEntry."Location Code";
                Editable=FALSE }

    { 50  ;2   ;Field     ;
                Name=Serial No.;
                CaptionML=ENU=Serial No.;
                ToolTipML=ENU=Specifies the serial number for an item in the reservation.;
                ApplicationArea=#ItemTracking;
                SourceExpr=ReservEntry."Serial No.";
                Editable=FALSE }

    { 44  ;2   ;Field     ;
                Name=Lot No.;
                CaptionML=ENU=Lot No.;
                ToolTipML=ENU=Specifies the lot number for the reservation.;
                ApplicationArea=#ItemTracking;
                SourceExpr=ReservEntry."Lot No.";
                Editable=FALSE }

  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=Fully reserved.';
      Text001@1001 : TextConst 'ENU=Full automatic Reservation is not possible.\Reserve manually.';
      Text002@1002 : TextConst 'ENU=There is nothing available to reserve.';
      Text003@1003 : TextConst 'ENU=Do you want to cancel all reservations in the %1?';
      Text005@1004 : TextConst 'ENU=There are no reservations to cancel.';
      ReservEntry@1005 : Record "Reservation Entry";
      ReservEntry2@1006 : Record "Reservation Entry";
      SalesLine@1007 : Record "Sales Line";
      PurchLine@1008 : Record "Purchase Line";
      ItemJnlLine@1009 : Record "Item Journal Line";
      ReqLine@1010 : Record "Requisition Line";
      ProdOrderLine@1011 : Record "Prod. Order Line";
      ProdOrderComp@1012 : Record "Prod. Order Component";
      AssemblyHeader@1052 : Record "Assembly Header";
      AssemblyLine@1039 : Record "Assembly Line";
      PlanningComponent@1013 : Record "Planning Component";
      ServiceLine@1014 : Record "Service Line";
      TransLine@1015 : Record "Transfer Line";
      JobPlanningLine@1016 : Record "Job Planning Line";
      ReservMgt@1027 : Codeunit "Reservation Management";
      ReservEngineMgt@1028 : Codeunit "Reservation Engine Mgt.";
      ReserveSalesLine@1029 : Codeunit "Sales Line-Reserve";
      ReserveReqLine@1030 : Codeunit "Req. Line-Reserve";
      ReservePurchLine@1031 : Codeunit "Purch. Line-Reserve";
      ReserveItemJnlLine@1032 : Codeunit "Item Jnl. Line-Reserve";
      ReserveProdOrderLine@1033 : Codeunit "Prod. Order Line-Reserve";
      ReserveProdOrderComp@1034 : Codeunit "Prod. Order Comp.-Reserve";
      AssemblyHeaderReserve@1060 : Codeunit "Assembly Header-Reserve";
      AssemblyLineReserve@1055 : Codeunit "Assembly Line-Reserve";
      ReservePlanningComponent@1035 : Codeunit "Plng. Component-Reserve";
      ReserveServiceLine@1036 : Codeunit "Service Line-Reserve";
      ReserveTransLine@1037 : Codeunit "Transfer Line-Reserve";
      JobPlanningLineReserve@1058 : Codeunit "Job Planning Line-Reserve";
      CreateReservEntry@1038 : Codeunit "Create Reserv. Entry";
      AvailableSalesLines@1073 : Page "Available - Sales Lines";
      AvailablePurchLines@1072 : Page "Available - Purchase Lines";
      AvailableItemLedgEntries@1071 : Page "Available - Item Ledg. Entries";
      AvailableReqLines@1070 : Page "Available - Requisition Lines";
      AvailableProdOrderLines@1069 : Page "Available - Prod. Order Lines";
      AvailableProdOrderComps@1068 : Page "Available - Prod. Order Comp.";
      AvailablePlanningComponents@1067 : Page "Avail. - Planning Components";
      AvailableServiceLines@1066 : Page "Available - Service Lines";
      AvailableTransLines@1065 : Page "Available - Transfer Lines";
      AvailableItemTrackingLines@1064 : Page "Avail. - Item Tracking Lines";
      AvailableJobPlanningLines@1063 : Page "Available - Job Planning Lines";
      AvailableAssemblyHeaders@1046 : Page "Available - Assembly Headers";
      AvailableAssemblyLines@1019 : Page "Available - Assembly Lines";
      QtyToReserve@1017 : Decimal;
      QtyToReserveBase@1040 : Decimal;
      QtyReserved@1018 : Decimal;
      QtyReservedBase@1041 : Decimal;
      ItemTrackingQtyToReserve@1023 : Decimal;
      ItemTrackingQtyToReserveBase@1022 : Decimal;
      NonSpecificQty@1057 : Decimal;
      CaptionText@1044 : Text;
      FullAutoReservation@1045 : Boolean;
      FormIsOpen@1047 : Boolean;
      HandleItemTracking@1048 : Boolean;
      Text006@1050 : TextConst 'ENU=Do you want to reserve specific serial or lot numbers?';
      Text007@1051 : TextConst '@@@="%1 = Serial No.; %2 = Lot No.";ENU=, %1 %2';
      Text008@1054 : TextConst 'ENU=Action canceled.';
      Text009@1056 : TextConst 'ENU=%1 of the %2 are nonspecific and may be available.';
      NoteTextVisible@1126 : Boolean INDATASET;

    [External]
    PROCEDURE SetSalesLine@1(VAR CurrentSalesLine@1000 : Record "Sales Line");
    BEGIN
      CurrentSalesLine.TESTFIELD("Job No.",'');
      CurrentSalesLine.TESTFIELD("Drop Shipment",false);
      CurrentSalesLine.TESTFIELD(Type,CurrentSalesLine.Type::Item);
      CurrentSalesLine.TESTFIELD("Shipment Date");

      SalesLine := CurrentSalesLine;
      ReservEntry.SetSource(
        DATABASE::"Sales Line",SalesLine."Document Type",SalesLine."Document No.",SalesLine."Line No.",'',0);
      ReservEntry."Item No." := SalesLine."No.";
      ReservEntry."Variant Code" := SalesLine."Variant Code";
      ReservEntry."Location Code" := SalesLine."Location Code";
      ReservEntry."Shipment Date" := SalesLine."Shipment Date";

      CaptionText := ReserveSalesLine.Caption(SalesLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetReqLine@2(VAR CurrentReqLine@1000 : Record "Requisition Line");
    BEGIN
      CurrentReqLine.TESTFIELD("Sales Order No.",'');
      CurrentReqLine.TESTFIELD("Sales Order Line No.",0);
      CurrentReqLine.TESTFIELD("Sell-to Customer No.",'');
      CurrentReqLine.TESTFIELD(Type,CurrentReqLine.Type::Item);
      CurrentReqLine.TESTFIELD("Due Date");

      ReqLine := CurrentReqLine;
      ReservEntry.SetSource(
        DATABASE::"Requisition Line",0,ReqLine."Worksheet Template Name",ReqLine."Line No.",ReqLine."Journal Batch Name",0);
      ReservEntry."Item No." := ReqLine."No.";
      ReservEntry."Variant Code" := ReqLine."Variant Code";
      ReservEntry."Location Code" := ReqLine."Location Code";
      ReservEntry."Shipment Date" := ReqLine."Due Date";

      CaptionText := ReserveReqLine.Caption(ReqLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetPurchLine@3(VAR CurrentPurchLine@1000 : Record "Purchase Line");
    BEGIN
      CurrentPurchLine.TESTFIELD("Job No.",'');
      CurrentPurchLine.TESTFIELD("Drop Shipment",false);
      CurrentPurchLine.TESTFIELD(Type,CurrentPurchLine.Type::Item);
      CurrentPurchLine.TESTFIELD("Expected Receipt Date");

      PurchLine := CurrentPurchLine;
      ReservEntry.SetSource(
        DATABASE::"Purchase Line",PurchLine."Document Type",PurchLine."Document No.",PurchLine."Line No.",'',0);
      ReservEntry."Item No." := PurchLine."No.";
      ReservEntry."Variant Code" := PurchLine."Variant Code";
      ReservEntry."Location Code" := PurchLine."Location Code";
      ReservEntry."Shipment Date" := PurchLine."Expected Receipt Date";

      CaptionText := ReservePurchLine.Caption(PurchLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetItemJnlLine@4(VAR CurrentItemJnlLine@1000 : Record "Item Journal Line");
    BEGIN
      CurrentItemJnlLine.TESTFIELD("Drop Shipment",false);
      CurrentItemJnlLine.TESTFIELD("Posting Date");

      ItemJnlLine := CurrentItemJnlLine;
      ReservEntry.SetSource(
        DATABASE::"Item Journal Line",ItemJnlLine."Entry Type",ItemJnlLine."Journal Template Name",ItemJnlLine."Line No.",
        ItemJnlLine."Journal Batch Name",0);
      ReservEntry."Item No." := ItemJnlLine."Item No.";
      ReservEntry."Variant Code" := ItemJnlLine."Variant Code";
      ReservEntry."Location Code" := ItemJnlLine."Location Code";
      ReservEntry."Shipment Date" := ItemJnlLine."Posting Date";

      CaptionText := ReserveItemJnlLine.Caption(ItemJnlLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetProdOrderLine@9(VAR CurrentProdOrderLine@1000 : Record "Prod. Order Line");
    BEGIN
      CurrentProdOrderLine.TESTFIELD("Due Date");

      ProdOrderLine := CurrentProdOrderLine;
      ReservEntry.SetSource(
        DATABASE::"Prod. Order Line",ProdOrderLine.Status,ProdOrderLine."Prod. Order No.",0,'',ProdOrderLine."Line No.");
      ReservEntry."Item No." := ProdOrderLine."Item No.";
      ReservEntry."Variant Code" := ProdOrderLine."Variant Code";
      ReservEntry."Location Code" := ProdOrderLine."Location Code";
      ReservEntry."Shipment Date" := ProdOrderLine."Due Date";

      CaptionText := ReserveProdOrderLine.Caption(ProdOrderLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetProdOrderComponent@13(VAR CurrentProdOrderComp@1000 : Record "Prod. Order Component");
    BEGIN
      CurrentProdOrderComp.TESTFIELD("Due Date");

      ProdOrderComp := CurrentProdOrderComp;
      ReservEntry.SetSource(
        DATABASE::"Prod. Order Component",ProdOrderComp.Status,ProdOrderComp."Prod. Order No.",ProdOrderComp."Line No.",
        '',ProdOrderComp."Prod. Order Line No.");
      ReservEntry."Item No." := ProdOrderComp."Item No.";
      ReservEntry."Variant Code" := ProdOrderComp."Variant Code";
      ReservEntry."Location Code" := ProdOrderComp."Location Code";
      ReservEntry."Shipment Date" := ProdOrderComp."Due Date";

      CaptionText := ReserveProdOrderComp.Caption(ProdOrderComp);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetAssemblyHeader@23(VAR CurrentAssemblyHeader@1000 : Record "Assembly Header");
    BEGIN
      CurrentAssemblyHeader.TESTFIELD("Due Date");

      AssemblyHeader := CurrentAssemblyHeader;
      ReservEntry.SetSource(DATABASE::"Assembly Header",AssemblyHeader."Document Type",AssemblyHeader."No.",0,'',0);
      ReservEntry."Item No." := AssemblyHeader."Item No.";
      ReservEntry."Variant Code" := AssemblyHeader."Variant Code";
      ReservEntry."Location Code" := AssemblyHeader."Location Code";
      ReservEntry."Shipment Date" := AssemblyHeader."Due Date";

      CaptionText := AssemblyHeaderReserve.Caption(AssemblyHeader);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetAssemblyLine@22(VAR CurrentAssemblyLine@1000 : Record "Assembly Line");
    BEGIN
      CurrentAssemblyLine.TESTFIELD(Type,CurrentAssemblyLine.Type::Item);
      CurrentAssemblyLine.TESTFIELD("Due Date");

      AssemblyLine := CurrentAssemblyLine;
      ReservEntry.SetSource(
        DATABASE::"Assembly Line",AssemblyLine."Document Type",AssemblyLine."Document No.",AssemblyLine."Line No.",'',0);
      ReservEntry."Item No." := AssemblyLine."No.";
      ReservEntry."Variant Code" := AssemblyLine."Variant Code";
      ReservEntry."Location Code" := AssemblyLine."Location Code";
      ReservEntry."Shipment Date" := AssemblyLine."Due Date";

      CaptionText := AssemblyLineReserve.Caption(AssemblyLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetPlanningComponent@18(VAR CurrentPlanningComponent@1000 : Record "Planning Component");
    BEGIN
      CurrentPlanningComponent.TESTFIELD("Due Date");

      PlanningComponent := CurrentPlanningComponent;
      ReservEntry.SetSource(
        DATABASE::"Planning Component",0,PlanningComponent."Worksheet Template Name",PlanningComponent."Line No.",
        PlanningComponent."Worksheet Batch Name",PlanningComponent."Worksheet Line No.");
      ReservEntry."Item No." := PlanningComponent."Item No.";
      ReservEntry."Variant Code" := PlanningComponent."Variant Code";
      ReservEntry."Location Code" := PlanningComponent."Location Code";
      ReservEntry."Shipment Date" := PlanningComponent."Due Date";

      CaptionText := ReservePlanningComponent.Caption(PlanningComponent);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetTransLine@47(CurrentTransLine@1000 : Record "Transfer Line";Direction@1001 : 'Outbound,Inbound');
    BEGIN
      CLEARALL;

      TransLine := CurrentTransLine;
      ReservEntry.SetSource(
        DATABASE::"Transfer Line",Direction,CurrentTransLine."Document No.",CurrentTransLine."Line No.",
        '',CurrentTransLine."Derived From Line No.");
      ReservEntry."Item No." := CurrentTransLine."Item No.";
      ReservEntry."Variant Code" := CurrentTransLine."Variant Code";
      case Direction of
        Direction::Outbound:
          begin
            ReservEntry."Location Code" := CurrentTransLine."Transfer-from Code";
            ReservEntry."Shipment Date" := CurrentTransLine."Shipment Date";
          end;
        Direction::Inbound:
          begin
            ReservEntry."Location Code" := CurrentTransLine."Transfer-to Code";
            ReservEntry."Shipment Date" := CurrentTransLine."Receipt Date";
          end;
      end;

      ReservEntry."Qty. per Unit of Measure" := CurrentTransLine."Qty. per Unit of Measure";

      CaptionText := ReserveTransLine.Caption(TransLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetServiceLine@15(VAR CurrentServiceLine@1000 : Record "Service Line");
    BEGIN
      CurrentServiceLine.TESTFIELD(Type,CurrentServiceLine.Type::Item);
      CurrentServiceLine.TESTFIELD("Needed by Date");

      ServiceLine := CurrentServiceLine;
      ReservEntry.SetSource(
        DATABASE::"Service Line",ServiceLine."Document Type",ServiceLine."Document No.",ServiceLine."Line No.",'',0);
      ReservEntry."Item No." := ServiceLine."No.";
      ReservEntry."Variant Code" := ServiceLine."Variant Code";
      ReservEntry."Location Code" := ServiceLine."Location Code";
      ReservEntry."Shipment Date" := ServiceLine."Needed by Date";

      CaptionText := ReserveServiceLine.Caption(ServiceLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetJobPlanningLine@20(VAR CurrentJobPlanningLine@1000 : Record "Job Planning Line");
    BEGIN
      CurrentJobPlanningLine.TESTFIELD(Type,CurrentJobPlanningLine.Type::Item);
      CurrentJobPlanningLine.TESTFIELD("Planning Date");

      JobPlanningLine := CurrentJobPlanningLine;
      ReservEntry.SetSource(
        DATABASE::"Job Planning Line",JobPlanningLine.Status,JobPlanningLine."Job No.",
        JobPlanningLine."Job Contract Entry No.",'',0);
      ReservEntry."Item No." := JobPlanningLine."No.";
      ReservEntry."Variant Code" := JobPlanningLine."Variant Code";
      ReservEntry."Location Code" := JobPlanningLine."Location Code";
      ReservEntry."Shipment Date" := JobPlanningLine."Planning Date";

      CaptionText := JobPlanningLineReserve.Caption(JobPlanningLine);
      UpdateReservFrom;
    END;

    [External]
    PROCEDURE SetReservEntry@16(ReservEntry2@1000 : Record "Reservation Entry");
    BEGIN
      ReservEntry := ReservEntry2;
      UpdateReservMgt;
    END;

    LOCAL PROCEDURE FilterReservEntry@11(VAR FilterReservEntry@1000 : Record "Reservation Entry";FromReservSummEntry@1001 : Record "Entry Summary");
    BEGIN
      FilterReservEntry.SETRANGE("Item No.",ReservEntry."Item No.");

      case FromReservSummEntry."Entry No." of
        1:
          begin // Item Ledger Entry
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Item Ledger Entry");
            FilterReservEntry.SETRANGE("Source Subtype",0);
            FilterReservEntry.SETRANGE("Expected Receipt Date");
          end;
        11,12,13,14,15,16:
          begin // Purchase Line
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Purchase Line");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 11);
          end;
        21:
          begin // Requisition Line
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Requisition Line");
            FilterReservEntry.SETRANGE("Source Subtype",0);
          end;
        31,32,33,34,35,36:
          begin // Sales Line
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Sales Line");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 31);
          end;
        41,42,43,44,45:
          begin // Item Journal Line
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Item Journal Line");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 41);
          end;
        61,62,63,64:
          begin // prod. order
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Prod. Order Line");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 61);
          end;
        71,72,73,74:
          begin // prod. order
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Prod. Order Component");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 71);
          end;
        91:
          begin // Planning Component
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Planning Component");
            FilterReservEntry.SETRANGE("Source Subtype",0);
          end;
        101,102:
          begin // Transfer Line
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Transfer Line");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 101);
          end;
        110:
          begin // Service Line
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Service Line");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 109);
          end;
        131,132,133,134:
          begin // Job Planning Line
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Job Planning Line");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 131);
          end;
        141,142,143,144,145:
          begin // Assembly Header
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Assembly Header");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 141);
          end;
        151,152,153,154,155:
          begin // Assembly Line
            FilterReservEntry.SETRANGE("Source Type",DATABASE::"Assembly Line");
            FilterReservEntry.SETRANGE("Source Subtype",FromReservSummEntry."Entry No." - 151);
          end;
      end;

      FilterReservEntry.SETRANGE(
        "Reservation Status",FilterReservEntry."Reservation Status"::Reservation);
      FilterReservEntry.SETRANGE("Location Code",ReservEntry."Location Code");
      FilterReservEntry.SETRANGE("Variant Code",ReservEntry."Variant Code");
      if ReservEntry.TrackingExists then begin
        FilterReservEntry.SETRANGE("Serial No.",ReservEntry."Serial No.");
        FilterReservEntry.SETRANGE("Lot No.",ReservEntry."Lot No.");
      end;
      FilterReservEntry.SETRANGE(Positive,ReservMgt.IsPositive);
    END;

    LOCAL PROCEDURE RelatesToSummEntry@5(VAR FilterReservEntry@1000 : Record "Reservation Entry";FromReservSummEntry@1001 : Record "Entry Summary") : Boolean;
    BEGIN
      case FromReservSummEntry."Entry No." of
        1: // Item Ledger Entry
          exit((FilterReservEntry."Source Type" = DATABASE::"Item Ledger Entry") and
            (FilterReservEntry."Source Subtype" = 0));
        11,12,13,14,15,16: // Purchase Line
          exit((FilterReservEntry."Source Type" = DATABASE::"Purchase Line") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 11));
        21: // Requisition Line
          exit((FilterReservEntry."Source Type" = DATABASE::"Requisition Line") and
            (FilterReservEntry."Source Subtype" = 0));
        31,32,33,34,35,36: // Sales Line
          exit((FilterReservEntry."Source Type" = DATABASE::"Sales Line") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 31));
        41,42,43,44,45: // Item Journal Line
          exit((FilterReservEntry."Source Type" = DATABASE::"Item Journal Line") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 41));
        61,62,63,64: // Prod. Order
          exit((FilterReservEntry."Source Type" = DATABASE::"Prod. Order Line") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 61));
        71,72,73,74: // Prod. Order Component
          exit((FilterReservEntry."Source Type" = DATABASE::"Prod. Order Component") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 71));
        91: // Planning Component
          exit((FilterReservEntry."Source Type" = DATABASE::"Planning Component") and
            (FilterReservEntry."Source Subtype" = 0));
        101,102: // Transfer Line
          exit((FilterReservEntry."Source Type" = DATABASE::"Transfer Line") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 101));
        110: // Service Line
          exit((FilterReservEntry."Source Type" = DATABASE::"Service Line") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 109));
        131,132,133,134: // Job Planning Line
          exit((FilterReservEntry."Source Type" = DATABASE::"Job Planning Line") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 131));
        141,142,143,144,145: // Assembly Header
          exit((FilterReservEntry."Source Type" = DATABASE::"Assembly Header") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 141));
        151,152,153,154,155: // Assembly Line
          exit((FilterReservEntry."Source Type" = DATABASE::"Assembly Line") and
            (FilterReservEntry."Source Subtype" = FromReservSummEntry."Entry No." - 151));
      end;
    END;

    LOCAL PROCEDURE UpdateReservFrom@12();
    VAR
      EntrySummary@1000 : Record "Entry Summary";
      QtyPerUOM@1001 : Decimal;
      QtyReservedIT@1002 : Decimal;
    BEGIN
      if not FormIsOpen then
        GetSerialLotNo(ItemTrackingQtyToReserve,ItemTrackingQtyToReserveBase);

      QtyPerUOM := GetQtyPerUOMFromSource;

      UpdateReservMgt;
      ReservMgt.UpdateStatistics(
        Rec,ReservEntry."Shipment Date",HandleItemTracking);

      if HandleItemTracking then begin
        EntrySummary := Rec;
        QtyReservedBase := 0;
        if FINDSET then
          repeat
            QtyReservedBase += ReservedThisLine(Rec);
          until NEXT = 0;
        QtyReservedIT := ROUND(QtyReservedBase / QtyPerUOM,0.00001);
        if ABS(QtyReserved - QtyReservedIT) > 0.00001 then
          QtyReserved := QtyReservedIT;
        QtyToReserveBase := ItemTrackingQtyToReserveBase;
        if ABS(ItemTrackingQtyToReserve - QtyToReserve) > 0.00001 then
          QtyToReserve := ItemTrackingQtyToReserve;
        Rec := EntrySummary;
      end;

      UpdateNonSpecific; // Late Binding

      if FormIsOpen then
        CurrPage.UPDATE;
    END;

    LOCAL PROCEDURE UpdateReservMgt@7();
    BEGIN
      CLEAR(ReservMgt);
      case ReservEntry."Source Type" of
        DATABASE::"Sales Line":
          ReservMgt.SetSalesLine(SalesLine);
        DATABASE::"Requisition Line":
          ReservMgt.SetReqLine(ReqLine);
        DATABASE::"Purchase Line":
          ReservMgt.SetPurchLine(PurchLine);
        DATABASE::"Item Journal Line":
          ReservMgt.SetItemJnlLine(ItemJnlLine);
        DATABASE::"Prod. Order Line":
          ReservMgt.SetProdOrderLine(ProdOrderLine);
        DATABASE::"Prod. Order Component":
          ReservMgt.SetProdOrderComponent(ProdOrderComp);
        DATABASE::"Assembly Header":
          ReservMgt.SetAssemblyHeader(AssemblyHeader);
        DATABASE::"Assembly Line":
          ReservMgt.SetAssemblyLine(AssemblyLine);
        DATABASE::"Planning Component":
          ReservMgt.SetPlanningComponent(PlanningComponent);
        DATABASE::"Transfer Line":
          ReservMgt.SetTransferLine(TransLine,ReservEntry."Source Subtype");
        DATABASE::"Service Line":
          ReservMgt.SetServLine(ServiceLine);
        DATABASE::"Job Planning Line":
          ReservMgt.SetJobPlanningLine(JobPlanningLine);
      end;
      ReservMgt.SetSerialLotNo(ReservEntry."Serial No.",ReservEntry."Lot No.");
    END;

    LOCAL PROCEDURE DrillDownTotalQuantity@6();
    VAR
      Location@1002 : Record Location;
      CreatePick@1001 : Codeunit "Create Pick";
    BEGIN
      if HandleItemTracking and ("Entry No." <> 1) then begin
        CLEAR(AvailableItemTrackingLines);
        AvailableItemTrackingLines.SetItemTrackingLine("Table ID","Source Subtype",ReservEntry,
          ReservMgt.IsPositive,ReservEntry."Shipment Date");
        AvailableItemTrackingLines.RUNMODAL;
        exit;
      end;

      ReservEntry2 := ReservEntry;
      if not Location.GET(ReservEntry2."Location Code") then
        CLEAR(Location);
      case "Entry No." of
        1:
          begin // Item Ledger Entry
            CLEAR(AvailableItemLedgEntries);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableItemLedgEntries.SetSalesLine(SalesLine,ReservEntry2);
                  if Location."Bin Mandatory" or Location."Require Pick" then
                    AvailableItemLedgEntries.SetTotalAvailQty(
                      "Total Available Quantity" +
                      CreatePick.CheckOutBound(
                        ReservEntry2."Source Type",ReservEntry2."Source Subtype",
                        ReservEntry2."Source ID",ReservEntry2."Source Ref. No.",
                        ReservEntry2."Source Prod. Order Line"))
                  else
                    AvailableItemLedgEntries.SetTotalAvailQty("Total Available Quantity");
                  AvailableItemLedgEntries.SetMaxQtyToReserve(QtyToReserveBase - QtyReservedBase);
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableItemLedgEntries.SetReqLine(ReqLine,ReservEntry2);
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableItemLedgEntries.SetPurchLine(PurchLine,ReservEntry2);
                  if Location."Bin Mandatory" or Location."Require Pick" and
                     (PurchLine."Document Type" = PurchLine."Document Type"::"Return Order")
                  then
                    AvailableItemLedgEntries.SetTotalAvailQty(
                      "Total Available Quantity" +
                      CreatePick.CheckOutBound(
                        ReservEntry2."Source Type",ReservEntry2."Source Subtype",
                        ReservEntry2."Source ID",ReservEntry2."Source Ref. No.",
                        ReservEntry2."Source Prod. Order Line"))
                  else
                    AvailableItemLedgEntries.SetTotalAvailQty("Total Available Quantity");
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableItemLedgEntries.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableItemLedgEntries.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  if Location."Bin Mandatory" or Location."Require Pick" then
                    AvailableItemLedgEntries.SetTotalAvailQty(
                      "Total Available Quantity" +
                      CreatePick.CheckOutBound(
                        ReservEntry2."Source Type",ReservEntry2."Source Subtype",
                        ReservEntry2."Source ID",ReservEntry2."Source Ref. No.",
                        ReservEntry2."Source Prod. Order Line"))
                  else
                    AvailableItemLedgEntries.SetTotalAvailQty("Total Available Quantity");
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableItemLedgEntries.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableItemLedgEntries.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  if Location."Bin Mandatory" or Location."Require Pick" then
                    AvailableItemLedgEntries.SetTotalAvailQty(
                      "Total Available Quantity" +
                      CreatePick.CheckOutBound(
                        ReservEntry2."Source Type",ReservEntry2."Source Subtype",
                        ReservEntry2."Source ID",ReservEntry2."Source Ref. No.",
                        ReservEntry2."Source Prod. Order Line"))
                  else
                    AvailableItemLedgEntries.SetTotalAvailQty("Total Available Quantity");
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableItemLedgEntries.SetServiceLine(ServiceLine,ReservEntry2);
                  AvailableItemLedgEntries.SetTotalAvailQty("Total Available Quantity");
                  AvailableItemLedgEntries.SetMaxQtyToReserve(QtyToReserveBase - QtyReservedBase);
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableItemLedgEntries.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableItemLedgEntries.SetTotalAvailQty("Total Available Quantity");
                  AvailableItemLedgEntries.SetMaxQtyToReserve(QtyToReserveBase - QtyReservedBase);
                  AvailableItemLedgEntries.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableItemLedgEntries.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableItemLedgEntries.SetTotalAvailQty("Total Available Quantity");
                  AvailableItemLedgEntries.SetMaxQtyToReserve(QtyToReserveBase - QtyReservedBase);
                  AvailableItemLedgEntries.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableItemLedgEntries.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableItemLedgEntries.SetTotalAvailQty("Total Available Quantity");
                  AvailableItemLedgEntries.SetMaxQtyToReserve(QtyToReserveBase - QtyReservedBase);
                  AvailableItemLedgEntries.RUNMODAL;
                end ;
            end;
          end;
        11,12,13,14,15,16:
          begin // Purchase Line
            CLEAR(AvailablePurchLines);
            AvailablePurchLines.SetCurrentSubType("Entry No." - 11);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailablePurchLines.SetSalesLine(SalesLine,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailablePurchLines.SetReqLine(ReqLine,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailablePurchLines.SetPurchLine(PurchLine,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailablePurchLines.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailablePurchLines.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailablePurchLines.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailablePurchLines.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailablePurchLines.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailablePurchLines.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailablePurchLines.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailablePurchLines.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailablePurchLines.RUNMODAL;
                end ;
            end;
          end;
        21:
          begin // Requisition Line
            CLEAR(AvailableReqLines);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableReqLines.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableReqLines.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableReqLines.SetReqLine(ReqLine,ReservEntry2);
                  AvailableReqLines.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableReqLines.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableReqLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableReqLines.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableReqLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableReqLines.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableReqLines.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableReqLines.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableReqLines.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableReqLines.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableReqLines.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableReqLines.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailableReqLines.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableJobPlanningLines.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableJobPlanningLines.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableJobPlanningLines.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end ;
            end;
          end;
        31,32,33,34,35,36:
          begin // Sales Line
            CLEAR(AvailableSalesLines);
            AvailableSalesLines.SetCurrentSubType("Entry No." - 31);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableSalesLines.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableSalesLines.SetReqLine(ReqLine,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableSalesLines.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableSalesLines.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableSalesLines.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableSalesLines.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableSalesLines.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableSalesLines.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableSalesLines.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableSalesLines.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableSalesLines.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableSalesLines.RUNMODAL;
                end ;
            end;
          end;
        61,62,63,64:
          begin
            CLEAR(AvailableProdOrderLines);
            AvailableProdOrderLines.SetCurrentSubType("Entry No." - 61);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableProdOrderLines.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableProdOrderLines.SetReqLine(ReqLine,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableProdOrderLines.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableProdOrderLines.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableProdOrderLines.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableProdOrderLines.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableProdOrderLines.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableProdOrderLines.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableProdOrderLines.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableProdOrderLines.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableProdOrderLines.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableProdOrderLines.RUNMODAL;
                end ;
            end;
          end;
        71,72,73,74:
          begin
            CLEAR(AvailableProdOrderComps);
            AvailableProdOrderComps.SetCurrentSubType("Entry No." - 71);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableProdOrderComps.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableProdOrderComps.SetReqLine(ReqLine,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableProdOrderComps.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableProdOrderComps.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableProdOrderComps.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableProdOrderComps.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableProdOrderComps.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableProdOrderComps.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableProdOrderComps.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableProdOrderComps.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableProdOrderComps.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableProdOrderComps.RUNMODAL;
                end ;
            end;
          end;
        91:
          begin
            CLEAR(AvailablePlanningComponents);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailablePlanningComponents.SetSalesLine(SalesLine,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailablePlanningComponents.SetReqLine(ReqLine,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailablePlanningComponents.SetPurchLine(PurchLine,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailablePlanningComponents.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailablePlanningComponents.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailablePlanningComponents.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailablePlanningComponents.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailablePlanningComponents.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailablePlanningComponents.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailablePlanningComponents.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailablePlanningComponents.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailablePlanningComponents.RUNMODAL;
                end ;
            end;
          end;
        101,102:
          begin
            CLEAR(AvailableTransLines);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableTransLines.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableTransLines.SetReqLine(ReqLine,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableTransLines.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableTransLines.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableTransLines.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableTransLines.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableTransLines.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableTransLines.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableTransLines.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableTransLines.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableTransLines.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableTransLines.RUNMODAL;
                end ;
            end;
          end;
        110:
          begin // Service Line
            CLEAR(AvailableServiceLines);
            AvailableServiceLines.SetCurrentSubType("Entry No." - 109);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableServiceLines.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableServiceLines.SetReqLine(ReqLine,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableServiceLines.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableServiceLines.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableServiceLines.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableServiceLines.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableServiceLines.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableServiceLines.SetServInvLine(ServiceLine,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableServiceLines.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableServiceLines.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableServiceLines.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableServiceLines.RUNMODAL;
                end ;
            end;
          end;
        131,132,133,134:
          begin // Job Planning Line
            CLEAR(AvailableJobPlanningLines);
            AvailableJobPlanningLines.SetCurrentSubType("Entry No." - 131);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableJobPlanningLines.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableJobPlanningLines.SetReqLine(ReqLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableJobPlanningLines.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableJobPlanningLines.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableJobPlanningLines.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableJobPlanningLines.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableJobPlanningLines.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableJobPlanningLines.SetServLine(ServiceLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableJobPlanningLines.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableJobPlanningLines.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableJobPlanningLines.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableJobPlanningLines.RUNMODAL;
                end ;
            end;
          end;
        141,  142:
          begin // Asm Header
            CLEAR(AvailableAssemblyHeaders);
            AvailableAssemblyHeaders.SetCurrentSubType("Entry No." - 141);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableAssemblyHeaders.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableAssemblyHeaders.SetReqLine(ReqLine,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableAssemblyHeaders.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableAssemblyHeaders.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableAssemblyHeaders.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableAssemblyHeaders.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableAssemblyHeaders.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableAssemblyHeaders.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableAssemblyHeaders.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableAssemblyHeaders.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableAssemblyHeaders.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableAssemblyHeaders.RUNMODAL;
                end ;
            end;
          end;
        151,152:
          begin // Asm Line
            CLEAR(AvailableAssemblyLines);
            AvailableAssemblyLines.SetCurrentSubType("Entry No." - 151);
            case ReservEntry2."Source Type" of
              DATABASE::"Sales Line":
                begin
                  AvailableAssemblyLines.SetSalesLine(SalesLine,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Requisition Line":
                begin
                  AvailableAssemblyLines.SetReqLine(ReqLine,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Purchase Line":
                begin
                  AvailableAssemblyLines.SetPurchLine(PurchLine,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Line":
                begin
                  AvailableAssemblyLines.SetProdOrderLine(ProdOrderLine,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Prod. Order Component":
                begin
                  AvailableAssemblyLines.SetProdOrderComponent(ProdOrderComp,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Planning Component":
                begin
                  AvailableAssemblyLines.SetPlanningComponent(PlanningComponent,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Transfer Line":
                begin
                  AvailableAssemblyLines.SetTransferLine(TransLine,ReservEntry2,ReservEntry."Source Subtype");
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Service Line":
                begin
                  AvailableAssemblyLines.SetServiceInvLine(ServiceLine,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Job Planning Line":
                begin
                  AvailableAssemblyLines.SetJobPlanningLine(JobPlanningLine,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end;
              DATABASE::"Assembly Header":
                begin
                  AvailableAssemblyLines.SetAssemblyHeader(AssemblyHeader,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end ;
              DATABASE::"Assembly Line":
                begin
                  AvailableAssemblyLines.SetAssemblyLine(AssemblyLine,ReservEntry2);
                  AvailableAssemblyLines.RUNMODAL;
                end ;
            end;
          end;
      end;

      UpdateReservFrom;
    END;

    LOCAL PROCEDURE DrillDownReservedQuantity@8();
    BEGIN
      ReservEntry2.RESET;

      ReservEntry2.SETCURRENTKEY(
        "Item No.","Source Type","Source Subtype","Reservation Status","Location Code","Variant Code",
        "Shipment Date","Expected Receipt Date","Serial No.","Lot No.");

      FilterReservEntry(ReservEntry2,Rec);
      PAGE.RUNMODAL(PAGE::"Reservation Entries",ReservEntry2);

      UpdateReservFrom;
    END;

    LOCAL PROCEDURE DrillDownReservedThisLine@10();
    VAR
      ReservEntry3@1000 : Record "Reservation Entry";
      LotSNMatch@1001 : Boolean;
    BEGIN
      CLEAR(ReservEntry2);

      ReservEntry2.SETCURRENTKEY(
        "Item No.","Source Type","Source Subtype","Reservation Status","Location Code","Variant Code",
        "Shipment Date","Expected Receipt Date","Serial No.","Lot No.");

      FilterReservEntry(ReservEntry2,Rec);
      if ReservEntry2.FIND('-') then
        repeat
          ReservEntry3.GET(ReservEntry2."Entry No.",not ReservEntry2.Positive);

          if ReservEntry.TrackingExists then
            LotSNMatch := (ReservEntry3."Serial No." = ReservEntry."Serial No.") and
              (ReservEntry3."Lot No." = ReservEntry."Lot No.")
          else
            LotSNMatch := true;

          ReservEntry2.MARK((ReservEntry3."Source Type" = ReservEntry."Source Type") and
            (ReservEntry3."Source Subtype" = ReservEntry."Source Subtype") and
            (ReservEntry3."Source ID" = ReservEntry."Source ID") and
            (ReservEntry3."Source Batch Name" = ReservEntry."Source Batch Name") and
            (ReservEntry3."Source Prod. Order Line" = ReservEntry."Source Prod. Order Line") and
            (ReservEntry3."Source Ref. No." = ReservEntry."Source Ref. No.") and
            ((LotSNMatch and HandleItemTracking) or
             not HandleItemTracking));
        until ReservEntry2.NEXT = 0;

      ReservEntry2.MARKEDONLY(true);
      PAGE.RUNMODAL(PAGE::"Reservation Entries",ReservEntry2);

      UpdateReservFrom;
    END;

    [External]
    PROCEDURE ReservedThisLine@14(ReservSummEntry2@1002 : TEMPORARY Record "Entry Summary") ReservedQuantity : Decimal;
    VAR
      ReservEntry3@1001 : Record "Reservation Entry";
    BEGIN
      CLEAR(ReservEntry2);

      ReservEntry2.SETCURRENTKEY(
        "Item No.","Source Type","Source Subtype","Reservation Status","Location Code","Variant Code",
        "Shipment Date","Expected Receipt Date","Serial No.","Lot No.");
      ReservedQuantity := 0;

      FilterReservEntry(ReservEntry2,ReservSummEntry2);
      if ReservEntry2.FIND('-') then
        repeat
          ReservEntry3.GET(ReservEntry2."Entry No.",not ReservEntry2.Positive);
          if (ReservEntry3."Source Type" = ReservEntry."Source Type") and
             (ReservEntry3."Source Subtype" = ReservEntry."Source Subtype") and
             (ReservEntry3."Source ID" = ReservEntry."Source ID") and
             (ReservEntry3."Source Batch Name" = ReservEntry."Source Batch Name") and
             (ReservEntry3."Source Prod. Order Line" = ReservEntry."Source Prod. Order Line") and
             (ReservEntry3."Source Ref. No." = ReservEntry."Source Ref. No.") and
             (((ReservEntry3."Serial No." = ReservEntry."Serial No.") and
               (ReservEntry3."Lot No." = ReservEntry."Lot No.") and
               HandleItemTracking) or
              not HandleItemTracking)
          then
            ReservedQuantity += ReservEntry2."Quantity (Base)" * CreateReservEntry.SignFactor(ReservEntry2);
        until ReservEntry2.NEXT = 0;

      exit(ReservedQuantity);
    END;

    LOCAL PROCEDURE GetSerialLotNo@17(VAR ItemTrackingQtyToReserve@1001 : Decimal;VAR ItemTrackingQtyToReserveBase@1006 : Decimal);
    VAR
      Item@1000 : Record Item;
      ReservEntry2@1002 : Record "Reservation Entry";
      TempReservEntry@1003 : TEMPORARY Record "Reservation Entry";
      TempTrackingSpecification@1005 : TEMPORARY Record "Tracking Specification";
      ItemTrackingMgt@1004 : Codeunit "Item Tracking Management";
      SignFactor@1007 : Integer;
    BEGIN
      Item.GET(ReservEntry."Item No.");
      if Item."Item Tracking Code" = '' then
        exit;
      ReservEntry2 := ReservEntry;
      ReservEntry2.SetPointerFilter;
      ItemTrackingMgt.SumUpItemTracking(ReservEntry2,TempTrackingSpecification,true,true);

      if TempTrackingSpecification.FIND('-') then begin
        if not CONFIRM(STRSUBSTNO(Text006))
        then
          exit;
        repeat
          TempReservEntry.TRANSFERFIELDS(TempTrackingSpecification);
          TempReservEntry.INSERT;
        until TempTrackingSpecification.NEXT = 0;

        if PAGE.RUNMODAL(PAGE::"Item Tracking List",TempReservEntry) = ACTION::LookupOK then begin
          ReservEntry."Serial No." := TempReservEntry."Serial No.";
          ReservEntry."Lot No." := TempReservEntry."Lot No.";
          CaptionText += STRSUBSTNO(Text007,ReservEntry."Serial No.",ReservEntry."Lot No.");
          SignFactor := CreateReservEntry.SignFactor(TempReservEntry);
          ItemTrackingQtyToReserveBase := TempReservEntry."Quantity (Base)" * SignFactor;
          ItemTrackingQtyToReserve := ROUND(ItemTrackingQtyToReserveBase / TempReservEntry."Qty. per Unit of Measure",0.00001);
          HandleItemTracking := true;
        end else
          ERROR(Text008);
      end;
    END;

    LOCAL PROCEDURE UpdateNonSpecific@19();
    BEGIN
      SETFILTER("Non-specific Reserved Qty.",'>%1',0);
      NoteTextVisible := not ISEMPTY;
      NonSpecificQty := "Non-specific Reserved Qty.";
      SETRANGE("Non-specific Reserved Qty.");
    END;

    [External]
    PROCEDURE AutoReserve@21();
    BEGIN
      if ABS(QtyToReserveBase) - ABS(QtyReservedBase) = 0 then
        ERROR(Text000);

      ReservMgt.AutoReserve(
        FullAutoReservation,ReservEntry.Description,
        ReservEntry."Shipment Date",QtyToReserve - QtyReserved,QtyToReserveBase - QtyReservedBase);
      if not FullAutoReservation then
        MESSAGE(Text001);
      UpdateReservFrom;
    END;

    LOCAL PROCEDURE GetQtyPerUOMFromSource@24() : Decimal;
    BEGIN
      case ReservEntry."Source Type" of
        DATABASE::"Sales Line":
          exit(GetQtyPerUomFromSalesLine);
        DATABASE::"Requisition Line":
          exit(GetQtyPerUomFromReqLine);
        DATABASE::"Purchase Line":
          exit(GetQtyPerUomFromPurchLine);
        DATABASE::"Item Journal Line":
          exit(GetQtyPerUomFromItemJnlLine);
        DATABASE::"Prod. Order Line":
          exit(GetQtyPerUomFromProdOrderLine);
        DATABASE::"Prod. Order Component":
          exit(GetQtyPerUomFromProdOrderComponent);
        DATABASE::"Assembly Header":
          exit(GetQtyPerUomFromAssemblyHeader);
        DATABASE::"Assembly Line":
          exit(GetQtyPerUomFromAssemblyLine);
        DATABASE::"Planning Component":
          exit(GetQtyPerUomFromPlanningComponent);
        DATABASE::"Transfer Line":
          exit(GetQtyPerUomFromTransferLine);
        DATABASE::"Service Line":
          exit(GetQtyPerUomFromServiceLine);
        DATABASE::"Job Planning Line":
          exit(GetQtyPerUomFromJobPlanningLine);
      end;
    END;

    LOCAL PROCEDURE GetQtyPerUomFromSalesLine@25() : Decimal;
    BEGIN
      SalesLine.FIND;
      SalesLine.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      if SalesLine."Document Type" = SalesLine."Document Type"::"Return Order" then begin
        SalesLine."Reserved Quantity" := -SalesLine."Reserved Quantity";
        SalesLine."Reserved Qty. (Base)" := -SalesLine."Reserved Qty. (Base)";
      end;
      QtyReserved := SalesLine."Reserved Quantity";
      QtyReservedBase := SalesLine."Reserved Qty. (Base)";
      QtyToReserve := SalesLine."Outstanding Quantity";
      QtyToReserveBase := SalesLine."Outstanding Qty. (Base)";
      exit(SalesLine."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromReqLine@26() : Decimal;
    BEGIN
      ReqLine.FIND;
      ReqLine.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := ReqLine."Reserved Quantity";
      QtyReservedBase := ReqLine."Reserved Qty. (Base)";
      QtyToReserve := ReqLine.Quantity;
      QtyToReserveBase := ReqLine."Quantity (Base)";
      exit(ReqLine."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromPurchLine@27() : Decimal;
    BEGIN
      PurchLine.FIND;
      PurchLine.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      if PurchLine."Document Type" = PurchLine."Document Type"::"Return Order" then begin
        PurchLine."Reserved Quantity" := -PurchLine."Reserved Quantity";
        PurchLine."Reserved Qty. (Base)" := -PurchLine."Reserved Qty. (Base)";
      end;
      QtyReserved := PurchLine."Reserved Quantity";
      QtyReservedBase := PurchLine."Reserved Qty. (Base)";
      QtyToReserve := PurchLine."Outstanding Quantity";
      QtyToReserveBase := PurchLine."Outstanding Qty. (Base)";
      exit(PurchLine."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromItemJnlLine@28() : Decimal;
    BEGIN
      ItemJnlLine.FIND;
      ItemJnlLine.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := ItemJnlLine."Reserved Quantity";
      QtyReservedBase := ItemJnlLine."Reserved Qty. (Base)";
      QtyToReserve := ItemJnlLine.Quantity;
      QtyToReserveBase := ItemJnlLine."Quantity (Base)";
      exit(ItemJnlLine."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromProdOrderLine@29() : Decimal;
    BEGIN
      ProdOrderLine.FIND;
      ProdOrderLine.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := ProdOrderLine."Reserved Quantity";
      QtyReservedBase := ProdOrderLine."Reserved Qty. (Base)";
      QtyToReserve := ProdOrderLine."Remaining Quantity";
      QtyToReserveBase := ProdOrderLine."Remaining Qty. (Base)";
      exit(ProdOrderLine."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromProdOrderComponent@30() : Decimal;
    BEGIN
      ProdOrderComp.FIND;
      ProdOrderComp.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := ProdOrderComp."Reserved Quantity";
      QtyReservedBase := ProdOrderComp."Reserved Qty. (Base)";
      QtyToReserve := ProdOrderComp."Remaining Quantity";
      QtyToReserveBase := ProdOrderComp."Remaining Qty. (Base)";
      exit(ProdOrderComp."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromAssemblyHeader@31() : Decimal;
    BEGIN
      AssemblyHeader.FIND;
      AssemblyHeader.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := AssemblyHeader."Reserved Quantity";
      QtyReservedBase := AssemblyHeader."Reserved Qty. (Base)";
      QtyToReserve := AssemblyHeader."Remaining Quantity";
      QtyToReserveBase := AssemblyHeader."Remaining Quantity (Base)";
      exit(AssemblyHeader."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromAssemblyLine@32() : Decimal;
    BEGIN
      AssemblyLine.FIND;
      AssemblyLine.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := AssemblyLine."Reserved Quantity";
      QtyReservedBase := AssemblyLine."Reserved Qty. (Base)";
      QtyToReserve := AssemblyLine."Remaining Quantity";
      QtyToReserveBase := AssemblyLine."Remaining Quantity (Base)";
      exit(AssemblyLine."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromPlanningComponent@33() : Decimal;
    BEGIN
      PlanningComponent.FIND;
      PlanningComponent.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := PlanningComponent."Reserved Quantity";
      QtyReservedBase := PlanningComponent."Reserved Qty. (Base)";
      QtyToReserve := PlanningComponent."Expected Quantity";
      QtyToReserveBase := PlanningComponent."Expected Quantity (Base)";
      exit(PlanningComponent."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromTransferLine@34() : Decimal;
    BEGIN
      TransLine.FIND;
      if ReservEntry."Source Subtype" = 0 then begin // Outbound
        TransLine.CALCFIELDS("Reserved Quantity Outbnd.","Reserved Qty. Outbnd. (Base)");
        QtyReserved := TransLine."Reserved Quantity Outbnd.";
        QtyReservedBase := TransLine."Reserved Qty. Outbnd. (Base)";
        QtyToReserve := TransLine."Outstanding Quantity";
        QtyToReserveBase := TransLine."Outstanding Qty. (Base)";
      end else begin // Inbound
        TransLine.CALCFIELDS("Reserved Quantity Inbnd.","Reserved Qty. Inbnd. (Base)");
        QtyReserved := TransLine."Reserved Quantity Inbnd.";
        QtyReservedBase := TransLine."Reserved Qty. Inbnd. (Base)";
        QtyToReserve := TransLine."Outstanding Quantity";
        QtyToReserveBase := TransLine."Outstanding Qty. (Base)";
      end;
      exit(TransLine."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromServiceLine@35() : Decimal;
    BEGIN
      ServiceLine.FIND;
      ServiceLine.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := ServiceLine."Reserved Quantity";
      QtyReservedBase := ServiceLine."Reserved Qty. (Base)";
      QtyToReserve := ServiceLine."Outstanding Quantity";
      QtyToReserveBase := ServiceLine."Outstanding Qty. (Base)";
      exit(ServiceLine."Qty. per Unit of Measure");
    END;

    LOCAL PROCEDURE GetQtyPerUomFromJobPlanningLine@36() : Decimal;
    BEGIN
      JobPlanningLine.FIND;
      if JobPlanningLine.UpdatePlanned then begin
        JobPlanningLine.MODIFY(true);
        COMMIT;
      end;
      JobPlanningLine.CALCFIELDS("Reserved Quantity","Reserved Qty. (Base)");
      QtyReserved := JobPlanningLine."Reserved Quantity";
      QtyReservedBase := JobPlanningLine."Reserved Qty. (Base)";
      QtyToReserve := JobPlanningLine."Remaining Qty.";
      QtyToReserveBase := JobPlanningLine."Remaining Qty. (Base)";
      exit(JobPlanningLine."Qty. per Unit of Measure");
    END;

    BEGIN
    END.
  }
}

