OBJECT Codeunit 2117 Coupons Sync
{
  OBJECT-PROPERTIES
  {
    Date=20171006D;
    Time=120000T;
    Version List=NAVW111.0;
  }
  PROPERTIES
  {
    TableNo="Sales Header";
    OnRun=BEGIN
            RenewCouponsAndShowNotificationForDocument(Rec);
          END;

  }
  CODE
  {
    VAR
      GraphIntContact@1000 : Codeunit "Graph Int. - Contact";
      CouponsManagement@1001 : Codeunit "Coupons Management";

    PROCEDURE RenewCouponsAndShowNotificationForDocument@6(SalesHeader@1000 : Record "Sales Header") : Boolean;
    VAR
      Customer@1004 : Record Customer;
      GraphContactID@1008 : Text[250];
    BEGIN
      if not Customer.GET(SalesHeader."Sell-to Customer No.") then
        exit;

      if not GraphIntContact.FindGraphContactIdFromCustomerNo(GraphContactID,SalesHeader."Sell-to Customer No.") then
        exit;

      CouponsManagement.GetCouponsForGraphContactId(GraphContactID);

      exit(CouponsManagement.ShowNotificationIfAnyNotApplied(SalesHeader,GraphContactID,Customer.Name));
    END;

    BEGIN
    END.
  }
}

