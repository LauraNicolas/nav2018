OBJECT Table 5901 Service Item Line
{
  OBJECT-PROPERTIES
  {
    Date=20171006D;
    Time=120000T;
    Version List=NAVW111.0;
  }
  PROPERTIES
  {
    Permissions=TableData "Loaner Entry"=rimd,
                TableData "Service Order Allocation"=rimd;
    OnInsert=BEGIN
               ServMgtSetup.GET;
               ServItemLine.RESET;
               ServItemLine.SETRANGE("Document Type","Document Type");
               ServItemLine.SETRANGE("Document No.","Document No.");
               FirstServItemLine := not ServItemLine.FIND('-');
               if ServMgtSetup."One Service Item Line/Order" then
                 if not FirstServItemLine then
                   ERROR(Text000,ServMgtSetup.TABLECAPTION,ServItemLine.TABLECAPTION,ServHeader.TABLECAPTION);

               GetServHeader;
               if ServHeader."Customer No." = '' then begin
                 if (ServHeader.Name <> '') and (ServHeader.Address <> '') and (ServHeader.City <> '') then
                   ERROR(
                     Text001,
                     TABLECAPTION,ServHeader.FIELDCAPTION("Customer No."),ServHeader.TABLECAPTION,ServHeader."No.");
                 ERROR(
                   Text002,
                   TABLECAPTION,ServHeader.FIELDCAPTION("Customer No."),ServHeader.TABLECAPTION,ServHeader."No.");
               end;

               "Responsibility Center" := ServHeader."Responsibility Center";
               "Customer No." := ServHeader."Customer No.";
               if ServHeader."Contract No." <> '' then
                 if "Service Item No." = '' then
                   "Contract No." := ServHeader."Contract No."
                 else begin
                   ServContractLine.RESET;
                   ServContractLine.SETRANGE("Contract Type",ServContractLine."Contract Type"::Contract);
                   ServContractLine.SETRANGE("Contract No.",ServHeader."Contract No.");
                   ServContractLine.SETRANGE("Service Item No.","Service Item No.");
                   ServContractLine.SETRANGE("Contract Status",ServContractLine."Contract Status"::Signed);
                   ServContractLine.SETFILTER("Starting Date",'<=%1',ServHeader."Order Date");
                   ServContractLine.SETFILTER("Contract Expiration Date",'>%1 | =%2',ServHeader."Order Date",0D);
                   if ServContractLine.FINDFIRST then
                     "Contract No." := ServHeader."Contract No.";
                 end;
               if ("Contract No." <> '') and ("Service Price Group Code" <> '') then
                 VALIDATE("Service Price Group Code",'');

               ServOrderAllocMgt.CreateAllocationEntry(
                 "Document Type","Document No.","Line No.","Service Item No.","Serial No.");

               CLEAR(ServLogMgt);
               ServLogMgt.ServItemToServOrder(Rec);

               if (ServHeader."Quote No." = '') and ("Response Time (Hours)" = 0) then
                 UpdateResponseTimeHours;
               ServOrderMgt.UpdateResponseDateTime(Rec,false);
               ServOrderMgt.UpdatePriority(Rec,false);

               if "Line No." = 0 then
                 LendLoanerWithConfirmation;

               if "Service Item No." = '' then
                 "Ship-to Code" := ServHeader."Ship-to Code";
               if FirstServItemLine and
                  ("Document Type" = "Document Type"::Order)
               then begin
                 CLEAR(SegManagement);
                 if ServHeader."Bill-to Contact No." <> '' then
                   SegManagement.LogDocument(
                     9,"Document No.",0,0,DATABASE::Contact,ServHeader."Bill-to Contact No.",
                     ServHeader."Salesperson Code",'',ServHeader.Description,'')
                 else
                   SegManagement.LogDocument(
                     9,"Document No.",0,0,DATABASE::Customer,ServHeader."Bill-to Customer No.",
                     ServHeader."Salesperson Code",'',ServHeader.Description,'');
               end;
             END;

    OnModify=BEGIN
               if UseServItemLineAsxRec then begin
                 xRec := ServItemLine;
                 UseServItemLineAsxRec := false;
               end;

               if ("Service Item No." <> xRec."Service Item No.") or ("Serial No." <> xRec."Serial No.") then begin
                 ServLine.RESET;
                 ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.");
                 ServLine.SETRANGE("Document Type","Document Type");
                 ServLine.SETRANGE("Document No.","Document No.");
                 ServLine.SETRANGE("Service Item Line No.","Line No.");
                 if ServLine.FIND('-') then
                   repeat
                     ServLine."Service Item No." := "Service Item No.";
                     ServLine."Service Item Serial No." := "Serial No.";
                     ServLine.MODIFY(true);
                   until ServLine.NEXT = 0;

                 ServOrderAlloc.RESET;
                 ServOrderAlloc.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.");
                 ServOrderAlloc.SETRANGE("Document Type","Document Type");
                 ServOrderAlloc.SETRANGE("Document No.","Document No.");
                 ServOrderAlloc.SETRANGE("Service Item Line No.","Line No.");
                 if ServOrderAlloc.FIND('-') then
                   repeat
                     ServOrderAlloc."Service Item No." := "Service Item No.";
                     ServOrderAlloc."Service Item Serial No." := "Serial No.";
                     ServOrderAlloc.MODIFY(true);
                   until ServOrderAlloc.NEXT = 0;
               end;

               if (("Fault Area Code" <> xRec."Fault Area Code") or
                   ("Symptom Code" <> xRec."Symptom Code") or
                   ("Fault Code" <> xRec."Fault Code") or
                   ("Resolution Code" <> xRec."Resolution Code")) and
                  CheckServLineExist
               then
                 MESSAGE(
                   Text003,
                   TABLECAPTION);
               if "Service Item No." <> xRec."Service Item No." then begin
                 CLEAR(ServLogMgt);
                 ServLogMgt.ServItemOffServOrder(xRec);
                 ServLogMgt.ServItemToServOrder(Rec);
               end;

               ServOrderMgt.UpdateResponseDateTime(Rec,false);
               ServOrderMgt.UpdatePriority(Rec,false);
               UpdateServiceOrderChangeLog(xRec);
             END;

    OnDelete=VAR
               LoanerEntry@1000 : Record "Loaner Entry";
             BEGIN
               if "Loaner No." <> '' then begin
                 Loaner.GET("Loaner No.");
                 LoanerEntry.SETRANGE("Document Type","Document Type" + 1);
                 LoanerEntry.SETRANGE("Document No.","Document No.");
                 LoanerEntry.SETRANGE("Loaner No.","Loaner No.");
                 LoanerEntry.SETRANGE(Lent,true);
                 if not LoanerEntry.ISEMPTY then
                   ERROR(
                     Text006,
                     TABLECAPTION,"Document No.","Line No.",FIELDCAPTION("Loaner No."),"Loaner No.");
                 LoanerEntry.SETRANGE(Lent,true);
                 LoanerEntry.DELETEALL;
               end;

               ServLine.RESET;
               ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.");
               ServLine.SETRANGE("Document Type","Document Type");
               ServLine.SETRANGE("Document No.","Document No.");
               ServLine.SETRANGE("Service Item Line No.","Line No.");
               if ServLine.FIND('-') then
                 ERROR(
                   Text008,
                   TABLECAPTION,"Document No.","Line No.",ServLine.TABLECAPTION);

               ServOrderAlloc.RESET;
               ServOrderAlloc.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.");
               ServOrderAlloc.SETRANGE("Document Type","Document Type");
               ServOrderAlloc.SETRANGE("Document No.","Document No.");
               ServOrderAlloc.SETRANGE("Service Item Line No.","Line No.");
               ServOrderAlloc.SETFILTER(Status,'%1|%2',ServOrderAlloc.Status::Active,ServOrderAlloc.Status::Finished);
               if ServOrderAlloc.FIND('-') then
                 ERROR(
                   Text008,
                   TABLECAPTION,"Document No.","Line No.",ServOrderAlloc.TABLECAPTION);
               ServOrderAlloc.SETRANGE(Status);
               ServOrderAlloc.DELETEALL;

               ServCommentLine.RESET;
               ServCommentLine.SETRANGE("Table Name",ServCommentLine."Table Name"::"Service Header");
               ServCommentLine.SETRANGE("Table Subtype","Document Type");
               ServCommentLine.SETRANGE("No.","Document No.");
               ServCommentLine.SETRANGE("Table Line No.","Line No.");
               ServCommentLine.DELETEALL;

               CLEAR(ServLogMgt);
               ServLogMgt.ServItemOffServOrder(Rec);

               ServOrderMgt.UpdateResponseDateTime(Rec,true);
               UpdateStartFinishDateTime("Document Type","Document No.","Line No.",CALCDATE('<CY+1D-1Y>',WORKDATE),000000T,0D,000000T,true);
               ServOrderMgt.UpdatePriority(Rec,true);
             END;

    OnRename=BEGIN
               ERROR(Text010,TABLECAPTION);
             END;

    CaptionML=ENU=Service Item Line;
    LookupPageID="Service Item Lines";
    DrillDownPageID="Service Item Lines";
  }
  FIELDS
  {
    { 1   ;   ;Document No.        ;Code20        ;TableRelation="Service Header"."No." WHERE ("Document Type"=FIELD("Document Type"));
                                                   OnValidate=BEGIN
                                                                CreateDim(
                                                                  DATABASE::"Service Item","Service Item No.",
                                                                  DATABASE::"Service Item Group","Service Item Group Code",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");
                                                              END;

                                                   CaptionML=ENU=Document No.;
                                                   Editable=false }
    { 2   ;   ;Line No.            ;Integer       ;CaptionML=ENU=Line No. }
    { 3   ;   ;Service Item No.    ;Code20        ;TableRelation="Service Item"."No.";
                                                   OnValidate=VAR
                                                                Cust@1000 : Record Customer;
                                                                ServContractList@1001 : Page "Serv. Contr. List (Serv. Item)";
                                                              BEGIN
                                                                if "Loaner No." <> '' then
                                                                  ERROR(Text055,FIELDCAPTION("Service Item No."),
                                                                    FIELDCAPTION("Loaner No."),"Loaner No.");

                                                                if "Service Item No." <> xRec."Service Item No." then begin
                                                                  if CheckServLineExist then
                                                                    ERROR(
                                                                      Text011,
                                                                      FIELDCAPTION("Service Item No."),TABLECAPTION,ServLine.TABLECAPTION);
                                                                end else begin
                                                                  CreateDim(
                                                                    DATABASE::"Service Item","Service Item No.",
                                                                    DATABASE::"Service Item Group","Service Item Group Code",
                                                                    DATABASE::"Responsibility Center","Responsibility Center");

                                                                  if ServItem.GET("Service Item No.") then begin
                                                                    SetServItemInfo(ServItem);
                                                                    if "Contract No." = '' then
                                                                      VALIDATE("Service Price Group Code",ServItem."Service Price Group Code");
                                                                    "Service Item Group Code" := ServItem."Service Item Group Code";
                                                                  end;

                                                                  exit;
                                                                end;

                                                                if "Service Item No." = '' then begin
                                                                  if xRec."Service Item No." <> "Service Item No." then begin
                                                                    VALIDATE("Warranty Starting Date (Parts)",0D);
                                                                    VALIDATE("Warranty Starting Date (Labor)",0D);
                                                                    VALIDATE("Contract No.",'');
                                                                    VALIDATE("Serial No.",'');
                                                                  end;
                                                                  exit;
                                                                end;

                                                                ServContractExist := false;
                                                                ServHeader.GET("Document Type","Document No.");
                                                                if ServItem.GET("Service Item No.") then begin
                                                                  if ServHeader."Customer No." <> ServItem."Customer No." then
                                                                    ERROR(
                                                                      Text012,
                                                                      ServItem.TABLECAPTION,"Service Item No.",ServHeader.FIELDCAPTION("Customer No."),ServHeader."Customer No.");

                                                                  if ServHeader."Contract No." <> '' then begin
                                                                    ServHeader.TESTFIELD("Order Date");
                                                                    ServContractLine.RESET;
                                                                    ServContractLine.SETRANGE("Contract Type",ServContractLine."Contract Type"::Contract);
                                                                    ServContractLine.SETRANGE("Contract No.",ServHeader."Contract No.");
                                                                    ServContractLine.SETRANGE("Service Item No.","Service Item No.");
                                                                    if not ServContractLine.FINDFIRST then
                                                                      ERROR(Text050,ServHeader."Contract No.","Service Item No.");
                                                                    ServContractLine.ValidateServicePeriod(ServHeader."Order Date");
                                                                    ServContractExist := true;
                                                                  end;

                                                                  if ServHeader."Contract No." = '' then begin
                                                                    ServContractLine.RESET;
                                                                    ServContractLine.FILTERGROUP(2);
                                                                    ServContractLine.SETCURRENTKEY("Service Item No.","Contract Status");
                                                                    ServContractLine.SETRANGE("Service Item No.",ServItem."No.");
                                                                    ServContractLine.SETRANGE("Contract Status",ServContractLine."Contract Status"::Signed);
                                                                    ServContractLine.SETRANGE("Contract Type",ServContractLine."Contract Type"::Contract);
                                                                    ServContractLine.SETRANGE("Customer No.",ServHeader."Customer No.");
                                                                    ServContractLine.SETFILTER("Starting Date",'<=%1',ServHeader."Order Date");
                                                                    ServContractLine.SETFILTER("Contract Expiration Date",'>=%1 | =%2',ServHeader."Order Date",0D);
                                                                    ServContractLine.FILTERGROUP(0);

                                                                    if ServContractLine.FIND('-') then
                                                                      if ServContractLine.NEXT > 0 then begin
                                                                        if CONFIRM(Text047,true,"Service Item No.") then begin
                                                                          ServContractList.SETTABLEVIEW(ServContractLine);
                                                                          ServContractList.LOOKUPMODE(true);
                                                                          if ServContractList.RUNMODAL = ACTION::LookupOK then begin
                                                                            ServContractList.GETRECORD(ServContractLine);
                                                                            ServContractExist := true;
                                                                          end;
                                                                        end;
                                                                      end else begin
                                                                        ServContractLine.FINDFIRST;
                                                                        ServContractExist := true;
                                                                      end;
                                                                  end;

                                                                  if (ServItem."Ship-to Code" <> ServHeader."Ship-to Code") and
                                                                     not HideDialogBox
                                                                  then
                                                                    if not CONFIRM(
                                                                         Text040,false,ServItem.TABLECAPTION,
                                                                         FIELDCAPTION("Ship-to Code"),Cust.TABLECAPTION)
                                                                    then begin
                                                                      "Service Item No." := xRec."Service Item No.";
                                                                      exit;
                                                                    end;
                                                                  "Ship-to Code" := ServItem."Ship-to Code";
                                                                  SetServItemInfo(ServItem);

                                                                  if ServContractExist then
                                                                    VALIDATE("Contract No.",ServContractLine."Contract No.")
                                                                  else
                                                                    VALIDATE("Contract No.",'');

                                                                  if "Contract No." = '' then
                                                                    VALIDATE("Service Price Group Code",ServItem."Service Price Group Code");
                                                                  VALIDATE("Service Item Group Code",ServItem."Service Item Group Code");
                                                                end;

                                                                if ServItemLine.GET("Document Type","Document No.","Line No.") then begin
                                                                  UseServItemLineAsxRec := true;
                                                                  MODIFY(true);
                                                                end;
                                                                UpdateResponseTimeHours;
                                                                CreateDim(
                                                                  DATABASE::"Service Item","Service Item No.",
                                                                  DATABASE::"Service Item Group","Service Item Group Code",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");
                                                              END;

                                                   CaptionML=ENU=Service Item No. }
    { 4   ;   ;Service Item Group Code;Code10     ;TableRelation="Service Item Group".Code;
                                                   OnValidate=BEGIN
                                                                if "Service Item Group Code" <> xRec."Service Item Group Code" then begin
                                                                  if "Service Item No." <> '' then begin
                                                                    ServItem.GET("Service Item No.");
                                                                    TESTFIELD("Service Item Group Code",ServItem."Service Item Group Code");
                                                                  end;
                                                                  if ServItemGr.GET("Service Item Group Code") then begin
                                                                    if ("Item No." = '') and (Description = '') then
                                                                      Description := ServItemGr.Description;
                                                                    if ServItem."Service Price Group Code" = '' then
                                                                      if "Contract No." = '' then
                                                                        VALIDATE("Service Price Group Code",ServItemGr."Default Serv. Price Group Code");
                                                                  end;
                                                                end;
                                                                UpdateResponseTimeHours;

                                                                CreateDim(
                                                                  DATABASE::"Service Item Group","Service Item Group Code",
                                                                  DATABASE::"Service Item","Service Item No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center");
                                                              END;

                                                   CaptionML=ENU=Service Item Group Code }
    { 5   ;   ;Item No.            ;Code20        ;TableRelation=Item."No.";
                                                   OnValidate=BEGIN
                                                                if "Service Item No." <> '' then
                                                                  ERROR(Text016,
                                                                    FIELDCAPTION("Item No."),FIELDCAPTION("Service Item No."));
                                                                if "Item No." <> '' then begin
                                                                  Item.GET("Item No.");
                                                                  VALIDATE("Service Item Group Code",Item."Service Item Group");
                                                                  GetServHeader;
                                                                  if (ServHeader."Language Code" = '') or not GetItemTranslation then begin
                                                                    Description := Item.Description;
                                                                    "Description 2" := Item."Description 2";
                                                                  end;
                                                                end else begin
                                                                  Description := '';
                                                                  "Description 2" := '';
                                                                end;
                                                                UpdateResponseTimeHours;
                                                              END;

                                                   CaptionML=ENU=Item No. }
    { 6   ;   ;Serial No.          ;Code20        ;OnValidate=BEGIN
                                                                if "Serial No." <> xRec."Serial No." then
                                                                  if "Service Item No." <> '' then
                                                                    ERROR(
                                                                      Text016,
                                                                      FIELDCAPTION("Serial No."),FIELDCAPTION("Service Item No."));
                                                                UpdateResponseTimeHours;

                                                                if "Serial No." = '' then
                                                                  exit;

                                                                GetServHeader;
                                                                ServItem.RESET;
                                                                ServItem.SETCURRENTKEY("Customer No.","Ship-to Code","Item No.","Serial No.");
                                                                ServItem.SETRANGE("Customer No.",ServHeader."Customer No.");
                                                                ServItem.SETRANGE("Ship-to Code",ServHeader."Ship-to Code");
                                                                ServItem.SETRANGE("Item No.","Item No.");
                                                                ServItem.SETRANGE("Serial No.","Serial No.");
                                                                NoOfRec := ServItem.COUNT;
                                                                case true of
                                                                  NoOfRec = 1:
                                                                    begin
                                                                      ServItem.FINDFIRST;
                                                                      VALIDATE("Service Item No.",ServItem."No.");
                                                                    end;
                                                                  NoOfRec > 1:
                                                                    if PAGE.RUNMODAL(0,ServItem) = ACTION::LookupOK then
                                                                      VALIDATE("Service Item No.",ServItem."No.");
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Serial No. }
    { 7   ;   ;Description         ;Text50        ;OnValidate=BEGIN
                                                                UpdateResponseTimeHours;
                                                                VALIDATE("Document No.");
                                                              END;

                                                   CaptionML=ENU=Description }
    { 8   ;   ;Description 2       ;Text50        ;OnValidate=BEGIN
                                                                UpdateResponseTimeHours;
                                                              END;

                                                   CaptionML=ENU=Description 2 }
    { 9   ;   ;Repair Status Code  ;Code10        ;TableRelation="Repair Status";
                                                   OnValidate=BEGIN
                                                                UpdateResponseTimeHours;
                                                                if "Repair Status Code" <> '' then begin
                                                                  RepairStatus.GET("Repair Status Code");
                                                                  if RepairStatus2.GET(xRec."Repair Status Code") then
                                                                    if (not RepairStatus.Finished and RepairStatus2.Finished) or
                                                                       (not RepairStatus."Quote Finished" and RepairStatus2."Quote Finished")
                                                                    then begin
                                                                      "Finishing Date" := 0D;
                                                                      "Finishing Time" := 000000T;
                                                                    end;

                                                                  if ("Document Type" = "Document Type"::Order) and
                                                                     RepairStatus."Quote Finished"
                                                                  then
                                                                    ERROR(Text035,RepairStatus.TABLECAPTION,RepairStatus.Code);

                                                                  if ("Document Type" = "Document Type"::Quote) and
                                                                     RepairStatus.Finished
                                                                  then
                                                                    ERROR(Text036,RepairStatus.TABLECAPTION,RepairStatus.Code);
                                                                  if RepairStatus.Initial then begin
                                                                    "Starting Date" := 0D;
                                                                    "Starting Time" := 000000T;
                                                                    "Finishing Date" := 0D;
                                                                    "Finishing Time" := 000000T;
                                                                    UpdateStartFinishDateTime("Document Type","Document No.","Line No.","Starting Date","Starting Time",
                                                                      "Finishing Date","Finishing Time",false);
                                                                    ServOrderAlloc.SetFilters(Rec);
                                                                    ServOrderAlloc.MODIFYALL("Service Started",false,false);
                                                                  end;

                                                                  if RepairStatus."In Process" then begin
                                                                    GetServHeader;
                                                                    if ServHeader."Order Date" > WORKDATE then begin
                                                                      "Starting Date" := ServHeader."Order Date";
                                                                      VALIDATE("Starting Time",ServHeader."Order Time");
                                                                    end else begin
                                                                      "Starting Date" := WORKDATE;
                                                                      if (ServHeader."Order Date" = "Starting Date") and (ServHeader."Order Time" > TIME) then
                                                                        VALIDATE("Starting Time",ServHeader."Order Time")
                                                                      else
                                                                        VALIDATE("Starting Time",TIME);
                                                                    end;
                                                                    ServOrderAlloc.SetFilters(Rec);
                                                                    ServOrderAlloc.MODIFYALL("Service Started",true,false);
                                                                  end;

                                                                  if RepairStatus.Finished then begin
                                                                    ServMgtSetup.GET;
                                                                    if ServMgtSetup."Fault Reason Code Mandatory" then
                                                                      TESTFIELD("Fault Reason Code");
                                                                    GetServHeader;
                                                                    CalculateDates;
                                                                    ServOrderAlloc.SetFilters(Rec);
                                                                    ServOrderAlloc.MODIFYALL(Status,ServOrderAlloc.Status::Finished,false);
                                                                  end;

                                                                  if RepairStatus."Quote Finished" then begin
                                                                    GetServHeader;
                                                                    CalculateDates;
                                                                  end;

                                                                  if RepairStatus."Partly Serviced" or RepairStatus.Referred then begin
                                                                    ServOrderAlloc.SetFilters(Rec);
                                                                    if ServOrderAlloc.FIND('-') then
                                                                      repeat
                                                                        if RepairStatus.Referred and RepairStatus2.Initial then
                                                                          ServOrderAlloc."Service Started" := false;
                                                                        ServOrderAlloc.Status := ServOrderAlloc.Status::"Reallocation Needed";
                                                                        ServOrderAlloc."Reason Code" := '';
                                                                        ServOrderAlloc.MODIFY;
                                                                      until ServOrderAlloc.NEXT = 0;
                                                                  end;

                                                                  RepairStatusPriority := RepairStatus.Priority;
                                                                  UseLineNo := "Line No.";
                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","Document No.");
                                                                  ServItemLine.SETFILTER("Line No.",'<>%1',"Line No.");
                                                                  ServItemLine.SETFILTER("Repair Status Code",'<>%1','');
                                                                  if ServItemLine.FIND('-') then
                                                                    repeat
                                                                      RepairStatus2.GET(ServItemLine."Repair Status Code");
                                                                      if RepairStatus2.Priority < RepairStatusPriority then begin
                                                                        RepairStatusPriority := RepairStatus2.Priority;
                                                                        UseLineNo := ServItemLine."Line No.";
                                                                      end;
                                                                    until ServItemLine.NEXT = 0;
                                                                  if "Line No." <> UseLineNo then begin
                                                                    ServItemLine.GET("Document Type","Document No.",UseLineNo);
                                                                    RepairStatus.GET(ServItemLine."Repair Status Code");
                                                                  end else
                                                                    RepairStatus.GET("Repair Status Code");
                                                                  ServHeader2.GET("Document Type","Document No.");
                                                                  ServHeader3 := ServHeader2;
                                                                  if ServHeader2.Status <> RepairStatus."Service Order Status" then begin
                                                                    ServHeader2.SetValidatingFromLines(true);
                                                                    if ServHeader2."Finishing Date" = 0D then
                                                                      ServHeader2.VALIDATE("Finishing Date","Finishing Date");
                                                                    ServHeader2.VALIDATE(Status,RepairStatus."Service Order Status");
                                                                    if not (ServHeader2.Status = ServHeader2.Status::Finished) then begin
                                                                      ServHeader2."Finishing Date" := 0D;
                                                                      ServHeader2."Finishing Time" := 000000T;
                                                                      ServHeader2."Service Time (Hours)" := 0;
                                                                    end;
                                                                    ServHeader2.UpdateServiceOrderChangeLog(ServHeader3);
                                                                    ServHeader2.MODIFY;
                                                                    if ServHeader2.Status = ServHeader2.Status::Finished then
                                                                      UpdateStartFinishDateTime("Document Type","Document No.","Line No.","Starting Date","Starting Time",
                                                                        "Finishing Date","Finishing Time",false);
                                                                  end;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Repair Status Code }
    { 10  ;   ;Priority            ;Option        ;CaptionML=ENU=Priority;
                                                   OptionCaptionML=ENU=Low,Medium,High;
                                                   OptionString=Low,Medium,High }
    { 11  ;   ;Response Time (Hours);Decimal      ;OnValidate=BEGIN
                                                                if ("Response Time (Hours)" <> xRec."Response Time (Hours)") or ("Response Time (Hours)" = 0) then begin
                                                                  SkipResponseTimeHrsUpdate := true;
                                                                  GetServHeader;
                                                                  CalculateResponseDateTime(ServHeader."Order Date",ServHeader."Order Time");
                                                                end else
                                                                  UpdateResponseTimeHours;
                                                              END;

                                                   CaptionML=ENU=Response Time (Hours);
                                                   DecimalPlaces=0:5 }
    { 12  ;   ;Response Date       ;Date          ;OnValidate=BEGIN
                                                                SkipResponseTimeHrsUpdate := true;
                                                                if "Response Date" <> xRec."Response Date" then begin
                                                                  GetServHeader;
                                                                  if "Response Date" <> 0D then begin
                                                                    if "Response Date" < ServHeader."Order Date" then
                                                                      ERROR(
                                                                        Text022,
                                                                        FIELDCAPTION("Response Date"),ServHeader.TABLECAPTION,
                                                                        ServHeader.FIELDCAPTION("Order Date"));
                                                                    if "Response Date" = ServHeader."Order Date" then
                                                                      if TIME < ServHeader."Order Time" then
                                                                        "Response Time" := ServHeader."Order Time"
                                                                      else
                                                                        "Response Time" := TIME;
                                                                  end else
                                                                    "Response Time" := 000000T;

                                                                  "Response Time (Hours)" := 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Response Date }
    { 13  ;   ;Response Time       ;Time          ;OnValidate=BEGIN
                                                                SkipResponseTimeHrsUpdate := true;
                                                                if "Response Time" <> xRec."Response Time" then begin
                                                                  GetServHeader;
                                                                  if ("Response Date" = ServHeader."Order Date") and
                                                                     ("Response Time" < ServHeader."Order Time")
                                                                  then
                                                                    ERROR(
                                                                      Text022,
                                                                      FIELDCAPTION("Response Time"),ServHeader.TABLECAPTION,
                                                                      ServHeader.FIELDCAPTION("Order Time"));

                                                                  "Response Time (Hours)" := 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Response Time }
    { 14  ;   ;Starting Date       ;Date          ;OnValidate=BEGIN
                                                                SkipResponseTimeHrsUpdate := true;
                                                                GetServHeader;
                                                                if "Starting Date" <> 0D then begin
                                                                  if "Starting Date" < ServHeader."Order Date" then
                                                                    ERROR(
                                                                      Text022,
                                                                      FIELDCAPTION("Starting Date"),ServHeader.TABLECAPTION,
                                                                      ServHeader.FIELDCAPTION("Order Date"));

                                                                  if ("Starting Date" > ServHeader."Finishing Date") and
                                                                     (ServHeader."Finishing Date" <> 0D)
                                                                  then
                                                                    ERROR(
                                                                      Text018,
                                                                      FIELDCAPTION("Starting Date"),
                                                                      ServHeader.TABLECAPTION,
                                                                      ServHeader.FIELDCAPTION("Finishing Date"));

                                                                  if "Starting Date" <> xRec."Starting Date" then begin
                                                                    "Finishing Date" := 0D;
                                                                    "Finishing Time" := 000000T;
                                                                  end;

                                                                  if ("Starting Date" = ServHeader."Order Date") and
                                                                     (TIME < ServHeader."Order Time")
                                                                  then
                                                                    VALIDATE("Starting Time",ServHeader."Order Time")
                                                                  else
                                                                    VALIDATE("Starting Time",TIME);
                                                                end else begin
                                                                  "Starting Time" := 000000T;
                                                                  VALIDATE("Finishing Date",0D);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Starting Date }
    { 15  ;   ;Starting Time       ;Time          ;OnValidate=BEGIN
                                                                SkipResponseTimeHrsUpdate := true;
                                                                TESTFIELD("Starting Date");
                                                                if "Starting Time" <> 000000T then begin
                                                                  GetServHeader;
                                                                  if ("Starting Date" = ServHeader."Order Date") and
                                                                     ("Starting Time" < ServHeader."Order Time")
                                                                  then
                                                                    ERROR(
                                                                      Text022,
                                                                      FIELDCAPTION("Starting Time"),ServHeader.TABLECAPTION,
                                                                      ServHeader.FIELDCAPTION("Order Time"));

                                                                  if ("Starting Time" > "Finishing Time") and
                                                                     ("Finishing Time" <> 000000T) and
                                                                     ("Starting Date" = "Finishing Date")
                                                                  then
                                                                    ERROR(Text020,
                                                                      FIELDCAPTION("Starting Time"),FIELDCAPTION("Finishing Time"));

                                                                  UpdateStartFinishDateTime("Document Type","Document No.","Line No.","Starting Date",
                                                                    "Starting Time","Finishing Date","Finishing Time",false);
                                                                end else begin
                                                                  "Finishing Date" := 0D;
                                                                  "Finishing Time" := 000000T;
                                                                  UpdateStartFinishDateTime("Document Type","Document No.","Line No.","Starting Date","Starting Time",
                                                                    "Finishing Date","Finishing Time",false);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Starting Time }
    { 16  ;   ;Finishing Date      ;Date          ;OnValidate=BEGIN
                                                                SkipResponseTimeHrsUpdate := true;
                                                                GetServHeader;
                                                                if "Finishing Date" <> 0D then begin
                                                                  if "Finishing Date" < ServHeader."Order Date" then
                                                                    ERROR(
                                                                      Text022,
                                                                      FIELDCAPTION("Finishing Date"),ServHeader.TABLECAPTION,
                                                                      ServHeader.FIELDCAPTION("Order Date"));

                                                                  if "Finishing Date" < "Starting Date" then
                                                                    ERROR(
                                                                      Text019,
                                                                      FIELDCAPTION("Finishing Date"),FIELDCAPTION("Starting Date"));
                                                                  if ("Starting Date" = "Finishing Date") and ("Starting Time" > TIME) then
                                                                    VALIDATE("Finishing Time","Starting Time")
                                                                  else
                                                                    VALIDATE("Finishing Time",TIME);
                                                                  UpdateStartFinishDateTime("Document Type","Document No.","Line No.","Starting Date","Starting Time",
                                                                    "Finishing Date","Finishing Time",false);
                                                                end else begin
                                                                  "Finishing Time" := 000000T;
                                                                  UpdateStartFinishDateTime("Document Type","Document No.","Line No.","Starting Date","Starting Time",
                                                                    "Finishing Date","Finishing Time",false);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Finishing Date }
    { 17  ;   ;Finishing Time      ;Time          ;OnValidate=BEGIN
                                                                SkipResponseTimeHrsUpdate := true;
                                                                TESTFIELD("Finishing Date");
                                                                GetServHeader;
                                                                if "Finishing Time" <> 000000T then begin
                                                                  if ("Finishing Date" = "Starting Date") and
                                                                     ("Finishing Time" < "Starting Time")
                                                                  then
                                                                    ERROR(
                                                                      Text022,
                                                                      FIELDCAPTION("Finishing Time"),
                                                                      FIELDCAPTION("Starting Time"));
                                                                  UpdateStartFinishDateTime("Document Type","Document No.","Line No.","Starting Date","Starting Time",
                                                                    "Finishing Date","Finishing Time",false);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Finishing Time }
    { 18  ;   ;Service Shelf No.   ;Code10        ;TableRelation="Service Shelf";
                                                   CaptionML=ENU=Service Shelf No. }
    { 19  ;   ;Warranty Starting Date (Parts);Date;OnValidate=BEGIN
                                                                if "Service Item No." <> '' then begin
                                                                  ServItem.GET("Service Item No.");
                                                                  if "Warranty Starting Date (Parts)" <> ServItem."Warranty Starting Date (Parts)" then
                                                                    ERROR(Text023,ServItem.TABLECAPTION);
                                                                end;

                                                                if "Warranty Starting Date (Parts)" <> 0D then begin
                                                                  ServMgtSetup.GET;
                                                                  "Warranty Ending Date (Parts)" := CALCDATE(ServMgtSetup."Default Warranty Duration","Warranty Starting Date (Parts)");
                                                                  "Warranty % (Parts)" := ServMgtSetup."Warranty Disc. % (Parts)";
                                                                end else begin
                                                                  "Warranty Ending Date (Parts)" := 0D;
                                                                  "Warranty % (Parts)" := 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Warranty Starting Date (Parts) }
    { 20  ;   ;Warranty Ending Date (Parts);Date  ;OnValidate=BEGIN
                                                                if "Service Item No." <> '' then begin
                                                                  ServItem.GET("Service Item No.");
                                                                  if "Warranty Ending Date (Parts)" <> ServItem."Warranty Ending Date (Parts)" then
                                                                    ERROR(Text023,ServItem.TABLECAPTION);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Warranty Ending Date (Parts) }
    { 21  ;   ;Warranty            ;Boolean       ;OnValidate=BEGIN
                                                                if "Service Item No." = '' then begin
                                                                  GetServHeader;
                                                                  if Warranty then begin
                                                                    if CONFIRM(Text024,true) then begin
                                                                      VALIDATE("Warranty Starting Date (Parts)",ServHeader."Order Date");
                                                                      VALIDATE("Warranty Starting Date (Labor)",ServHeader."Order Date");
                                                                      Warranty := true;
                                                                    end else
                                                                      Warranty := false;
                                                                  end else begin
                                                                    if CONFIRM(Text025,true) then begin
                                                                      VALIDATE("Warranty Starting Date (Parts)",0D);
                                                                      VALIDATE("Warranty Starting Date (Labor)",0D);
                                                                      Warranty := false;
                                                                    end else
                                                                      Warranty := true;
                                                                  end;
                                                                  if ServItemLine.GET("Document Type","Document No.","Line No.") then
                                                                    MODIFY;
                                                                  CheckWarranty(ServHeader."Order Date");
                                                                end else
                                                                  ERROR(Text023,ServItem.TABLECAPTION);
                                                              END;

                                                   CaptionML=ENU=Warranty }
    { 22  ;   ;Warranty % (Parts)  ;Decimal       ;OnValidate=BEGIN
                                                                if "Service Item No." <> '' then
                                                                  ERROR(Text023,ServItem.TABLECAPTION);

                                                                if ("Service Item No." = '') and ("Warranty % (Parts)" <> xRec."Warranty % (Parts)") then begin
                                                                  ServLine.RESET;
                                                                  ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.",Type);
                                                                  ServLine.SETRANGE("Document Type","Document Type");
                                                                  ServLine.SETRANGE("Document No.","Document No.");
                                                                  ServLine.SETRANGE("Service Item Line No.","Line No.");
                                                                  ServLine.SETRANGE(Type,ServLine.Type::Item);
                                                                  if ServLine.FIND('-') then
                                                                    repeat
                                                                      ServLine.VALIDATE("Warranty Disc. %","Warranty % (Parts)");
                                                                      ServLine.MODIFY;
                                                                    until ServLine.NEXT = 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Warranty % (Parts);
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 23  ;   ;Warranty % (Labor)  ;Decimal       ;OnValidate=BEGIN
                                                                if "Service Item No." <> '' then
                                                                  ERROR(Text023,ServItem.TABLECAPTION);

                                                                if ("Service Item No." = '') and ("Warranty % (Labor)" <> xRec."Warranty % (Labor)") then begin
                                                                  ServLine.RESET;
                                                                  ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.",Type);
                                                                  ServLine.SETRANGE("Document Type","Document Type");
                                                                  ServLine.SETRANGE("Document No.","Document No.");
                                                                  ServLine.SETRANGE("Service Item Line No.","Line No.");
                                                                  ServLine.SETRANGE(Type,ServLine.Type::Resource);
                                                                  if ServLine.FIND('-') then
                                                                    repeat
                                                                      ServLine.VALIDATE("Warranty Disc. %","Warranty % (Labor)");
                                                                      ServLine.MODIFY;
                                                                    until ServLine.NEXT = 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Warranty % (Labor);
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 24  ;   ;Warranty Starting Date (Labor);Date;OnValidate=BEGIN
                                                                if "Service Item No." <> '' then begin
                                                                  ServItem.GET("Service Item No.");
                                                                  if "Warranty Starting Date (Labor)" <> ServItem."Warranty Starting Date (Labor)" then
                                                                    ERROR(Text023,ServItem.TABLECAPTION);
                                                                end;

                                                                if "Warranty Starting Date (Labor)" <> 0D then begin
                                                                  ServMgtSetup.GET;
                                                                  "Warranty Ending Date (Labor)" := CALCDATE(ServMgtSetup."Default Warranty Duration","Warranty Starting Date (Labor)");
                                                                  "Warranty % (Parts)" := ServMgtSetup."Warranty Disc. % (Parts)";
                                                                  "Warranty % (Labor)" := ServMgtSetup."Warranty Disc. % (Labor)";
                                                                end else begin
                                                                  "Warranty Ending Date (Labor)" := 0D;
                                                                  "Warranty % (Labor)" := 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Warranty Starting Date (Labor) }
    { 25  ;   ;Warranty Ending Date (Labor);Date  ;OnValidate=BEGIN
                                                                if "Service Item No." <> '' then begin
                                                                  ServItem.GET("Service Item No.");
                                                                  if "Warranty Ending Date (Labor)" <> ServItem."Warranty Ending Date (Labor)" then
                                                                    ERROR(Text023,ServItem.TABLECAPTION);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Warranty Ending Date (Labor) }
    { 26  ;   ;Contract No.        ;Code20        ;TableRelation="Service Contract Header"."Contract No." WHERE ("Contract Type"=CONST(Contract));
                                                   OnValidate=BEGIN
                                                                ServHeader.GET("Document Type","Document No.");
                                                                if (ServHeader."Contract No." <> '') and
                                                                   ("Contract No." <> ServHeader."Contract No.")
                                                                then
                                                                  ERROR(Text048,FIELDCAPTION("Contract No."));

                                                                if ("Service Price Group Code" <> '') and ("Contract No." <> '') then
                                                                  ERROR(Text033);

                                                                ServLine.RESET;
                                                                ServLine.SETRANGE("Document Type","Document Type");
                                                                ServLine.SETRANGE("Document No.","Document No.");
                                                                if "Line No." <> 0 then begin
                                                                  ServLine.SETRANGE("Service Item Line No.","Line No.");
                                                                  ServLine.SETFILTER("Quantity Invoiced",'>0');
                                                                  if ServLine.FIND('-') then
                                                                    ERROR(Text053);
                                                                end;

                                                                if "Contract No." <> '' then begin
                                                                  ServContractLine.RESET;
                                                                  ServContractLine.SETRANGE("Contract Type",ServContractLine."Contract Type"::Contract);
                                                                  ServContractLine.SETRANGE("Contract No.","Contract No.");
                                                                  ServContractLine.SETRANGE("Service Item No.","Service Item No.");
                                                                  if not ServContractLine.FINDFIRST then
                                                                    ERROR(Text049,"Contract No.","Service Item No.");
                                                                  if ServContractLine."Customer No." <> ServHeader."Customer No." then
                                                                    ERROR(Text051,"Contract No.");
                                                                  if ServContractLine."Contract Status" <> ServContractLine."Contract Status"::Signed then
                                                                    ERROR(Text052,"Contract No.");
                                                                  ServHeader.TESTFIELD("Order Date");
                                                                  ServContractLine.ValidateServicePeriod(ServHeader."Order Date");
                                                                  "Contract Line No." := ServContractLine."Line No.";
                                                                end else
                                                                  "Contract Line No." := 0;
                                                                ServLine.SETRANGE("Quantity Invoiced",0);

                                                                if ServLine.FIND('-') and ("Line No." <> 0) then
                                                                  if CONFIRM(Text054,true) then begin
                                                                    MODIFY(true);
                                                                    RecreateServLines(ServLine);
                                                                  end else
                                                                    "Contract No." := xRec."Contract No.";
                                                                UpdateResponseTimeHours;
                                                              END;

                                                   OnLookup=VAR
                                                              ServHeader@1000 : Record "Service Header";
                                                              ServContractLine@1003 : Record "Service Contract Line";
                                                              ServContractList@1001 : Page "Serv. Contr. List (Serv. Item)";
                                                            BEGIN
                                                              ServHeader.GET("Document Type","Document No.");
                                                              if "Contract No." <> '' then begin
                                                                ServContractLine.SETRANGE("Contract Type",ServContractLine."Contract Type"::Contract);
                                                                ServContractLine.SETRANGE("Contract No.","Contract No.");
                                                                if ServContractLine.FINDFIRST then
                                                                  ServContractList.SETRECORD(ServContractLine);
                                                                ServContractLine.RESET;
                                                              end;
                                                              ServContractLine.FILTERGROUP(2);
                                                              ServContractLine.SETRANGE("Contract Type",ServContractLine."Contract Type"::Contract);
                                                              ServContractLine.SETRANGE("Customer No.",ServHeader."Customer No.");
                                                              ServContractLine.SETRANGE("Service Item No.","Service Item No.");
                                                              ServContractLine.SETRANGE("Contract Status",ServContractLine."Contract Status"::Signed);
                                                              ServContractLine.SETFILTER("Starting Date",'<=%1',ServHeader."Order Date");
                                                              ServContractLine.SETFILTER("Contract Expiration Date",'>=%1 | =%2',ServHeader."Order Date",0D);
                                                              ServContractLine.FILTERGROUP(0);
                                                              ServContractList.SETTABLEVIEW(ServContractLine);
                                                              ServContractList.LOOKUPMODE(true);
                                                              if ServContractList.RUNMODAL = ACTION::LookupOK then begin
                                                                ServContractList.GETRECORD(ServContractLine);
                                                                VALIDATE("Contract No.",ServContractLine."Contract No.");
                                                              end;
                                                            END;

                                                   CaptionML=ENU=Contract No. }
    { 27  ;   ;Location of Service Item;Text30    ;FieldClass=FlowField;
                                                   CalcFormula=Lookup("Service Item"."Location of Service Item" WHERE ("No."=FIELD("Service Item No.")));
                                                   CaptionML=ENU=Location of Service Item;
                                                   Editable=false }
    { 28  ;   ;Loaner No.          ;Code20        ;TableRelation=Loaner."No.";
                                                   OnValidate=VAR
                                                                LoanerEntry@1000 : Record "Loaner Entry";
                                                              BEGIN
                                                                if ("Loaner No." = '') and (xRec."Loaner No." <> '') then begin
                                                                  Loaner.GET(xRec."Loaner No.");
                                                                  LoanerEntry.SETRANGE("Document Type","Document Type" + 1);
                                                                  LoanerEntry.SETRANGE("Document No.","Document No.");
                                                                  LoanerEntry.SETRANGE("Loaner No.",xRec."Loaner No.");
                                                                  LoanerEntry.SETRANGE(Lent,true);
                                                                  if not LoanerEntry.ISEMPTY then
                                                                    ERROR(
                                                                      Text026,
                                                                      FIELDCAPTION("Loaner No."))
                                                                end;

                                                                if "Loaner No." <> xRec."Loaner No." then begin
                                                                  LoanerEntry.RESET;
                                                                  LoanerEntry.SETRANGE("Document Type","Document Type" + 1);
                                                                  LoanerEntry.SETRANGE("Document No.","Document No.");
                                                                  LoanerEntry.SETRANGE("Loaner No.",xRec."Loaner No.");
                                                                  LoanerEntry.SETRANGE(Lent,true);
                                                                  if not LoanerEntry.ISEMPTY then begin
                                                                    GetServHeader;
                                                                    ERROR(
                                                                      Text028,
                                                                      FIELDCAPTION("Loaner No."),FORMAT(ServHeader."Document Type"),
                                                                      ServHeader.FIELDCAPTION("No."),ServHeader."No.");
                                                                  end;
                                                                  CheckIfLoanerOnServOrder;
                                                                  if "Line No." <> 0 then
                                                                    LendLoanerWithConfirmation;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Loaner No. }
    { 29  ;   ;Vendor No.          ;Code20        ;TableRelation=Vendor;
                                                   CaptionML=ENU=Vendor No. }
    { 30  ;   ;Vendor Item No.     ;Text20        ;CaptionML=ENU=Vendor Item No. }
    { 31  ;   ;Fault Reason Code   ;Code10        ;TableRelation="Fault Reason Code";
                                                   OnValidate=VAR
                                                                FaultReasonCode@1000 : Record "Fault Reason Code";
                                                                RecR@1001 : RecordRef;
                                                                TypeR@1002 : FieldRef;
                                                                TypeStr@1003 : Text[50];
                                                              BEGIN
                                                                ServLine.RESET;
                                                                ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.");
                                                                ServLine.SETRANGE("Document Type","Document Type");
                                                                ServLine.SETRANGE("Document No.","Document No.");
                                                                ServLine.SETRANGE("Service Item Line No.","Line No.");
                                                                if FaultReasonCode.GET("Fault Reason Code") then begin
                                                                  RecR.GETTABLE(ServLine);
                                                                  TypeR := RecR.FIELDINDEX(ServLine.FIELDNO(Type));
                                                                  TypeStr := TypeR.OPTIONCAPTION;
                                                                  if FaultReasonCode."Exclude Warranty Discount" then begin
                                                                    ServLine.SETFILTER(Type,'%1|%2',ServLine.Type::Cost,ServLine.Type::"G/L Account");
                                                                    if ServLine.FIND('-') then
                                                                      if not CONFIRM(
                                                                           STRSUBSTNO(
                                                                             Text056,
                                                                             TABLECAPTION,
                                                                             FIELDCAPTION("Document No."),"Document No.",
                                                                             FIELDCAPTION("Line No."),"Line No.",
                                                                             ServLine.FIELDCAPTION(Type),
                                                                             SELECTSTR(ServLine.Type::"G/L Account" + 1,TypeStr),
                                                                             SELECTSTR(ServLine.Type::Cost + 1,TypeStr),
                                                                             FaultReasonCode.FIELDCAPTION("Exclude Warranty Discount"),
                                                                             FaultReasonCode.TABLECAPTION,FaultReasonCode.Code),
                                                                           true)
                                                                      then
                                                                        ERROR('');
                                                                    ServLine.SETRANGE(Type,ServLine.Type::Item,ServLine.Type::Resource);
                                                                  end else
                                                                    ServLine.SETRANGE(Type,ServLine.Type::Item,ServLine.Type::"G/L Account");
                                                                end;
                                                                if ServLine.FIND('-') then
                                                                  repeat
                                                                    ServLine.VALIDATE("Fault Reason Code","Fault Reason Code");
                                                                    ServLine.MODIFY;
                                                                  until ServLine.NEXT = 0;
                                                              END;

                                                   CaptionML=ENU=Fault Reason Code }
    { 32  ;   ;Service Price Group Code;Code10    ;TableRelation="Service Price Group";
                                                   OnValidate=VAR
                                                                ServPriceGrSetup@1001 : Record "Serv. Price Group Setup";
                                                                ServPriceMgmt@1000 : Codeunit "Service Price Management";
                                                              BEGIN
                                                                GetServHeader;
                                                                if ("Service Price Group Code" <> '') and
                                                                   (("Contract No." <> '') or (ServHeader."Contract No." <> ''))
                                                                then
                                                                  ERROR(Text033);

                                                                ServLine.RESET;
                                                                ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.",Type);
                                                                ServLine.SETRANGE("Document Type","Document Type");
                                                                ServLine.SETRANGE("Document No.","Document No.");
                                                                ServLine.SETRANGE("Service Item Line No.","Line No.");

                                                                if "Service Price Group Code" <> xRec."Service Price Group Code" then begin
                                                                  ServLine.SETFILTER("Quantity Invoiced",'>0');
                                                                  if ServLine.FIND('-') then
                                                                    ERROR(Text037,FIELDCAPTION("Service Price Group Code"));
                                                                end;

                                                                if CurrFieldNo = FIELDNO("Service Price Group Code") then
                                                                  if CheckServLineExist then begin
                                                                    ServLine.SETRANGE("Price Adjmt. Status",ServLine."Price Adjmt. Status"::Adjusted);
                                                                    if ServLine.FIND('-') then begin
                                                                      if not CONFIRM(STRSUBSTNO(Text038,ServLine.TABLECAPTION),false) then
                                                                        ERROR(Text039);
                                                                      ServPriceMgmt.ResetAdjustedLines(ServLine);
                                                                    end;
                                                                    ServLine.SETRANGE("Price Adjmt. Status");
                                                                  end;

                                                                if "Service Price Group Code" <> '' then begin
                                                                  ServPriceMgmt.GetServPriceGrSetup(ServPriceGrSetup,ServHeader,Rec);
                                                                  "Serv. Price Adjmt. Gr. Code" := ServPriceGrSetup."Serv. Price Adjmt. Gr. Code";
                                                                  "Adjustment Type" := ServPriceGrSetup."Adjustment Type";
                                                                  "Base Amount to Adjust" := ServPriceGrSetup.Amount;
                                                                end else begin
                                                                  "Serv. Price Adjmt. Gr. Code" := '';
                                                                  CLEAR("Adjustment Type");
                                                                  "Base Amount to Adjust" := 0;
                                                                end;

                                                                if ServLine.FIND('-') then
                                                                  repeat
                                                                    ServLine."Service Price Group Code" := "Service Price Group Code";
                                                                    ServLine."Serv. Price Adjmt. Gr. Code" := "Serv. Price Adjmt. Gr. Code";
                                                                    ServLine.MODIFY;
                                                                  until ServLine.NEXT = 0;
                                                              END;

                                                   CaptionML=ENU=Service Price Group Code }
    { 33  ;   ;Fault Area Code     ;Code10        ;TableRelation="Fault Area";
                                                   OnValidate=VAR
                                                                ServPriceMgmt@1000 : Codeunit "Service Price Management";
                                                              BEGIN
                                                                if (CurrFieldNo = FIELDNO("Fault Area Code")) and
                                                                   ("Fault Area Code" <> xRec."Fault Area Code")
                                                                then begin
                                                                  if CheckServLineExist and ("Service Price Group Code" <> '') then begin
                                                                    ServLine.RESET;
                                                                    ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.");
                                                                    ServLine.SETRANGE("Document Type","Document Type");
                                                                    ServLine.SETRANGE("Document No.","Document No.");
                                                                    ServLine.SETRANGE("Service Item Line No.","Line No.");
                                                                    ServLine.SETRANGE("Price Adjmt. Status",ServLine."Price Adjmt. Status"::Adjusted);
                                                                    if ServLine.FIND('-') then begin
                                                                      if not CONFIRM(STRSUBSTNO(Text038,ServLine.TABLECAPTION),false) then
                                                                        ERROR(Text039);
                                                                      ServPriceMgmt.ResetAdjustedLines(ServLine);
                                                                    end;
                                                                  end;
                                                                  VALIDATE("Service Price Group Code");
                                                                  "Fault Code" := '';
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Fault Area Code }
    { 34  ;   ;Symptom Code        ;Code10        ;TableRelation="Symptom Code";
                                                   OnValidate=BEGIN
                                                                if "Symptom Code" <> xRec."Symptom Code" then
                                                                  "Fault Code" := '';
                                                              END;

                                                   CaptionML=ENU=Symptom Code }
    { 35  ;   ;Fault Code          ;Code10        ;TableRelation="Fault Code".Code WHERE ("Fault Area Code"=FIELD("Fault Area Code"),
                                                                                          "Symptom Code"=FIELD("Symptom Code"));
                                                   CaptionML=ENU=Fault Code }
    { 36  ;   ;Resolution Code     ;Code10        ;TableRelation="Resolution Code";
                                                   CaptionML=ENU=Resolution Code }
    { 37  ;   ;Fault Comment       ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Comment Line" WHERE ("Table Name"=CONST("Service Header"),
                                                                                                   "Table Subtype"=FIELD("Document Type"),
                                                                                                   "No."=FIELD("Document No."),
                                                                                                   Type=CONST(Fault),
                                                                                                   "Table Line No."=FIELD("Line No.")));
                                                   CaptionML=ENU=Fault Comment;
                                                   Editable=false }
    { 38  ;   ;Resolution Comment  ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Comment Line" WHERE ("Table Name"=CONST("Service Header"),
                                                                                                   "Table Subtype"=FIELD("Document Type"),
                                                                                                   "No."=FIELD("Document No."),
                                                                                                   Type=CONST(Resolution),
                                                                                                   "Table Line No."=FIELD("Line No.")));
                                                   CaptionML=ENU=Resolution Comment;
                                                   Editable=false }
    { 40  ;   ;Variant Code        ;Code10        ;TableRelation="Item Variant".Code WHERE ("Item No."=FIELD("Item No."));
                                                   OnValidate=BEGIN
                                                                if "Service Item No." <> '' then
                                                                  ERROR(
                                                                    Text016,
                                                                    FIELDCAPTION("Variant Code"),FIELDCAPTION("Service Item No."))
                                                              END;

                                                   CaptionML=ENU=Variant Code }
    { 41  ;   ;Service Item Loaner Comment;Boolean;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Comment Line" WHERE ("Table Name"=CONST("Service Header"),
                                                                                                   "Table Subtype"=FIELD("Document Type"),
                                                                                                   "No."=FIELD("Document No."),
                                                                                                   Type=CONST("Service Item Loaner"),
                                                                                                   "Table Line No."=FIELD("Line No.")));
                                                   CaptionML=ENU=Service Item Loaner Comment;
                                                   Editable=false }
    { 42  ;   ;Actual Response Time (Hours);Decimal;
                                                   CaptionML=ENU=Actual Response Time (Hours);
                                                   DecimalPlaces=0:5 }
    { 43  ;   ;Document Type       ;Option        ;CaptionML=ENU=Document Type;
                                                   OptionCaptionML=ENU=Quote,Order;
                                                   OptionString=Quote,Order;
                                                   Editable=false }
    { 44  ;   ;Serv. Price Adjmt. Gr. Code;Code10 ;TableRelation="Service Price Adjustment Group";
                                                   CaptionML=ENU=Serv. Price Adjmt. Gr. Code;
                                                   Editable=false }
    { 45  ;   ;Adjustment Type     ;Option        ;CaptionML=ENU=Adjustment Type;
                                                   OptionCaptionML=ENU=Fixed,Maximum,Minimum;
                                                   OptionString=Fixed,Maximum,Minimum;
                                                   Editable=false }
    { 46  ;   ;Base Amount to Adjust;Decimal      ;CaptionML=ENU=Base Amount to Adjust;
                                                   Editable=false }
    { 60  ;   ;No. of Active/Finished Allocs;Integer;
                                                   FieldClass=FlowField;
                                                   CalcFormula=Count("Service Order Allocation" WHERE ("Document Type"=FIELD("Document Type"),
                                                                                                       "Document No."=FIELD("Document No."),
                                                                                                       "Service Item Line No."=FIELD("Line No."),
                                                                                                       "Resource No."=FIELD("Resource Filter"),
                                                                                                       "Resource Group No."=FIELD("Resource Group Filter"),
                                                                                                       "Allocation Date"=FIELD("Allocation Date Filter"),
                                                                                                       Status=FILTER(Active|Finished)));
                                                   CaptionML=ENU=No. of Active/Finished Allocs;
                                                   Editable=false }
    { 61  ;   ;No. of Allocations  ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Service Order Allocation" WHERE (Status=FIELD("Allocation Status Filter"),
                                                                                                       "Resource No."=FIELD("Resource Filter"),
                                                                                                       "Resource Group No."=FIELD("Resource Group Filter"),
                                                                                                       "Document Type"=FIELD("Document Type"),
                                                                                                       "Document No."=FIELD("Document No."),
                                                                                                       "Service Item Line No."=FIELD("Line No.")));
                                                   CaptionML=ENU=No. of Allocations;
                                                   Editable=false }
    { 62  ;   ;No. of Previous Services;Integer   ;FieldClass=FlowField;
                                                   CalcFormula=Count("Service Shipment Item Line" WHERE ("Item No."=FIELD("Item No."),
                                                                                                         "Serial No."=FIELD("Serial No.")));
                                                   CaptionML=ENU=No. of Previous Services;
                                                   Editable=false }
    { 63  ;   ;Contract Line No.   ;Integer       ;TableRelation="Service Contract Line"."Line No." WHERE ("Contract Type"=CONST(Contract),
                                                                                                           "Contract No."=FIELD("Contract No."));
                                                   CaptionML=ENU=Contract Line No. }
    { 64  ;   ;Ship-to Code        ;Code10        ;TableRelation="Ship-to Address".Code WHERE ("Customer No."=FIELD("Customer No."));
                                                   CaptionML=ENU=Ship-to Code;
                                                   Editable=false }
    { 65  ;   ;Customer No.        ;Code20        ;TableRelation=Customer."No.";
                                                   CaptionML=ENU=Customer No.;
                                                   Editable=false }
    { 91  ;   ;Date Filter         ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Date Filter }
    { 92  ;   ;Resource Filter     ;Code20        ;FieldClass=FlowFilter;
                                                   TableRelation=Resource;
                                                   CaptionML=ENU=Resource Filter }
    { 93  ;   ;Allocation Date Filter;Date        ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Allocation Date Filter }
    { 94  ;   ;Repair Status Code Filter;Code10   ;FieldClass=FlowFilter;
                                                   TableRelation="Repair Status".Code;
                                                   CaptionML=ENU=Repair Status Code Filter }
    { 96  ;   ;Allocation Status Filter;Option    ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Allocation Status Filter;
                                                   OptionCaptionML=ENU=Nonactive,Active,Finished,Canceled,Reallocation Needed;
                                                   OptionString=Nonactive,Active,Finished,Canceled,"Reallocation Needed" }
    { 97  ;   ;Responsibility Center;Code10       ;TableRelation="Responsibility Center";
                                                   CaptionML=ENU=Responsibility Center;
                                                   Editable=false }
    { 98  ;   ;Service Order Filter;Code20        ;FieldClass=FlowFilter;
                                                   TableRelation="Service Header"."No.";
                                                   CaptionML=ENU=Service Order Filter }
    { 99  ;   ;Resource Group Filter;Code20       ;FieldClass=FlowFilter;
                                                   TableRelation="Resource Group";
                                                   CaptionML=ENU=Resource Group Filter }
    { 100 ;   ;Shortcut Dimension 1 Code;Code20   ;TableRelation="Dimension Value".Code WHERE ("Global Dimension No."=CONST(1),
                                                                                               Blocked=CONST(false));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
                                                              END;

                                                   CaptionML=ENU=Shortcut Dimension 1 Code;
                                                   CaptionClass='1,2,1' }
    { 101 ;   ;Shortcut Dimension 2 Code;Code20   ;TableRelation="Dimension Value".Code WHERE ("Global Dimension No."=CONST(2),
                                                                                               Blocked=CONST(false));
                                                   OnValidate=BEGIN
                                                                ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
                                                              END;

                                                   CaptionML=ENU=Shortcut Dimension 2 Code;
                                                   CaptionClass='1,2,2' }
    { 130 ;   ;Release Status      ;Option        ;CaptionML=ENU=Release Status;
                                                   OptionCaptionML=ENU=Open,Released to Ship;
                                                   OptionString=Open,"Released to Ship" }
    { 480 ;   ;Dimension Set ID    ;Integer       ;TableRelation="Dimension Set Entry";
                                                   OnValidate=BEGIN
                                                                DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
                                                              END;

                                                   OnLookup=BEGIN
                                                              ShowDimensions;
                                                            END;

                                                   CaptionML=ENU=Dimension Set ID;
                                                   Editable=false }
  }
  KEYS
  {
    {    ;"Document Type","Document No.","Line No.";
                                                   Clustered=true }
    {    ;"Document No.","Line No.","Document Type" }
    {    ;"Document Type","Document No.","Service Item No.","Contract No.","Contract Line No.";
                                                   MaintainSQLIndex=false }
    {    ;"Service Item No."                       }
    {    ;"Document Type","Document No.","Response Date","Response Time" }
    {    ;"Response Date","Response Time",Priority }
    {    ;"Loaner No."                             }
    {    ;"Document Type","Document No.","Starting Date","Starting Time";
                                                   MaintainSQLIndex=false }
    {    ;"Document Type","Document No.","Finishing Date","Finishing Time";
                                                   MaintainSQLIndex=false }
    {    ;"Fault Reason Code"                      }
    {    ;"Contract No."                           }
  }
  FIELDGROUPS
  {
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=The %1 allows only one %2 in each %3.';
      Text001@1001 : TextConst 'ENU=You cannot insert %1, because %2 is missing in %3 %4.\\You can create a customer by clicking Functions,Create Customer.';
      Text002@1002 : TextConst 'ENU=You cannot insert %1, because %2 is missing in %3 %4.';
      Text003@1003 : TextConst 'ENU=You have changed one of the fault reporting codes on the %1, but it has not been changed on the existing service lines. You must update the existing service lines manually.';
      Text006@1006 : TextConst 'ENU=You cannot delete %1 %2,%3, because %4 %5 has not been received.';
      Text008@1007 : TextConst 'ENU=You cannot delete %1 %2,%3, because %4 is attached to it.';
      Text010@1008 : TextConst 'ENU=You cannot rename a %1.';
      Text011@1009 : TextConst 'ENU=You cannot change the %1 on the %2, because %3 is attached to it.';
      Text012@1010 : TextConst 'ENU=%1 %2 does not belong to %3 %4.';
      Text016@1014 : TextConst 'ENU=You cannot change the %1 field because it is linked to the %2 specified on the line.';
      Text018@1016 : TextConst 'ENU=The %1 cannot be greater than the %2 %3.';
      Text019@1017 : TextConst 'ENU=The %1 cannot be earlier than the %2.';
      Text020@1018 : TextConst 'ENU=The %1 cannot be greater than the %2.';
      Text022@1020 : TextConst 'ENU=The %1 cannot be earlier than the %2 %3.';
      Text023@1021 : TextConst 'ENU=You cannot change the warranty information because %1 is selected.';
      Text024@1022 : TextConst 'ENU=Do you want to activate a warranty for this service item line?';
      Text025@1023 : TextConst 'ENU=Do you want to deactivate the warranty for this service item line?';
      Text026@1024 : TextConst 'ENU=You cannot reset the %1 field.\You can receive it by clicking Functions, Receive Loaner.';
      Text028@1026 : TextConst '@@@="1%=FIELDCAPTION(""Loaner No.""); 2%=FORMAT(ServHeader.""Document Type""); 3%=ServHeader.FIELDCAPTION(""No.""); 4%=ServHeader.""No."");";ENU=You cannot change the %1, because it has been lent in connection with %2 %3 %4.\\You can receive it by clicking Functions, Receive Loaner.';
      Text029@1027 : TextConst 'ENU=Do you want to lend %1 %2?';
      Text030@1028 : TextConst '@@@="1%=TempServItemLine.FIELDCAPTION(""Loaner No.""); 2%=TempServItemLine.""Loaner No.""; 3%=FORMAT(ServHeader.""Document Type""); 4%=ServHeader.FIELDCAPTION(""No.""); 5%=ServHeader.""No."");";ENU=%1 %2 has already been lent within %3 %4 %5.';
      ServMgtSetup@1035 : Record "Service Mgt. Setup";
      ServOrderAlloc@1031 : Record "Service Order Allocation";
      ServItem@1032 : Record "Service Item";
      ServContract@1033 : Record "Service Contract Header";
      ServLine@1034 : Record "Service Line";
      ServItemLine@1036 : Record "Service Item Line";
      ServHour@1037 : Record "Service Hour";
      ServHour2@1038 : Record "Service Hour";
      ServHeader@1039 : Record "Service Header";
      ServHeader2@1066 : Record "Service Header";
      ServHeader3@1068 : Record "Service Header";
      ServCommentLine@1040 : Record "Service Comment Line";
      ServItemGr@1041 : Record "Service Item Group";
      RepairStatus@1042 : Record "Repair Status";
      RepairStatus2@1063 : Record "Repair Status";
      Loaner@1044 : Record Loaner;
      ServContractLine@1043 : Record "Service Contract Line";
      Item@1047 : Record Item;
      ServLogMgt@1049 : Codeunit ServLogManagement;
      ServOrderAllocMgt@1050 : Codeunit ServAllocationManagement;
      ServOrderMgt@1051 : Codeunit ServOrderManagement;
      SegManagement@1052 : Codeunit SegManagement;
      ServLoanerMgt@1053 : Codeunit ServLoanerManagement;
      DimMgt@1087 : Codeunit DimensionManagement;
      NoOfRec@1054 : Integer;
      TempDay@1055 : Integer;
      FirstServItemLine@1056 : Boolean;
      TempDate@1057 : Date;
      Text033@1059 : TextConst 'ENU=A service item line cannot belong to a service contract and to a service price group at the same time.';
      Text035@1061 : TextConst 'ENU=The %1 %2 cannot be used in service orders.';
      Text036@1062 : TextConst 'ENU=The %1 %2 cannot be used in service quotes.';
      RepairStatusPriority@1065 : Integer;
      UseLineNo@1064 : Integer;
      Text037@1069 : TextConst 'ENU=It is not possible to select %1 because some linked service lines have been posted.';
      LoanerLent@1004 : Boolean;
      ServContractExist@1071 : Boolean;
      Text038@1070 : TextConst 'ENU=Price adjustment on each existing %1 will be cancelled. Continue?';
      Text039@1046 : TextConst 'ENU=The update has been interrupted to respect the warning.';
      HideDialogBox@1072 : Boolean;
      Text040@1073 : TextConst 'ENU=The selected %1 has a different %2 for this %3.\\Do you want to continue?';
      Text041@1074 : TextConst '@@@="1%=ServHour.FIELDCAPTION(""Starting Time""); 2%=ServHour.Day; 3%=Text058=''Service Hours''; %4=ServHour.FIELDCAPTION(""Service Contract No."");%5=""Contract No."");";ENU=You must specify %1 on %2 in the %3 window for the %4 %5.';
      Text042@1075 : TextConst 'ENU=You must specify %1 on %2 in the %3 window.';
      Text043@1076 : TextConst '@@@="3%=FIELDCAPTION(""Starting Date""); 4%=ServHour.""Starting Date""; 6%=ServHour.FIELDCAPTION(""Service Contract No.""); 7%=""Contract No."");";ENU=You must specify %1 on %2, %3 %4 in the %5 window for the %6 %7.';
      Text044@1077 : TextConst '@@@="1%=ServHour.FIELDCAPTION(""Starting Time""); 2%=ServHour.Day; 3%=ServHour.FIELDCAPTION(""Starting Date""); 4%=ServHour.""Starting Date""; 5%=Text057=''Default Service Hours'';";ENU=You must specify %1 on %2, %3 %4 in the %5 window.';
      Text045@1078 : TextConst 'ENU=The %1 for this %2 occurs in more than 1 year. Please verify the setting for service hours and the %3 for the %4.';
      Text047@1080 : TextConst 'ENU=Service item %1 is included in more than one contract.\\Do you want to assign a contract number to the service order line?';
      Text048@1011 : TextConst 'ENU=You cannot change the %1 because it has already been set on the header.';
      Text049@1012 : TextConst 'ENU=Contract %1 does not include service item %2.';
      Text050@1013 : TextConst 'ENU=Service contract %1 specified on the service order header does not include service item %2.';
      Text051@1081 : TextConst 'ENU=You cannot select contract %1 because it is owned by another customer.';
      Text052@1082 : TextConst 'ENU=Contract %1 is not signed.';
      Text053@1083 : TextConst 'ENU=You cannot change the contract number because some of the service lines have already been posted.';
      Text054@1084 : TextConst 'ENU=If you change the contract number, the existing service lines for this order line will be re-created.\Do you want to continue?';
      UseServItemLineAsxRec@1079 : Boolean;
      SkipResponseTimeHrsUpdate@1085 : Boolean;
      Text055@1086 : TextConst '@@@="2%=FIELDCAPTION(""Loaner No.""); 3%=""Loaner No."";";ENU=You cannot change the %1 because %2 %3 has not been received.';
      Text056@1048 : TextConst 'ENU=One or more service lines of %6 %7 and/or %8 exist for %1, %2 %3, %4 %5. There is a check mark in the %9 field of %10 %11, therefore %10 %11 cannot be applied to service line of %6 %7 and/or %8.\\ Do you want to apply it for other service lines?';
      Text057@1102601000 : TextConst 'ENU=Default Service Hours';
      Text058@1102601001 : TextConst 'ENU=Service Hours';
      Text059@1102601002 : TextConst 'ENU=Default warranty duration is negative. The warranty cannot be activated.';
      Text060@1015 : TextConst 'ENU=You may have changed a dimension.\\Do you want to update the lines?';

    [External]
    PROCEDURE SetUpNewLine@7();
    BEGIN
      if ServHeader.GET("Document Type","Document No.") then begin
        "Document Type" := ServHeader."Document Type";
        RepairStatus.RESET;
        RepairStatus.Initial := true;
        "Repair Status Code" := RepairStatus.ReturnStatusCode(RepairStatus);
      end;
    END;

    [External]
    PROCEDURE SetServHeader@8(VAR NewServHeader@1000 : Record "Service Header");
    BEGIN
      ServHeader := NewServHeader;
    END;

    LOCAL PROCEDURE GetServHeader@6();
    BEGIN
      if ServHeader."No." <> "Document No." then
        ServHeader.GET("Document Type","Document No.");
    END;

    [External]
    PROCEDURE CheckWarranty@3(Date@1000 : Date);
    VAR
      WarrantyLabor@1001 : Boolean;
      WarrantyParts@1002 : Boolean;
    BEGIN
      if "Warranty Starting Date (Parts)" > "Warranty Ending Date (Parts)" then begin
        VALIDATE("Warranty Starting Date (Parts)",0D);
        VALIDATE("Warranty Starting Date (Labor)",0D);
        ERROR(Text059);
      end;

      if ((Date >= "Warranty Starting Date (Parts)") and (Date <= "Warranty Ending Date (Parts)")) or
         ((Date >= "Warranty Starting Date (Labor)") and (Date <= "Warranty Ending Date (Labor)"))
      then
        Warranty := true
      else
        Warranty := false;

      WarrantyParts := (Date >= "Warranty Starting Date (Parts)") and (Date <= "Warranty Ending Date (Parts)");
      WarrantyLabor := (Date >= "Warranty Starting Date (Labor)") and (Date <= "Warranty Ending Date (Labor)");
      ServLine.RESET;
      ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.");
      ServLine.SETRANGE("Document Type","Document Type");
      ServLine.SETRANGE("Document No.","Document No.");
      ServLine.SETRANGE("Service Item Line No.","Line No.");

      ServLine.SETFILTER("Quantity Invoiced",'=0');

      if ServLine.FIND('-') then
        repeat
          if ServLine.Type = ServLine.Type::Item then begin
            if ServLine."Warranty Disc. %" <> "Warranty % (Parts)" then
              ServLine.VALIDATE("Warranty Disc. %","Warranty % (Parts)");
            if WarrantyParts then begin
              ServLine.Warranty := WarrantyParts;
              ServLine.VALIDATE("Fault Reason Code");
              ServLine.VALIDATE(Warranty);
            end else begin
              ServLine.Warranty := false;
              ServLine."Exclude Warranty" := false;
            end;
          end;
          if ServLine.Type = ServLine.Type::Resource then begin
            if ServLine."Warranty Disc. %" <> "Warranty % (Labor)" then
              ServLine.VALIDATE("Warranty Disc. %","Warranty % (Labor)");
            if WarrantyLabor then begin
              ServLine.Warranty := WarrantyLabor;
              ServLine.VALIDATE("Fault Reason Code");
              ServLine.VALIDATE(Warranty);
            end else begin
              ServLine.Warranty := false;
              ServLine."Exclude Warranty" := false;
            end;
          end;
          ServLine.MODIFY;
        until ServLine.NEXT = 0;
    END;

    LOCAL PROCEDURE CheckIfLoanerOnServOrder@5();
    VAR
      ServItemLine@1000 : Record "Service Item Line";
    BEGIN
      LoanerLent := false;
      if "Loaner No." <> '' then begin
        ServItemLine.RESET;
        ServItemLine.SETCURRENTKEY("Loaner No.");
        ServItemLine.SETRANGE("Loaner No.","Loaner No.");
        if ServItemLine.FIND('-') then
          if (ServItemLine."Document Type" <> "Document Type") or
             (ServItemLine."Document No." <> "Document No.") or
             (ServItemLine."Line No." <> "Line No.")
          then
            LoanerLent := true
          else
            if ServItemLine.NEXT <> 0 then
              LoanerLent := true;

        if LoanerLent then begin
          ServHeader.GET(
            ServItemLine."Document Type",ServItemLine."Document No.");

          ERROR(
            Text030,
            ServItemLine.FIELDCAPTION("Loaner No."),ServItemLine."Loaner No.",
            FORMAT(ServHeader."Document Type"),ServHeader.FIELDCAPTION("No."),
            ServHeader."No.");
        end;
      end;
    END;

    [External]
    PROCEDURE CalculateResponseDateTime@1(OrderDate@1000 : Date;OrderTime@1001 : Time);
    VAR
      CalChange@1007 : Record "Customized Calendar Change";
      CalendarMgmt@1008 : Codeunit "Calendar Management";
      TotTime@1002 : Decimal;
      LastTotTime@1003 : Decimal;
      HoursLeft@1004 : Decimal;
      HoursOnLastDay@1005 : Decimal;
      Holiday@1006 : Boolean;
      CalendarCustomized@1010 : Boolean;
      NewDescription@1009 : Text[50];
      ContractServHourExist@1011 : Boolean;
      ErrorDate@1012 : Date;
      WholeResponseDays@1013 : Integer;
      StartingTime@1014 : Time;
    BEGIN
      ServMgtSetup.GET;
      ServMgtSetup.TESTFIELD("Base Calendar Code");
      CalendarCustomized :=
        CalendarMgmt.CustomizedChangesExist(CalChange."Source Type"::Service,'','',ServMgtSetup."Base Calendar Code");

      ServHour.RESET;
      if "Contract No." <> '' then begin
        if CheckIfServHourExist("Contract No.") then begin
          ContractServHourExist := true;
          ServHour.SETRANGE("Service Contract Type",ServHour."Service Contract Type"::Contract);
          ServHour.SETRANGE("Service Contract No.","Contract No.")
        end else begin
          ServHour.SETRANGE("Service Contract Type",ServHour."Service Contract Type"::" ");
          ServHour.SETRANGE("Service Contract No.",'')
        end;
      end else
        ServHour.SETRANGE("Service Contract No.",'');

      HoursLeft := "Response Time (Hours)";

      if not ServHour.FINDFIRST then begin
        WholeResponseDays := HoursLeft div 24;
        HoursOnLastDay := HoursLeft - WholeResponseDays * 24;
        if CalendarMgmt.CalcTimeDelta(OrderTime,000000T) / 3600000 + HoursOnLastDay >= 24 then begin
          WholeResponseDays := WholeResponseDays + 1;
          HoursOnLastDay := HoursOnLastDay - 24;
        end;
        "Response Date" := OrderDate + WholeResponseDays;
        "Response Time" := OrderTime + HoursOnLastDay * 3600000;
        exit;
      end;
      if OrderDate = 0D then
        exit;
      TotTime := 0;
      LastTotTime := 0;
      TempDate := OrderDate;
      ErrorDate := OrderDate + 365;
      HoursLeft := HoursLeft * 3600000;

      repeat
        TempDay := DATE2DWY(TempDate,1) - 1;
        HoursOnLastDay := 0;
        ServHour.SETFILTER("Starting Date",'<=%1',TempDate);
        ServHour.SETRANGE(Day,TempDay);
        if ServHour.FINDLAST then begin
          if ServHour."Valid on Holidays" then
            Holiday := false
          else begin
            if CalendarCustomized then
              Holiday :=
                CalendarMgmt.CheckCustomizedDateStatus(
                  CalChange."Source Type"::Service,'','',ServMgtSetup."Base Calendar Code",TempDate,NewDescription)
            else
              Holiday := CalendarMgmt.CheckDateStatus(ServMgtSetup."Base Calendar Code",TempDate,NewDescription);
          end;
          if not Holiday then begin
            if TempDate = OrderDate then begin
              if OrderTime < ServHour."Ending Time" then begin
                if OrderTime >= ServHour."Starting Time" then
                  StartingTime := OrderTime
                else
                  StartingTime := ServHour."Starting Time";

                if HoursLeft > CalendarMgmt.CalcTimeDelta(ServHour."Ending Time",StartingTime) then begin
                  TotTime := TotTime + CalendarMgmt.CalcTimeDelta(ServHour."Ending Time",StartingTime);
                  HoursOnLastDay := CalendarMgmt.CalcTimeDelta(ServHour."Ending Time",StartingTime);
                end else begin
                  TotTime := TotTime + HoursLeft;
                  HoursOnLastDay := HoursLeft;
                end;
              end;
            end else begin
              if ServHour."Starting Time" = 000000T then begin
                if ("Contract No." <> '') and ContractServHourExist then begin
                  if ServHour."Starting Date" <> 0D then
                    ERROR(
                      Text043,
                      FIELDCAPTION("Starting Time"),
                      ServHour.Day,
                      FIELDCAPTION("Starting Date"),
                      ServHour."Starting Date",
                      Text058,
                      ServHour.FIELDCAPTION("Service Contract No."),
                      "Contract No.");

                  ERROR(
                    Text041,
                    ServHour.FIELDCAPTION("Starting Time"),
                    ServHour.Day,
                    Text058,
                    ServHour.FIELDCAPTION("Service Contract No."),
                    "Contract No.");
                end;
                if ServHour."Starting Date" <> 0D then
                  ERROR(
                    Text044,
                    ServHour.FIELDCAPTION("Starting Time"),
                    ServHour.Day,
                    ServHour.FIELDCAPTION("Starting Date"),
                    ServHour."Starting Date",
                    Text057);

                ERROR(
                  Text042,
                  FIELDCAPTION("Starting Time"),
                  ServHour.Day,
                  Text057)
                ;
              end;

              if ServHour."Ending Time" = 000000T then begin
                if ("Contract No." <> '') and ContractServHourExist then begin
                  if ServHour."Starting Date" <> 0D then
                    ERROR(
                      Text043,
                      ServHour.FIELDCAPTION("Ending Time"),
                      ServHour.Day,
                      ServHour.FIELDCAPTION("Starting Date"),
                      ServHour."Starting Date",
                      Text058,
                      ServHour.FIELDCAPTION("Service Contract No."),
                      "Contract No.");

                  ERROR(
                    Text041,
                    ServHour.FIELDCAPTION("Ending Time"),
                    ServHour.Day,
                    Text058,
                    ServHour.FIELDCAPTION("Service Contract No."),
                    "Contract No.");
                end;
                CheckServHourStartingDate(ServHour);
                ERROR(
                  Text042,
                  ServHour.FIELDCAPTION("Ending Time"),
                  ServHour.Day,
                  Text057)
                ;
              end;

              if HoursLeft > CalendarMgmt.CalcTimeDelta(ServHour."Ending Time",ServHour."Starting Time") then begin
                TotTime := TotTime + CalendarMgmt.CalcTimeDelta(ServHour."Ending Time",ServHour."Starting Time");
                HoursOnLastDay := CalendarMgmt.CalcTimeDelta(ServHour."Ending Time",ServHour."Starting Time");
              end else begin
                TotTime := TotTime + HoursLeft;
                HoursOnLastDay := HoursLeft;
              end;
            end;
            if LastTotTime < TotTime then begin
              HoursLeft := HoursLeft - (TotTime - LastTotTime);
              LastTotTime := TotTime;
            end;
          end;
        end;
        TempDate := TempDate + 1;
      until (HoursLeft <= 0) or (TempDate > ErrorDate);

      CheckTempDateErrorDate(TempDate,ErrorDate,ServItem.FIELDCAPTION("Response Time (Hours)"),ServItem.TABLECAPTION);

      if TotTime > 0 then begin
        "Response Date" := TempDate - 1;
        if ("Response Date" = OrderDate) and (OrderTime > ServHour."Starting Time") then
          "Response Time" := OrderTime + HoursOnLastDay
        else
          "Response Time" := ServHour."Starting Time" + HoursOnLastDay;
      end else begin
        "Response Date" := OrderDate;
        "Response Time" := OrderTime;
      end;
    END;

    LOCAL PROCEDURE CheckServLineExist@9() : Boolean;
    BEGIN
      if "Line No." = 0 then
        exit(false);
      ServLine.RESET;
      ServLine.SETCURRENTKEY("Document Type","Document No.","Service Item Line No.",Type);
      ServLine.SETRANGE("Document Type","Document Type");
      ServLine.SETRANGE("Document No.","Document No.");
      ServLine.SETRANGE("Service Item Line No.","Line No.");
      exit(ServLine.FIND('-'));
    END;

    LOCAL PROCEDURE CheckIfServHourExist@2(ContractNo@1000 : Code[20]) : Boolean;
    BEGIN
      if ContractNo = '' then
        exit(false);
      ServHour2.RESET;
      ServHour2.SETRANGE("Service Contract Type",ServHour."Service Contract Type"::Contract);
      ServHour2.SETRANGE("Service Contract No.",ContractNo);
      exit(ServHour2.FINDFIRST);
    END;

    LOCAL PROCEDURE UpdateStartFinishDateTime@12(DocumentType@1007 : Integer;DocumentNo@1000 : Code[20];LineNo@1001 : Integer;StartingDate@1002 : Date;StartingTime@1003 : Time;FinishingDate@1004 : Date;FinishingTime@1005 : Time;Erasing@1006 : Boolean);
    VAR
      ServOrderMgt@1009 : Codeunit ServOrderManagement;
      GoOut@1010 : Boolean;
      Modifyheader@1011 : Boolean;
    BEGIN
      if not ServHeader3.GET(DocumentType,DocumentNo) then
        exit;

      ServItemLine.RESET;
      ServItemLine.SETCURRENTKEY("Document Type","Document No.","Starting Date");
      ServItemLine.SETRANGE("Document Type",ServHeader3."Document Type");
      ServItemLine.SETRANGE("Document No.",ServHeader3."No.");
      ServItemLine.SETFILTER("Starting Date",'<>%1',0D);
      ServItemLine.SETFILTER("Line No.",'<> %1',LineNo);
      if ServItemLine.FIND('-') then begin
        if Erasing then begin
          StartingDate := ServItemLine."Starting Date";
          StartingTime := ServItemLine."Starting Time";
        end;
        repeat
          if ServItemLine."Starting Date" < StartingDate then begin
            StartingDate := ServItemLine."Starting Date";
            StartingTime := ServItemLine."Starting Time";
          end else
            if (ServItemLine."Starting Date" = StartingDate) and
               (ServItemLine."Starting Time" < StartingTime)
            then
              StartingTime := ServItemLine."Starting Time";
        until ServItemLine.NEXT = 0
      end else
        GoOut := true;

      if not GoOut then begin
        ServItemLine.RESET;
        ServItemLine.SETCURRENTKEY("Document Type","Document No.","Finishing Date");
        ServItemLine.ASCENDING(false);
        ServItemLine.SETRANGE("Document Type",ServHeader3."Document Type");
        ServItemLine.SETRANGE("Document No.",ServHeader3."No.");
        ServItemLine.SETFILTER("Finishing Date",'<>%1',0D);
        ServItemLine.SETFILTER("Line No.",'<> %1',LineNo);
        if ServItemLine.FIND('-') then
          repeat
            if ServItemLine."Finishing Date" > FinishingDate then begin
              FinishingDate := ServItemLine."Finishing Date";
              FinishingTime := ServItemLine."Finishing Time";
            end else
              if (ServItemLine."Finishing Date" = FinishingDate) and
                 (ServItemLine."Finishing Time" > FinishingTime)
              then
                FinishingTime := ServItemLine."Finishing Time";
          until ServItemLine.NEXT = 0;
      end else
        if Erasing then begin
          StartingDate := 0D;
          StartingTime := 000000T;
          FinishingDate := 0D;
          FinishingTime := 000000T;
        end;

      Modifyheader := false;
      ServHeader3.CALCFIELDS("Contract Serv. Hours Exist");
      if (ServHeader3."Starting Date" <> StartingDate) or
         ((ServHeader3."Starting Date" = StartingDate) and
          (ServHeader3."Starting Time" <> StartingTime))
      then begin
        ServHeader3."Starting Date" := StartingDate;
        ServHeader3."Starting Time" := StartingTime;
        if StartingDate <> 0D then
          ServHeader3."Actual Response Time (Hours)" :=
            ServOrderMgt.CalcServTime(
              ServHeader3."Order Date",ServHeader3."Order Time",StartingDate,StartingTime,
              ServHeader3."Contract No.",ServHeader3."Contract Serv. Hours Exist")
        else
          ServHeader3."Actual Response Time (Hours)" := 0;
        Modifyheader := true;
      end;

      if ((ServHeader3.Status = ServHeader3.Status::Finished) or
          GoOut) and
         ((ServHeader3."Finishing Date" <> FinishingDate) or
          ((ServHeader3."Finishing Date" = FinishingDate) and
           (ServHeader3."Finishing Time" <> FinishingTime)))
      then begin
        ServHeader3."Finishing Date" := FinishingDate;
        ServHeader3."Finishing Time" := FinishingTime;
        ServHeader3."Service Time (Hours)" :=
          ServOrderMgt.CalcServTime(
            StartingDate,StartingTime,FinishingDate,FinishingTime,
            ServHeader3."Contract No.",ServHeader3."Contract Serv. Hours Exist");
        Modifyheader := true;
      end;

      if Modifyheader then
        ServHeader3.MODIFY;
    END;

    [External]
    PROCEDURE AssistEditSerialNo@10();
    VAR
      ItemLedgEntry@1000 : Record "Item Ledger Entry";
    BEGIN
      CLEAR(ItemLedgEntry);
      GetServHeader;
      ItemLedgEntry.SETCURRENTKEY("Source Type","Source No.","Item No.","Variant Code");
      ItemLedgEntry.SETRANGE("Source Type",ItemLedgEntry."Source Type"::Customer);
      ItemLedgEntry.SETRANGE("Source No.",ServHeader."Customer No.");
      if "Item No." <> '' then
        ItemLedgEntry.SETRANGE("Item No.","Item No.");
      if "Variant Code" <> '' then
        ItemLedgEntry.SETRANGE("Variant Code","Variant Code");
      ItemLedgEntry.SETFILTER("Serial No.",'<>%1','');
      if PAGE.RUNMODAL(0,ItemLedgEntry) = ACTION::LookupOK then begin
        if "Item No." = '' then begin
          if Description + "Description 2" = '' then begin
            Item.GET(ItemLedgEntry."Item No.");
            Description := Item.Description;
            "Description 2" := Item."Description 2";
          end;
          VALIDATE("Item No.",ItemLedgEntry."Item No.");
        end;
        VALIDATE("Serial No.",ItemLedgEntry."Serial No.");
      end;
    END;

    [External]
    PROCEDURE SetHideDialogBox@4(DialogBoxVar@1000 : Boolean);
    BEGIN
      HideDialogBox := DialogBoxVar;
    END;

    LOCAL PROCEDURE GetItemTranslation@42() : Boolean;
    VAR
      ItemTranslation@1000 : Record "Item Translation";
    BEGIN
      GetServHeader;
      if not ItemTranslation.GET("Item No.","Variant Code",ServHeader."Language Code") then
        exit(false);

      Description := ItemTranslation.Description;
      "Description 2" := ItemTranslation."Description 2";

      exit(true);
    END;

    [External]
    PROCEDURE ShowComments@11(Type@1000 : 'General,Fault,Resolution,Accessory,Internal,"Service Item Loaner"');
    BEGIN
      ServHeader.GET("Document Type","Document No.");
      ServHeader.TESTFIELD("Customer No.");
      TESTFIELD("Line No.");

      ServCommentLine.RESET;
      ServCommentLine.SETRANGE("Table Name",ServCommentLine."Table Name"::"Service Header");
      ServCommentLine.SETRANGE("Table Subtype","Document Type");
      ServCommentLine.SETRANGE("No.","Document No.");
      case Type of
        Type::Fault:
          ServCommentLine.SETRANGE(Type,ServCommentLine.Type::Fault);
        Type::Resolution:
          ServCommentLine.SETRANGE(Type,ServCommentLine.Type::Resolution);
        Type::Accessory:
          ServCommentLine.SETRANGE(Type,ServCommentLine.Type::Accessory);
        Type::Internal:
          ServCommentLine.SETRANGE(Type,ServCommentLine.Type::Internal);
        Type::"Service Item Loaner":
          ServCommentLine.SETRANGE(Type,ServCommentLine.Type::"Service Item Loaner");
      end;
      ServCommentLine.SETRANGE("Table Line No.","Line No.");
      PAGE.RUNMODAL(PAGE::"Service Comment Sheet",ServCommentLine);
    END;

    LOCAL PROCEDURE RecreateServLines@14(VAR ServLine2@1000 : Record "Service Line");
    VAR
      TempServLine@1001 : TEMPORARY Record "Service Line";
    BEGIN
      if ServLine2.FIND('-') then begin
        ServLine2.LOCKTABLE;
        repeat
          TempServLine := ServLine2;
          TempServLine.INSERT;
        until ServLine2.NEXT = 0;

        TempServLine.FIND('-');

        repeat
          ServLine2.GET(TempServLine."Document Type",TempServLine."Document No.",TempServLine."Line No.");
          ServLine2.SetHideReplacementDialog(true);
          if TempServLine."No." <> '' then begin
            ServLine.SetHideCostWarning(true);
            ServLine2.VALIDATE("No.",TempServLine."No.");
            ServLine2."Spare Part Action" := TempServLine."Spare Part Action";
            ServLine2."Component Line No." := TempServLine."Component Line No.";
            ServLine2."Replaced Item No." := TempServLine."Replaced Item No.";
            if TempServLine.Quantity <> 0 then
              ServLine2.VALIDATE(Quantity,TempServLine.Quantity);
            ServLine2."Location Code" := TempServLine."Location Code";
            if ServLine2.Type <> ServLine2.Type::" " then begin
              if ServLine2.Type = ServLine2.Type::Item then begin
                ServLine2.VALIDATE("Variant Code",TempServLine."Variant Code");
                if ServLine2."Location Code" <> '' then
                  ServLine2."Bin Code" := TempServLine."Bin Code";
              end;
              ServLine2.VALIDATE("Unit of Measure Code",TempServLine."Unit of Measure Code");
              ServLine2."Fault Reason Code" := TempServLine."Fault Reason Code";
              ServLine2."Exclude Warranty" := TempServLine."Exclude Warranty";
              ServLine2."Exclude Contract Discount" := TempServLine."Exclude Contract Discount";
              ServLine2.VALIDATE(Warranty,TempServLine.Warranty);
            end;
            ServLine2.Description := TempServLine.Description;
            ServLine2."Description 2" := TempServLine."Description 2";
          end;
          ServLine2.MODIFY(true);
        until TempServLine.NEXT = 0;
        TempServLine.DELETEALL;
      end;
    END;

    LOCAL PROCEDURE CalculateDates@21();
    BEGIN
      if ServHeader."Order Date" > WORKDATE then begin
        if "Starting Date" = 0D then begin
          "Starting Date" := ServHeader."Order Date";
          "Starting Time" := ServHeader."Order Time";
        end;
        "Finishing Date" := "Starting Date";
        VALIDATE("Finishing Time","Starting Time");
      end else begin
        if "Starting Date" = 0D then begin
          "Starting Date" := WORKDATE;
          "Starting Time" := TIME;
        end;
        if WORKDATE < "Starting Date" then begin
          "Finishing Date" := "Starting Date";
          VALIDATE("Finishing Time","Starting Time");
        end else begin
          "Finishing Date" := WORKDATE;
          if ("Starting Date" = "Finishing Date") and ("Starting Time" > TIME) then
            VALIDATE("Finishing Time","Starting Time")
          else
            VALIDATE("Finishing Time",TIME);
        end;
      end;
    END;

    LOCAL PROCEDURE CalculateResponseTimeHours@13() : Decimal;
    BEGIN
      if "Contract No." <> '' then begin
        if "Service Item No." <> '' then begin
          ServContractLine.RESET;
          ServContractLine.SETRANGE("Contract Type",ServContractLine."Contract Type"::Contract);
          ServContractLine.SETRANGE("Contract No.","Contract No.");
          ServContractLine.SETRANGE("Service Item No.","Service Item No.");
          if ServContractLine.FINDFIRST then
            if ServContractLine."Response Time (Hours)" > 0 then
              exit(ServContractLine."Response Time (Hours)");
        end;

        if ServContract.GET(ServContract."Contract Type"::Contract,"Contract No.") then
          if ServContract."Response Time (Hours)" > 0 then
            exit(ServContract."Response Time (Hours)");
      end;

      if "Service Item No." <> '' then
        if ServItem.GET("Service Item No.") then
          if ServItem."Response Time (Hours)" > 0 then
            exit(ServItem."Response Time (Hours)");

      if "Service Item Group Code" <> '' then
        if ServItemGr.GET("Service Item Group Code") then
          if ServItemGr."Default Response Time (Hours)" <> 0 then
            exit(ServItemGr."Default Response Time (Hours)");

      ServMgtSetup.GET;
      exit(ServMgtSetup."Default Response Time (Hours)");
    END;

    [External]
    PROCEDURE UpdateResponseTimeHours@15();
    BEGIN
      if not SkipResponseTimeHrsUpdate then begin
        if "Response Time (Hours)" <> xRec."Response Time (Hours)" then
          VALIDATE("Response Time (Hours)",CalculateResponseTimeHours)
        else
          if "Response Date" = 0D then
            VALIDATE("Response Time (Hours)",CalculateResponseTimeHours)
          else
            "Response Time (Hours)" := CalculateResponseTimeHours;
        SkipResponseTimeHrsUpdate := false
      end;
    END;

    [External]
    PROCEDURE UpdateServiceOrderChangeLog@16(VAR OldServItemLine@1000 : Record "Service Item Line");
    BEGIN
      if "Response Date" <> OldServItemLine."Response Date" then
        ServLogMgt.ServItemLineResponseDateChange(Rec,OldServItemLine);

      if "Response Time" <> OldServItemLine."Response Time" then
        ServLogMgt.ServItemLineResponseTimeChange(Rec,OldServItemLine);

      if "Repair Status Code" <> OldServItemLine."Repair Status Code" then
        ServLogMgt.ServHeaderRepairStatusChange(Rec,OldServItemLine);
    END;

    [External]
    PROCEDURE CreateDim@26(Type1@1007 : Integer;No1@1005 : Code[20];Type2@1004 : Integer;No2@1003 : Code[20];Type3@1009 : Integer;No3@1002 : Code[20]);
    VAR
      SourceCodeSetup@1006 : Record "Source Code Setup";
      TableID@1001 : ARRAY [10] OF Integer;
      No@1000 : ARRAY [10] OF Code[20];
    BEGIN
      SourceCodeSetup.GET;

      if "Document No." = '' then
        exit;

      GetServHeader;

      TableID[1] := Type1;
      No[1] := No1;
      TableID[2] := Type2;
      No[2] := No2;
      TableID[3] := Type3;
      No[3] := No3;

      "Shortcut Dimension 1 Code" := '';
      "Shortcut Dimension 2 Code" := '';

      "Dimension Set ID" :=
        DimMgt.GetRecDefaultDimID(
          Rec,CurrFieldNo,TableID,No,SourceCodeSetup."Service Management",
          "Shortcut Dimension 1 Code","Shortcut Dimension 2 Code",ServHeader."Dimension Set ID",DATABASE::"Service Header");
      DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
    END;

    LOCAL PROCEDURE ValidateShortcutDimCode@29(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    BEGIN
      DimMgt.ValidateShortcutDimValues(FieldNumber,ShortcutDimCode,"Dimension Set ID");
    END;

    [External]
    PROCEDURE ShowDimensions@25();
    VAR
      OldDimSetID@1000 : Integer;
    BEGIN
      OldDimSetID := "Dimension Set ID";

      "Dimension Set ID" :=
        DimMgt.EditDimensionSet2(
          "Dimension Set ID",STRSUBSTNO('%1 %2 %3',"Document Type","Document No.","Line No."),
          "Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");

      if OldDimSetID <> "Dimension Set ID" then begin
        MODIFY;
        if ServLineExists then
          UpdateAllLineDim("Dimension Set ID",OldDimSetID);
      end;
    END;

    LOCAL PROCEDURE ServLineExists@20() : Boolean;
    BEGIN
      ServLine.RESET;
      ServLine.SETRANGE("Document Type","Document Type");
      ServLine.SETRANGE("Document No.","Document No.");
      exit(ServLine.FIND('-'));
    END;

    [External]
    PROCEDURE UpdateAllLineDim@41(NewParentDimSetID@1000 : Integer;OldParentDimSetID@1001 : Integer);
    VAR
      NewDimSetID@1002 : Integer;
    BEGIN
      // Update all lines with changed dimensions.

      if NewParentDimSetID = OldParentDimSetID then
        exit;
      if not CONFIRM(Text060) then
        exit;

      ServLine.RESET;
      ServLine.SETRANGE("Document Type","Document Type");
      ServLine.SETRANGE("Document No.","Document No.");
      ServLine.LOCKTABLE;
      if ServLine.FIND('-') then
        repeat
          NewDimSetID := DimMgt.GetDeltaDimSetID(ServLine."Dimension Set ID",NewParentDimSetID,OldParentDimSetID);
          if ServLine."Dimension Set ID" <> NewDimSetID then begin
            ServLine."Dimension Set ID" := NewDimSetID;
            DimMgt.UpdateGlobalDimFromDimSetID(
              ServLine."Dimension Set ID",ServLine."Shortcut Dimension 1 Code",ServLine."Shortcut Dimension 2 Code");
            ServLine.MODIFY;
          end;
        until ServLine.NEXT = 0;
    END;

    [External]
    PROCEDURE SetServItemInfo@17(ServItem@1000 : Record "Service Item");
    BEGIN
      "Item No." := ServItem."Item No.";
      "Serial No." := ServItem."Serial No.";
      "Variant Code" := ServItem."Variant Code";
      "Warranty Starting Date (Parts)" := ServItem."Warranty Starting Date (Parts)";
      "Warranty Ending Date (Parts)" := ServItem."Warranty Ending Date (Parts)";
      "Warranty Starting Date (Labor)" := ServItem."Warranty Starting Date (Labor)";
      "Warranty Ending Date (Labor)" := ServItem."Warranty Ending Date (Labor)";
      "Warranty % (Parts)" := ServItem."Warranty % (Parts)";
      "Warranty % (Labor)" := ServItem."Warranty % (Labor)";
      Description := ServItem.Description;
      "Description 2" := ServItem."Description 2";
      Priority := ServItem.Priority;
      "Vendor No." := ServItem."Vendor No.";
      "Vendor Item No." := ServItem."Vendor Item No.";
      CheckWarranty(ServHeader."Order Date");
    END;

    LOCAL PROCEDURE CheckTempDateErrorDate@18(Tempdate@1000 : Date;ErrorDate@1001 : Date;Caption1@1002 : Text[30];Caption2@1003 : Text[30]);
    BEGIN
      if Tempdate > ErrorDate then
        ERROR(Text045,FIELDCAPTION("Response Date"),
          TABLECAPTION,
          Caption1,
          Caption2);
    END;

    LOCAL PROCEDURE CheckServHourStartingDate@22(ServiceHour@1000 : Record "Service Hour");
    BEGIN
      if ServiceHour."Starting Date" <> 0D then
        ERROR(
          Text044,
          ServiceHour.FIELDCAPTION("Ending Time"),
          ServiceHour.Day,
          ServiceHour.FIELDCAPTION("Starting Date"),
          ServiceHour."Starting Date",
          Text057);
    END;

    LOCAL PROCEDURE LendLoanerWithConfirmation@19();
    BEGIN
      if "Loaner No." = '' then
        exit;
      if CONFIRM(STRSUBSTNO(Text029,Loaner.TABLECAPTION,"Loaner No."),false) then
        ServLoanerMgt.LendLoaner(Rec)
      else
        "Loaner No." := '';
    END;

    BEGIN
    END.
  }
}

