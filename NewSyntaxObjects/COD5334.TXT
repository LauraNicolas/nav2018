OBJECT Codeunit 5334 CRM Setup Defaults
{
  OBJECT-PROPERTIES
  {
    Date=20171006D;
    Time=120000T;
    Version List=NAVW111.0;
  }
  PROPERTIES
  {
    OnRun=BEGIN
          END;

  }
  CODE
  {
    VAR
      JobQueueEntryNameTok@1002 : TextConst '@@@="%1 = The Integration Table Name to synchronized (ex. CUSTOMER), %2 = CRM product name";ENU=" %1 - %2 synchronization job."';
      IntegrationTablePrefixTok@1003 : TextConst '@@@={Locked} Product name;ENU=Dynamics CRM';
      CustomStatisticsSynchJobDescTxt@1006 : TextConst '@@@="%1 = CRM product name";ENU=Customer Statistics - %1 synchronization job.';
      CRMAccountConfigTemplateCodeTok@1007 : TextConst '@@@=Config. Template code for CRM Accounts created from Customers. Max length 10.;ENU=CRMACCOUNT';
      CRMAccountConfigTemplateDescTxt@1009 : TextConst '@@@=Max. length 50.;ENU=New CRM Account records created during synch.';
      CustomerConfigTemplateCodeTok@1008 : TextConst '@@@=Customer template code for new customers created from CRM data. Max length 10.;ENU=CRMCUST';
      CustomerConfigTemplateDescTxt@1010 : TextConst '@@@=Max. length 50.;ENU=New Customer records created during synch.';
      CRMProductName@1000 : Codeunit "CRM Product Name";

    [Internal]
    PROCEDURE ResetConfiguration@9(CRMConnectionSetup@1000 : Record "CRM Connection Setup");
    VAR
      TempCRMConnectionSetup@1004 : TEMPORARY Record "CRM Connection Setup";
      CRMIntegrationManagement@1001 : Codeunit "CRM Integration Management";
      ConnectionName@1003 : Text;
      EnqueueJobQueEntries@1005 : Boolean;
    BEGIN
      EnqueueJobQueEntries := CRMConnectionSetup.DoReadCRMData;
      ConnectionName := RegisterTempConnectionIfNeeded(CRMConnectionSetup,TempCRMConnectionSetup);
      if ConnectionName <> '' then
        SETDEFAULTTABLECONNECTION(TABLECONNECTIONTYPE::CRM,ConnectionName,true);

      ResetSalesPeopleSystemUserMapping('SALESPEOPLE',EnqueueJobQueEntries);
      ResetCustomerAccountMapping('CUSTOMER',EnqueueJobQueEntries);
      ResetContactContactMapping('CONTACT',EnqueueJobQueEntries);
      ResetCurrencyTransactionCurrencyMapping('CURRENCY',EnqueueJobQueEntries);
      ResetUnitOfMeasureUoMScheduleMapping('UNIT OF MEASURE',EnqueueJobQueEntries);
      ResetItemProductMapping('ITEM-PRODUCT',EnqueueJobQueEntries);
      ResetResourceProductMapping('RESOURCE-PRODUCT',EnqueueJobQueEntries);
      ResetCustomerPriceGroupPricelevelMapping('CUSTPRCGRP-PRICE',EnqueueJobQueEntries);
      ResetSalesPriceProductPricelevelMapping('SALESPRC-PRODPRICE',EnqueueJobQueEntries);
      ResetSalesInvoiceHeaderInvoiceMapping('POSTEDSALESINV-INV',EnqueueJobQueEntries);
      ResetSalesInvoiceLineInvoiceMapping('POSTEDSALESLINE-INV');
      ResetShippingAgentMapping('SHIPPING AGENT');
      ResetShipmentMethodMapping('SHIPMENT METHOD');
      ResetPaymentTermsMapping('PAYMENT TERMS');
      ResetOpportunityMapping('OPPORTUNITY');

      RecreateStatisticsJobQueueEntry(EnqueueJobQueEntries);

      if CRMIntegrationManagement.IsCRMSolutionInstalled then
        ResetCRMNAVConnectionData;

      ResetDefaultCRMPricelevel(CRMConnectionSetup);

      if ConnectionName <> '' then
        TempCRMConnectionSetup.UnregisterConnectionWithName(ConnectionName);
    END;

    LOCAL PROCEDURE ResetSalesPeopleSystemUserMapping@7(IntegrationTableMappingName@1000 : Code[20];ShouldRecreateJobQueueEntry@1003 : Boolean);
    VAR
      IntegrationTableMapping@1005 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1004 : Record "Integration Field Mapping";
      SalespersonPurchaser@1001 : Record "Salesperson/Purchaser";
      CRMSystemuser@1002 : Record "CRM Systemuser";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Salesperson/Purchaser",DATABASE::"CRM Systemuser",
        CRMSystemuser.FIELDNO(SystemUserId),CRMSystemuser.FIELDNO(ModifiedOn),
        '','',true);

      CRMSystemuser.RESET;
      CRMSystemuser.SETRANGE(IsDisabled,false);
      CRMSystemuser.SETRANGE(IsLicensed,true);
      CRMSystemuser.SETRANGE(IsIntegrationUser,false);
      IntegrationTableMapping.SetIntegrationTableFilter(
        GetTableFilterFromView(DATABASE::"CRM Systemuser",CRMSystemuser.TABLECAPTION,CRMSystemuser.GETVIEW));
      IntegrationTableMapping.MODIFY;

      // Email > InternalEMailAddress
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalespersonPurchaser.FIELDNO("E-Mail"),
        CRMSystemuser.FIELDNO(InternalEMailAddress),
        IntegrationFieldMapping.Direction::FromIntegrationTable,
        '',true,false);

      // Name > FullName
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalespersonPurchaser.FIELDNO(Name),
        CRMSystemuser.FIELDNO(FullName),
        IntegrationFieldMapping.Direction::FromIntegrationTable,
        '',true,false);

      // Phone No. > MobilePhone
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalespersonPurchaser.FIELDNO("Phone No."),
        CRMSystemuser.FIELDNO(MobilePhone),
        IntegrationFieldMapping.Direction::FromIntegrationTable,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,30,ShouldRecreateJobQueueEntry);
    END;

    LOCAL PROCEDURE ResetCustomerAccountMapping@2(IntegrationTableMappingName@1004 : Code[20];ShouldRecreateJobQueueEntry@1003 : Boolean);
    VAR
      IntegrationTableMapping@1005 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      CRMAccount@1001 : Record "CRM Account";
      Customer@1002 : Record Customer;
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::Customer,DATABASE::"CRM Account",
        CRMAccount.FIELDNO(AccountId),CRMAccount.FIELDNO(ModifiedOn),
        ResetCustomerConfigTemplate,ResetAccountConfigTemplate,true);

      CRMAccount.SETRANGE(StateCode,CRMAccount.StateCode::Active);
      CRMAccount.SETRANGE(CustomerTypeCode,CRMAccount.CustomerTypeCode::Customer);
      IntegrationTableMapping.SetIntegrationTableFilter(
        GetTableFilterFromView(DATABASE::"CRM Account",CRMAccount.TABLECAPTION,CRMAccount.GETVIEW));
      IntegrationTableMapping."Dependency Filter" := 'SALESPEOPLE|CURRENCY';
      IntegrationTableMapping.MODIFY;

      // Name > Name
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO(Name),
        CRMAccount.FIELDNO(Name),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Contact > Address1_PrimaryContactName
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO(Contact),
        CRMAccount.FIELDNO(Address1_PrimaryContactName),
        IntegrationFieldMapping.Direction::FromIntegrationTable,
        '',false,false); // We do not validate contact name.

      // Address > Address1_Line1
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO(Address),
        CRMAccount.FIELDNO(Address1_Line1),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Address 2 > Address1_Line2
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Address 2"),
        CRMAccount.FIELDNO(Address1_Line2),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Post Code > Address1_PostalCode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Post Code"),
        CRMAccount.FIELDNO(Address1_PostalCode),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // City > Address1_City
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO(City),
        CRMAccount.FIELDNO(Address1_City),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Country > Address1_Country
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Country/Region Code"),
        CRMAccount.FIELDNO(Address1_Country),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // County > Address1_StateOrProvince
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO(County),
        CRMAccount.FIELDNO(Address1_StateOrProvince),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Email > EmailAddress1
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("E-Mail"),
        CRMAccount.FIELDNO(EMailAddress1),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Fax No > Fax
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Fax No."),
        CRMAccount.FIELDNO(Fax),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Home Page > WebSiteUrl
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Home Page"),
        CRMAccount.FIELDNO(WebSiteURL),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Phone No. > Telephone1
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Phone No."),
        CRMAccount.FIELDNO(Telephone1),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Shipment Method Code > address1_freighttermscode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Shipment Method Code"),
        CRMAccount.FIELDNO(Address1_FreightTermsCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Shipping Agent Code > address1_shippingmethodcode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Shipping Agent Code"),
        CRMAccount.FIELDNO(Address1_ShippingMethodCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Payment Terms Code > paymenttermscode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Payment Terms Code"),
        CRMAccount.FIELDNO(PaymentTermsCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Credit Limit (LCY) > creditlimit
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Credit Limit (LCY)"),
        CRMAccount.FIELDNO(CreditLimit),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Primary Contact No." > PrimaryContactId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Customer.FIELDNO("Primary Contact No."),
        CRMAccount.FIELDNO(PrimaryContactId),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,2,ShouldRecreateJobQueueEntry);
    END;

    LOCAL PROCEDURE ResetContactContactMapping@3(IntegrationTableMappingName@1005 : Code[20];EnqueueJobQueEntry@1003 : Boolean);
    VAR
      IntegrationTableMapping@1006 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      CRMContact@1001 : Record "CRM Contact";
      Contact@1002 : Record Contact;
      EmptyGuid@1004 : GUID;
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::Contact,DATABASE::"CRM Contact",
        CRMContact.FIELDNO(ContactId),CRMContact.FIELDNO(ModifiedOn),
        '','',true);

      Contact.RESET;
      Contact.SETRANGE(Type,Contact.Type::Person);
      Contact.SETFILTER("Company No.",'<>''''');
      IntegrationTableMapping.SetTableFilter(GetTableFilterFromView(DATABASE::Contact,Contact.TABLECAPTION,Contact.GETVIEW));

      CRMContact.RESET;
      CRMContact.SETFILTER(ParentCustomerId,'<>''%1''',EmptyGuid);
      CRMContact.SETRANGE(ParentCustomerIdType,CRMContact.ParentCustomerIdType::account);
      IntegrationTableMapping.SetIntegrationTableFilter(
        GetTableFilterFromView(DATABASE::"CRM Contact",CRMContact.TABLECAPTION,CRMContact.GETVIEW));
      IntegrationTableMapping."Dependency Filter" := 'CUSTOMER';
      IntegrationTableMapping.MODIFY;

      // "Currency Code" > TransactionCurrencyId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Currency Code"),
        CRMContact.FIELDNO(TransactionCurrencyId),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Address > Address1_Line1
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO(Address),
        CRMContact.FIELDNO(Address1_Line1),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Address 2 > Address1_Line2
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Address 2"),
        CRMContact.FIELDNO(Address1_Line2),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Post Code > Address1_PostalCode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Post Code"),
        CRMContact.FIELDNO(Address1_PostalCode),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // City > Address1_City
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO(City),
        CRMContact.FIELDNO(Address1_City),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Country/Region Code > Address1_Country
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Country/Region Code"),
        CRMContact.FIELDNO(Address1_Country),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // County > Address1_StateOrProvince
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO(County),
        CRMContact.FIELDNO(Address1_StateOrProvince),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Email > EmailAddress1
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("E-Mail"),
        CRMContact.FIELDNO(EMailAddress1),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Fax No. > Fax
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Fax No."),
        CRMContact.FIELDNO(Fax),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // First Name > FirstName
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("First Name"),
        CRMContact.FIELDNO(FirstName),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Middle Name > MiddleName
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Middle Name"),
        CRMContact.FIELDNO(MiddleName),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Surname > LastName
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO(Surname),
        CRMContact.FIELDNO(LastName),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Home Page > WebSiteUrl
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Home Page"),
        CRMContact.FIELDNO(WebSiteUrl),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Mobile Phone No. > MobilePhone
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Mobile Phone No."),
        CRMContact.FIELDNO(MobilePhone),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Pager > Pager
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO(Pager),
        CRMContact.FIELDNO(Pager),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Phone No. > Telephone1
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO("Phone No."),
        CRMContact.FIELDNO(Telephone1),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Type
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Contact.FIELDNO(Type),0,
        IntegrationFieldMapping.Direction::FromIntegrationTable,
        FORMAT(Contact.Type::Person),true,false);

      // CRMContact.ParentCustomerIdType::account
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        0,CRMContact.FIELDNO(ParentCustomerIdType),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        FORMAT(CRMContact.ParentCustomerIdType::account),false,false);

      RecreateJobQueueEntry(IntegrationTableMapping,2,EnqueueJobQueEntry);
    END;

    LOCAL PROCEDURE ResetCurrencyTransactionCurrencyMapping@10(IntegrationTableMappingName@1002 : Code[20];EnqueueJobQueEntry@1001 : Boolean);
    VAR
      IntegrationTableMapping@1005 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      Currency@1003 : Record Currency;
      CRMTransactioncurrency@1004 : Record "CRM Transactioncurrency";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::Currency,DATABASE::"CRM Transactioncurrency",
        CRMTransactioncurrency.FIELDNO(TransactionCurrencyId),
        CRMTransactioncurrency.FIELDNO(ModifiedOn),
        '',
        '',
        true);

      // Code > ISOCurrencyCode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Currency.FIELDNO(Code),
        CRMTransactioncurrency.FIELDNO(ISOCurrencyCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Code > CurrencySymbol
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Currency.FIELDNO(Code),
        CRMTransactioncurrency.FIELDNO(CurrencySymbol),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Description > CurrencyName
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Currency.FIELDNO(Description),
        CRMTransactioncurrency.FIELDNO(CurrencyName),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,2,EnqueueJobQueEntry);
    END;

    LOCAL PROCEDURE ResetItemProductMapping@12(IntegrationTableMappingName@1002 : Code[20];EnqueueJobQueEntry@1001 : Boolean);
    VAR
      IntegrationTableMapping@1005 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      Item@1003 : Record Item;
      CRMProduct@1004 : Record "CRM Product";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::Item,DATABASE::"CRM Product",
        CRMProduct.FIELDNO(ProductId),CRMProduct.FIELDNO(ModifiedOn),
        '','',true);

      IntegrationTableMapping."Dependency Filter" := 'UNIT OF MEASURE';
      SetIntegrationTableFilterForCRMProduct(IntegrationTableMapping,CRMProduct,CRMProduct.ProductTypeCode::SalesInventory);

      // "No." > ProductNumber
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("No."),
        CRMProduct.FIELDNO(ProductNumber),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Description > Name
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO(Description),
        CRMProduct.FIELDNO(Name),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Unit Price > Price
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("Unit Price"),
        CRMProduct.FIELDNO(Price),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Unit Cost > Standard Cost
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("Unit Cost"),
        CRMProduct.FIELDNO(StandardCost),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Unit Cost > Current Cost
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("Unit Cost"),
        CRMProduct.FIELDNO(CurrentCost),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Unit Volume > Stock Volume
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("Unit Volume"),
        CRMProduct.FIELDNO(StockVolume),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Gross Weight > Stock Weight
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("Gross Weight"),
        CRMProduct.FIELDNO(StockWeight),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Vendor No. > Vendor ID
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("Vendor No."),
        CRMProduct.FIELDNO(VendorID),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Vendor Item No. > Vendor part number
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("Vendor Item No."),
        CRMProduct.FIELDNO(VendorPartNumber),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Inventory > Quantity on Hand. If less then zero, it will later be set to zero
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO(Inventory),
        CRMProduct.FIELDNO(QuantityOnHand),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Base Unit of Measure > DefaultUoMScheduleId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Item.FIELDNO("Base Unit of Measure"),
        CRMProduct.FIELDNO(DefaultUoMScheduleId),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,30,EnqueueJobQueEntry);
    END;

    LOCAL PROCEDURE ResetResourceProductMapping@13(IntegrationTableMappingName@1002 : Code[20];EnqueueJobQueEntry@1001 : Boolean);
    VAR
      IntegrationTableMapping@1005 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      Resource@1003 : Record Resource;
      CRMProduct@1004 : Record "CRM Product";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::Resource,DATABASE::"CRM Product",
        CRMProduct.FIELDNO(ProductId),CRMProduct.FIELDNO(ModifiedOn),
        '','',true);

      IntegrationTableMapping."Dependency Filter" := 'UNIT OF MEASURE';
      SetIntegrationTableFilterForCRMProduct(IntegrationTableMapping,CRMProduct,CRMProduct.ProductTypeCode::Services);

      // "No." > ProductNumber
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Resource.FIELDNO("No."),
        CRMProduct.FIELDNO(ProductNumber),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Name > Name
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Resource.FIELDNO(Name),
        CRMProduct.FIELDNO(Name),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // Unit Price > Price
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Resource.FIELDNO("Unit Price"),
        CRMProduct.FIELDNO(Price),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Unit Cost > Standard Cost
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Resource.FIELDNO("Unit Cost"),
        CRMProduct.FIELDNO(StandardCost),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Unit Cost > Current Cost
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Resource.FIELDNO("Unit Cost"),
        CRMProduct.FIELDNO(CurrentCost),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Vendor No. > Vendor ID
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Resource.FIELDNO("Vendor No."),
        CRMProduct.FIELDNO(VendorID),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Capacity > Quantity on Hand. If less then zero, it will later be set to zero
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Resource.FIELDNO(Capacity),
        CRMProduct.FIELDNO(QuantityOnHand),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,2,EnqueueJobQueEntry);
    END;

    LOCAL PROCEDURE ResetSalesInvoiceHeaderInvoiceMapping@23(IntegrationTableMappingName@1002 : Code[20];EnqueueJobQueEntry@1001 : Boolean);
    VAR
      IntegrationTableMapping@1005 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      SalesInvoiceHeader@1003 : Record "Sales Invoice Header";
      CRMInvoice@1004 : Record "CRM Invoice";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Sales Invoice Header",DATABASE::"CRM Invoice",
        CRMInvoice.FIELDNO(InvoiceId),CRMInvoice.FIELDNO(ModifiedOn),
        '','',true);
      IntegrationTableMapping."Dependency Filter" := 'OPPORTUNITY';
      IntegrationTableMapping.MODIFY;

      // "No." > InvoiceNumber
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("No."),
        CRMInvoice.FIELDNO(InvoiceNumber),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Currency Code" > TransactionCurrencyId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Currency Code"),
        CRMInvoice.FIELDNO(TransactionCurrencyId),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Due Date" > DueDate
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Due Date"),
        CRMInvoice.FIELDNO(DueDate),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Ship-to Name
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Ship-to Name"),
        CRMInvoice.FIELDNO(ShipTo_Name),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Ship-to Address
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Ship-to Address"),
        CRMInvoice.FIELDNO(ShipTo_Line1),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Ship-to Address 2
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Ship-to Address 2"),
        CRMInvoice.FIELDNO(ShipTo_Line2),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Ship-to City
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Ship-to City"),
        CRMInvoice.FIELDNO(ShipTo_City),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Ship-to Country/Region Code"
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Ship-to Country/Region Code"),
        CRMInvoice.FIELDNO(ShipTo_Country),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Ship-to Post Code"
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Ship-to Post Code"),
        CRMInvoice.FIELDNO(ShipTo_PostalCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Ship-to County"
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Ship-to County"),
        CRMInvoice.FIELDNO(ShipTo_StateOrProvince),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Shipment Date"
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Shipment Date"),
        CRMInvoice.FIELDNO(DateDelivered),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Bill-to Name
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Bill-to Name"),
        CRMInvoice.FIELDNO(BillTo_Name),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Bill-to Address
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Bill-to Address"),
        CRMInvoice.FIELDNO(BillTo_Line1),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Bill-to Address 2
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Bill-to Address 2"),
        CRMInvoice.FIELDNO(BillTo_Line2),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Bill-to City
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Bill-to City"),
        CRMInvoice.FIELDNO(BillTo_City),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Bill-to Country/Region Code
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Bill-to Country/Region Code"),
        CRMInvoice.FIELDNO(BillTo_Country),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Bill-to Post Code"
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Bill-to Post Code"),
        CRMInvoice.FIELDNO(BillTo_PostalCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Bill-to County"
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Bill-to County"),
        CRMInvoice.FIELDNO(BillTo_StateOrProvince),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Amount > TotalAmountLessFreight
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO(Amount),
        CRMInvoice.FIELDNO(TotalAmountLessFreight),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Amount Including VAT" > TotalAmount
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Amount Including VAT"),
        CRMInvoice.FIELDNO(TotalAmount),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Invoice Discount Amount" > DiscountAmount
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Invoice Discount Amount"),
        CRMInvoice.FIELDNO(DiscountAmount),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Shipping Agent Code > address1_shippingmethodcode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Shipping Agent Code"),
        CRMInvoice.FIELDNO(ShippingMethodCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // Payment Terms Code > paymenttermscode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceHeader.FIELDNO("Payment Terms Code"),
        CRMInvoice.FIELDNO(PaymentTermsCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,30,EnqueueJobQueEntry);
    END;

    LOCAL PROCEDURE ResetSalesInvoiceLineInvoiceMapping@25(IntegrationTableMappingName@1001 : Code[20]);
    VAR
      IntegrationTableMapping@1002 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      SalesInvoiceLine@1003 : Record "Sales Invoice Line";
      CRMInvoicedetail@1004 : Record "CRM Invoicedetail";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Sales Invoice Line",DATABASE::"CRM Invoicedetail",
        CRMInvoicedetail.FIELDNO(InvoiceDetailId),CRMInvoicedetail.FIELDNO(ModifiedOn),
        '','',false);
      IntegrationTableMapping."Dependency Filter" := 'POSTEDSALESINV-INV';
      IntegrationTableMapping.MODIFY;

      // Quantity -> Quantity
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceLine.FIELDNO(Quantity),
        CRMInvoicedetail.FIELDNO(Quantity),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Line Discount Amount" -> "Manual Discount Amount"
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceLine.FIELDNO("Line Discount Amount"),
        CRMInvoicedetail.FIELDNO(ManualDiscountAmount),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Unit Price" > PricePerUnit
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceLine.FIELDNO("Unit Price"),
        CRMInvoicedetail.FIELDNO(PricePerUnit),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // TRUE > IsPriceOverridden
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        0,
        CRMInvoicedetail.FIELDNO(IsPriceOverridden),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '1',true,false);

      // Amount -> BaseAmount
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceLine.FIELDNO(Amount),
        CRMInvoicedetail.FIELDNO(BaseAmount),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Amount Including VAT" -> ExtendedAmount
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesInvoiceLine.FIELDNO("Amount Including VAT"),
        CRMInvoicedetail.FIELDNO(ExtendedAmount),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);
    END;

    LOCAL PROCEDURE ResetCustomerPriceGroupPricelevelMapping@28(IntegrationTableMappingName@1002 : Code[20];EnqueueJobQueEntry@1001 : Boolean);
    VAR
      IntegrationTableMapping@1005 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      CustomerPriceGroup@1003 : Record "Customer Price Group";
      CRMPricelevel@1004 : Record "CRM Pricelevel";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Customer Price Group",DATABASE::"CRM Pricelevel",
        CRMPricelevel.FIELDNO(PriceLevelId),CRMPricelevel.FIELDNO(ModifiedOn),
        '','',true);
      IntegrationTableMapping."Dependency Filter" := 'CURRENCY';
      IntegrationTableMapping.MODIFY;

      // Code > Name
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        CustomerPriceGroup.FIELDNO(Code),
        CRMPricelevel.FIELDNO(Name),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,30,EnqueueJobQueEntry);
    END;

    LOCAL PROCEDURE ResetSalesPriceProductPricelevelMapping@27(IntegrationTableMappingName@1001 : Code[20];EnqueueJobQueEntry@1005 : Boolean);
    VAR
      IntegrationTableMapping@1002 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      SalesPrice@1003 : Record "Sales Price";
      CRMProductpricelevel@1004 : Record "CRM Productpricelevel";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Sales Price",DATABASE::"CRM Productpricelevel",
        CRMProductpricelevel.FIELDNO(ProductPriceLevelId),CRMProductpricelevel.FIELDNO(ModifiedOn),
        '','',false);

      SalesPrice.RESET;
      SalesPrice.SETRANGE("Sales Type",SalesPrice."Sales Type"::"Customer Price Group");
      SalesPrice.SETFILTER("Sales Code",'<>''''');
      IntegrationTableMapping.SetTableFilter(
        GetTableFilterFromView(DATABASE::"Sales Price",SalesPrice.TABLECAPTION,SalesPrice.GETVIEW));

      IntegrationTableMapping."Dependency Filter" := 'CUSTPRCGRP-PRICE|ITEM-PRODUCT';
      IntegrationTableMapping.MODIFY;

      // "Sales Code" > PriceLevelId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesPrice.FIELDNO("Sales Code"),
        CRMProductpricelevel.FIELDNO(PriceLevelId),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Item No." > ProductId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesPrice.FIELDNO("Item No."),
        CRMProductpricelevel.FIELDNO(ProductId),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Item No." > ProductNumber
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesPrice.FIELDNO("Item No."),
        CRMProductpricelevel.FIELDNO(ProductNumber),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Currency Code" > TransactionCurrencyId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesPrice.FIELDNO("Currency Code"),
        CRMProductpricelevel.FIELDNO(TransactionCurrencyId),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // >> PricingMethodCode = CurrencyAmount
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        0,CRMProductpricelevel.FIELDNO(PricingMethodCode),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        FORMAT(CRMProductpricelevel.PricingMethodCode::CurrencyAmount),false,false);

      // "Unit Price" > Amount
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        SalesPrice.FIELDNO("Unit Price"),
        CRMProductpricelevel.FIELDNO(Amount),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,30,EnqueueJobQueEntry);
    END;

    LOCAL PROCEDURE ResetUnitOfMeasureUoMScheduleMapping@11(IntegrationTableMappingName@1002 : Code[20];EnqueueJobQueEntry@1001 : Boolean);
    VAR
      IntegrationTableMapping@1005 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1000 : Record "Integration Field Mapping";
      UnitOfMeasure@1003 : Record "Unit of Measure";
      CRMUomschedule@1004 : Record "CRM Uomschedule";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Unit of Measure",DATABASE::"CRM Uomschedule",
        CRMUomschedule.FIELDNO(UoMScheduleId),CRMUomschedule.FIELDNO(ModifiedOn),
        '','',true);

      // Code > BaseUoM Name
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        UnitOfMeasure.FIELDNO(Code),
        CRMUomschedule.FIELDNO(BaseUoMName),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      RecreateJobQueueEntry(IntegrationTableMapping,2,EnqueueJobQueEntry);
    END;

    LOCAL PROCEDURE ResetShippingAgentMapping@35(IntegrationTableMappingName@1003 : Code[20]);
    VAR
      IntegrationTableMapping@1004 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1002 : Record "Integration Field Mapping";
      ShippingAgent@1000 : Record "Shipping Agent";
      CRMAccount@1001 : Record "CRM Account";
      CRMIntegrationTableSynch@1005 : Codeunit "CRM Integration Table Synch.";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Shipping Agent",DATABASE::"CRM Account",
        CRMAccount.FIELDNO(Address1_ShippingMethodCode),0,
        '','',false);

      // Code > "CRM Account".Address1_ShippingMethodCode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        ShippingAgent.FIELDNO(Code),
        CRMAccount.FIELDNO(Address1_ShippingMethodCode),
        IntegrationFieldMapping.Direction::FromIntegrationTable,
        '',true,false);

      CRMIntegrationTableSynch.SynchOption(IntegrationTableMapping);
    END;

    LOCAL PROCEDURE ResetShipmentMethodMapping@38(IntegrationTableMappingName@1003 : Code[20]);
    VAR
      IntegrationTableMapping@1004 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1002 : Record "Integration Field Mapping";
      ShipmentMethod@1000 : Record "Shipment Method";
      CRMAccount@1001 : Record "CRM Account";
      CRMIntegrationTableSynch@1005 : Codeunit "CRM Integration Table Synch.";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Shipment Method",DATABASE::"CRM Account",
        CRMAccount.FIELDNO(Address1_FreightTermsCode),0,
        '','',false);

      // Code > "CRM Account".Address1_FreightTermsCode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        ShipmentMethod.FIELDNO(Code),
        CRMAccount.FIELDNO(Address1_FreightTermsCode),
        IntegrationFieldMapping.Direction::FromIntegrationTable,
        '',true,false);

      CRMIntegrationTableSynch.SynchOption(IntegrationTableMapping);
    END;

    LOCAL PROCEDURE ResetPaymentTermsMapping@39(IntegrationTableMappingName@1003 : Code[20]);
    VAR
      IntegrationTableMapping@1004 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1002 : Record "Integration Field Mapping";
      PaymentTerms@1000 : Record "Payment Terms";
      CRMAccount@1001 : Record "CRM Account";
      CRMIntegrationTableSynch@1005 : Codeunit "CRM Integration Table Synch.";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::"Payment Terms",DATABASE::"CRM Account",
        CRMAccount.FIELDNO(PaymentTermsCode),0,
        '','',false);

      // Code > "CRM Account".PaymentTermsCode
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        PaymentTerms.FIELDNO(Code),
        CRMAccount.FIELDNO(PaymentTermsCode),
        IntegrationFieldMapping.Direction::FromIntegrationTable,
        '',true,false);

      CRMIntegrationTableSynch.SynchOption(IntegrationTableMapping);
    END;

    LOCAL PROCEDURE ResetOpportunityMapping@37(IntegrationTableMappingName@1003 : Code[20]);
    VAR
      IntegrationTableMapping@1004 : Record "Integration Table Mapping";
      IntegrationFieldMapping@1002 : Record "Integration Field Mapping";
      Opportunity@1000 : Record Opportunity;
      CRMOpportunity@1001 : Record "CRM Opportunity";
      CRMIntegrationTableSynch@1005 : Codeunit "CRM Integration Table Synch.";
    BEGIN
      InsertIntegrationTableMapping(
        IntegrationTableMapping,IntegrationTableMappingName,
        DATABASE::Opportunity,DATABASE::"CRM Opportunity",
        CRMOpportunity.FIELDNO(OpportunityId),CRMOpportunity.FIELDNO(ModifiedOn),
        '','',false);
      IntegrationTableMapping."Dependency Filter" := 'CONTACT';
      IntegrationTableMapping.MODIFY;

      // Description > Name
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Opportunity.FIELDNO(Description),
        CRMOpportunity.FIELDNO(Name),
        IntegrationFieldMapping.Direction::Bidirectional,
        '',true,false);

      // "Contact No." > ParentContactId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Opportunity.FIELDNO("Contact No."),
        CRMOpportunity.FIELDNO(ParentContactId),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // OwnerId = systemuser
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        0,CRMOpportunity.FIELDNO(OwnerIdType),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        FORMAT(CRMOpportunity.OwnerIdType::systemuser),false,false);

      // "Salesperson Code" > OwnerId
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Opportunity.FIELDNO("Salesperson Code"),
        CRMOpportunity.FIELDNO(OwnerId),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Estimated Value (LCY)" > EstimatedValue
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Opportunity.FIELDNO("Estimated Value (LCY)"),
        CRMOpportunity.FIELDNO(EstimatedValue),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      // "Estimated Closing Date" > EstimatedCloseDate
      InsertIntegrationFieldMapping(
        IntegrationTableMappingName,
        Opportunity.FIELDNO("Estimated Closing Date"),
        CRMOpportunity.FIELDNO(EstimatedCloseDate),
        IntegrationFieldMapping.Direction::ToIntegrationTable,
        '',true,false);

      CRMIntegrationTableSynch.SynchOption(IntegrationTableMapping);
    END;

    LOCAL PROCEDURE InsertIntegrationTableMapping@5(VAR IntegrationTableMapping@1008 : Record "Integration Table Mapping";MappingName@1000 : Code[20];TableNo@1001 : Integer;IntegrationTableNo@1002 : Integer;IntegrationTableUIDFieldNo@1005 : Integer;IntegrationTableModifiedFieldNo@1006 : Integer;TableConfigTemplateCode@1003 : Code[10];IntegrationTableConfigTemplateCode@1007 : Code[10];SynchOnlyCoupledRecords@1009 : Boolean);
    BEGIN
      IntegrationTableMapping.CreateRecord(MappingName,TableNo,IntegrationTableNo,IntegrationTableUIDFieldNo,
        IntegrationTableModifiedFieldNo,TableConfigTemplateCode,IntegrationTableConfigTemplateCode,
        SynchOnlyCoupledRecords,GetDefaultDirection(TableNo),IntegrationTablePrefixTok);
    END;

    LOCAL PROCEDURE InsertIntegrationFieldMapping@1(IntegrationTableMappingName@1000 : Code[20];TableFieldNo@1001 : Integer;IntegrationTableFieldNo@1002 : Integer;SynchDirection@1004 : Option;ConstValue@1005 : Text;ValidateField@1003 : Boolean;ValidateIntegrationTableField@1006 : Boolean);
    VAR
      IntegrationFieldMapping@1007 : Record "Integration Field Mapping";
    BEGIN
      IntegrationFieldMapping.CreateRecord(IntegrationTableMappingName,TableFieldNo,IntegrationTableFieldNo,SynchDirection,
        ConstValue,ValidateField,ValidateIntegrationTableField);
    END;

    [External]
    PROCEDURE CreateJobQueueEntry@36(IntegrationTableMapping@1003 : Record "Integration Table Mapping") : Boolean;
    VAR
      JobQueueEntry@1001 : Record "Job Queue Entry";
    BEGIN
      with JobQueueEntry do begin
        INIT;
        CLEAR(ID); // "Job Queue - Enqueue" is to define new ID
        "Earliest Start Date/Time" := CURRENTDATETIME + 1000;
        "Object Type to Run" := "Object Type to Run"::Codeunit;
        "Object ID to Run" := CODEUNIT::"Integration Synch. Job Runner";
        "Record ID to Process" := IntegrationTableMapping.RECORDID;
        "Run in User Session" := false;
        "Notify On Success" := false;
        "Maximum No. of Attempts to Run" := 2;
        Status := Status::Ready;
        "Rerun Delay (sec.)" := 30;
        Description :=
          COPYSTR(
            STRSUBSTNO(
              JobQueueEntryNameTok,IntegrationTableMapping.GetTempDescription,CRMProductName.SHORT),1,MAXSTRLEN(Description));
        exit(CODEUNIT.RUN(CODEUNIT::"Job Queue - Enqueue",JobQueueEntry))
      end;
    END;

    LOCAL PROCEDURE RecreateStatisticsJobQueueEntry@14(EnqueueJobQueEntry@1001 : Boolean);
    VAR
      JobQueueEntry@1000 : Record "Job Queue Entry";
    BEGIN
      with JobQueueEntry do begin
        SETRANGE("Object Type to Run","Object Type to Run"::Codeunit);
        SETRANGE("Object ID to Run",CODEUNIT::"CRM Statistics Job");
        DeleteTasks;

        InitRecurringJob(30);
        "Object Type to Run" := "Object Type to Run"::Codeunit;
        "Object ID to Run" := CODEUNIT::"CRM Statistics Job";
        Priority := 1000;
        Description := COPYSTR(STRSUBSTNO(CustomStatisticsSynchJobDescTxt,CRMProductName.SHORT),1,MAXSTRLEN(Description));
        "Maximum No. of Attempts to Run" := 2;
        Status := Status::"On Hold";
        "Rerun Delay (sec.)" := 30;
        if EnqueueJobQueEntry then
          CODEUNIT.RUN(CODEUNIT::"Job Queue - Enqueue",JobQueueEntry)
        else
          INSERT(true);
      end;
    END;

    LOCAL PROCEDURE RecreateJobQueueEntry@8(IntegrationTableMapping@1003 : Record "Integration Table Mapping";IntervalInMinutes@1002 : Integer;ShouldRecreateJobQueueEntry@1000 : Boolean);
    VAR
      JobQueueEntry@1001 : Record "Job Queue Entry";
    BEGIN
      with JobQueueEntry do begin
        SETRANGE("Object Type to Run","Object Type to Run"::Codeunit);
        SETRANGE("Object ID to Run",CODEUNIT::"Integration Synch. Job Runner");
        SETRANGE("Record ID to Process",IntegrationTableMapping.RECORDID);
        DeleteTasks;

        InitRecurringJob(IntervalInMinutes);
        "Object Type to Run" := "Object Type to Run"::Codeunit;
        "Object ID to Run" := CODEUNIT::"Integration Synch. Job Runner";
        "Record ID to Process" := IntegrationTableMapping.RECORDID;
        "Run in User Session" := false;
        Priority := 1000;
        Description := COPYSTR(STRSUBSTNO(JobQueueEntryNameTok,IntegrationTableMapping.Name),1,MAXSTRLEN(Description));
        "Maximum No. of Attempts to Run" := 10;
        Status := Status::Ready;
        "Rerun Delay (sec.)" := 30;
        if ShouldRecreateJobQueueEntry then
          CODEUNIT.RUN(CODEUNIT::"Job Queue - Enqueue",JobQueueEntry)
        else
          INSERT(true);
      end;
    END;

    [Internal]
    PROCEDURE ResetCRMNAVConnectionData@19();
    VAR
      CRMIntegrationManagement@1000 : Codeunit "CRM Integration Management";
    BEGIN
      CRMIntegrationManagement.SetCRMNAVConnectionUrl(GETURL(CLIENTTYPE::Web));
      CRMIntegrationManagement.SetCRMNAVODataUrlCredentials(
        GETURL(CLIENTTYPE::OData,COMPANYNAME),'','');
    END;

    [External]
    PROCEDURE GetAddPostedSalesDocumentToCRMAccountWallConfig@4() : Boolean;
    BEGIN
      exit(true);
    END;

    [External]
    PROCEDURE GetAllowNonSecureConnections@20() : Boolean;
    BEGIN
      // Most OnPrem solutions uses http if running in a private domain. CRM Server only demands https if the system has been
      // configured with internet connectivity, which is not the default. NAV Should not contrain the connection to CRM if the system
      // admin has configured the CRM service to be on a private domain only.
      exit(true);
    END;

    [External]
    PROCEDURE GetCRMTableNo@32(NAVTableID@1000 : Integer) : Integer;
    BEGIN
      case NAVTableID of
        DATABASE::Contact:
          exit(DATABASE::"CRM Contact");
        DATABASE::Currency:
          exit(DATABASE::"CRM Transactioncurrency");
        DATABASE::Customer:
          exit(DATABASE::"CRM Account");
        DATABASE::"Customer Price Group":
          exit(DATABASE::"CRM Pricelevel");
        DATABASE::Item,
        DATABASE::Resource:
          exit(DATABASE::"CRM Product");
        DATABASE::"Sales Invoice Header":
          exit(DATABASE::"CRM Invoice");
        DATABASE::"Sales Invoice Line":
          exit(DATABASE::"CRM Invoicedetail");
        DATABASE::"Sales Price":
          exit(DATABASE::"CRM Productpricelevel");
        DATABASE::"Salesperson/Purchaser":
          exit(DATABASE::"CRM Systemuser");
        DATABASE::"Unit of Measure":
          exit(DATABASE::"CRM Uomschedule");
        DATABASE::Opportunity:
          exit(DATABASE::"CRM Opportunity");
      end;
    END;

    [External]
    PROCEDURE GetDefaultDirection@33(NAVTableID@1000 : Integer) : Integer;
    VAR
      IntegrationTableMapping@1001 : Record "Integration Table Mapping";
    BEGIN
      case NAVTableID of
        DATABASE::Contact,
        DATABASE::Customer,
        DATABASE::Item,
        DATABASE::Resource,
        DATABASE::Opportunity:
          exit(IntegrationTableMapping.Direction::Bidirectional);
        DATABASE::Currency,
        DATABASE::"Customer Price Group",
        DATABASE::"Sales Invoice Header",
        DATABASE::"Sales Invoice Line",
        DATABASE::"Sales Price",
        DATABASE::"Unit of Measure":
          exit(IntegrationTableMapping.Direction::ToIntegrationTable);
        DATABASE::"Payment Terms",
        DATABASE::"Shipment Method",
        DATABASE::"Shipping Agent",
        DATABASE::"Salesperson/Purchaser":
          exit(IntegrationTableMapping.Direction::FromIntegrationTable);
      end;
    END;

    [External]
    PROCEDURE GetProductQuantityPrecision@16() : Integer;
    BEGIN
      exit(2);
    END;

    [External]
    PROCEDURE GetNameFieldNo@34(TableID@1000 : Integer) : Integer;
    VAR
      Contact@1001 : Record Contact;
      CRMContact@1002 : Record "CRM Contact";
      Currency@1003 : Record Currency;
      CRMTransactioncurrency@1004 : Record "CRM Transactioncurrency";
      Customer@1005 : Record Customer;
      CRMAccount@1006 : Record "CRM Account";
      CustomerPriceGroup@1007 : Record "Customer Price Group";
      CRMPricelevel@1008 : Record "CRM Pricelevel";
      Item@1009 : Record Item;
      Resource@1010 : Record Resource;
      CRMProduct@1011 : Record "CRM Product";
      SalespersonPurchaser@1018 : Record "Salesperson/Purchaser";
      CRMSystemuser@1019 : Record "CRM Systemuser";
      UnitOfMeasure@1020 : Record "Unit of Measure";
      CRMUomschedule@1021 : Record "CRM Uomschedule";
      Opportunity@1012 : Record Opportunity;
      CRMOpportunity@1013 : Record "CRM Opportunity";
    BEGIN
      case TableID of
        DATABASE::Contact:
          exit(Contact.FIELDNO(Name));
        DATABASE::"CRM Contact":
          exit(CRMContact.FIELDNO(FullName));
        DATABASE::Currency:
          exit(Currency.FIELDNO(Code));
        DATABASE::"CRM Transactioncurrency":
          exit(CRMTransactioncurrency.FIELDNO(ISOCurrencyCode));
        DATABASE::Customer:
          exit(Customer.FIELDNO(Name));
        DATABASE::"CRM Account":
          exit(CRMAccount.FIELDNO(Name));
        DATABASE::"Customer Price Group":
          exit(CustomerPriceGroup.FIELDNO(Code));
        DATABASE::"CRM Pricelevel":
          exit(CRMPricelevel.FIELDNO(Name));
        DATABASE::Item:
          exit(Item.FIELDNO("No."));
        DATABASE::Resource:
          exit(Resource.FIELDNO("No."));
        DATABASE::"CRM Product":
          exit(CRMProduct.FIELDNO(ProductNumber));
        DATABASE::"Salesperson/Purchaser":
          exit(SalespersonPurchaser.FIELDNO(Name));
        DATABASE::"CRM Systemuser":
          exit(CRMSystemuser.FIELDNO(FullName));
        DATABASE::"Unit of Measure":
          exit(UnitOfMeasure.FIELDNO(Code));
        DATABASE::"CRM Uomschedule":
          exit(CRMUomschedule.FIELDNO(Name));
        DATABASE::Opportunity:
          exit(Opportunity.FIELDNO(Description));
        DATABASE::"CRM Opportunity":
          exit(CRMOpportunity.FIELDNO(Name));
      end;
    END;

    LOCAL PROCEDURE GetTableFilterFromView@18(TableID@1000 : Integer;Caption@1001 : Text;View@1002 : Text) : Text;
    VAR
      FilterBuilder@1003 : FilterPageBuilder;
    BEGIN
      FilterBuilder.ADDTABLE(Caption,TableID);
      FilterBuilder.SETVIEW(Caption,View);
      exit(FilterBuilder.GETVIEW(Caption,true));
    END;

    [External]
    PROCEDURE GetPrioritizedMappingList@21(VAR NameValueBuffer@1000 : Record "Name/Value Buffer");
    VAR
      Field@1003 : Record Field;
      IntegrationTableMapping@1001 : Record "Integration Table Mapping";
      NextPriority@1002 : Integer;
    BEGIN
      NextPriority := 1;

      // 1) From CRM Systemusers
      AddPrioritizedMappingsToList(NameValueBuffer,NextPriority,0,DATABASE::"CRM Systemuser");
      // 2) From Currency
      AddPrioritizedMappingsToList(NameValueBuffer,NextPriority,DATABASE::Currency,0);
      // 3) From Unit of measure
      AddPrioritizedMappingsToList(NameValueBuffer,NextPriority,DATABASE::"Unit of Measure",0);
      // 4) To/From Customers/CRM Accounts
      AddPrioritizedMappingsToList(NameValueBuffer,NextPriority,DATABASE::Customer,DATABASE::"CRM Account");
      // 5) To/From Contacts/CRM Contacts
      AddPrioritizedMappingsToList(NameValueBuffer,NextPriority,DATABASE::Contact,DATABASE::"CRM Contact");
      // 6) From Items to CRM Products
      AddPrioritizedMappingsToList(NameValueBuffer,NextPriority,DATABASE::Item,DATABASE::"CRM Product");
      // 7) From Resources to CRM Products
      AddPrioritizedMappingsToList(NameValueBuffer,NextPriority,DATABASE::Resource,DATABASE::"CRM Product");

      IntegrationTableMapping.RESET;
      IntegrationTableMapping.SETFILTER("Parent Name",'=''''');
      IntegrationTableMapping.SETRANGE("Int. Table UID Field Type",Field.Type::GUID);
      if IntegrationTableMapping.FINDSET then
        repeat
          AddPrioritizedMappingToList(NameValueBuffer,NextPriority,IntegrationTableMapping.Name);
        until IntegrationTableMapping.NEXT = 0;
    END;

    LOCAL PROCEDURE AddPrioritizedMappingsToList@30(VAR NameValueBuffer@1002 : Record "Name/Value Buffer";VAR Priority@1001 : Integer;TableID@1000 : Integer;IntegrationTableID@1003 : Integer);
    VAR
      Field@1005 : Record Field;
      IntegrationTableMapping@1004 : Record "Integration Table Mapping";
    BEGIN
      with IntegrationTableMapping do begin
        RESET;
        SETRANGE("Delete After Synchronization",false);
        if TableID > 0 then
          SETRANGE("Table ID",TableID);
        if IntegrationTableID > 0 then
          SETRANGE("Integration Table ID",IntegrationTableID);
        SETRANGE("Int. Table UID Field Type",Field.Type::GUID);
        if FINDSET then
          repeat
            AddPrioritizedMappingToList(NameValueBuffer,Priority,Name);
          until NEXT = 0;
      end;
    END;

    LOCAL PROCEDURE AddPrioritizedMappingToList@24(VAR NameValueBuffer@1002 : Record "Name/Value Buffer";VAR Priority@1000 : Integer;MappingName@1001 : Code[20]);
    BEGIN
      with NameValueBuffer do begin
        SETRANGE(Value,MappingName);

        if not FINDFIRST then begin
          INIT;
          ID := Priority;
          Name := FORMAT(Priority);
          Value := MappingName;
          INSERT;
          Priority := Priority + 1;
        end;

        RESET;
      end;
    END;

    [External]
    PROCEDURE GetTableIDCRMEntityNameMapping@22(VAR TempNameValueBuffer@1000 : TEMPORARY Record "Name/Value Buffer");
    BEGIN
      TempNameValueBuffer.RESET;
      TempNameValueBuffer.DELETEALL;

      AddEntityTableMapping('systemuser',DATABASE::"Salesperson/Purchaser",TempNameValueBuffer);
      AddEntityTableMapping('systemuser',DATABASE::"CRM Systemuser",TempNameValueBuffer);

      AddEntityTableMapping('account',DATABASE::Customer,TempNameValueBuffer);
      AddEntityTableMapping('account',DATABASE::"CRM Account",TempNameValueBuffer);

      AddEntityTableMapping('contact',DATABASE::Contact,TempNameValueBuffer);
      AddEntityTableMapping('contact',DATABASE::"CRM Contact",TempNameValueBuffer);

      AddEntityTableMapping('product',DATABASE::Item,TempNameValueBuffer);
      AddEntityTableMapping('product',DATABASE::Resource,TempNameValueBuffer);
      AddEntityTableMapping('product',DATABASE::"CRM Product",TempNameValueBuffer);

      AddEntityTableMapping('salesorder',DATABASE::"Sales Header",TempNameValueBuffer);
      AddEntityTableMapping('salesorder',DATABASE::"CRM Salesorder",TempNameValueBuffer);

      AddEntityTableMapping('invoice',DATABASE::"Sales Invoice Header",TempNameValueBuffer);
      AddEntityTableMapping('invoice',DATABASE::"CRM Invoice",TempNameValueBuffer);

      AddEntityTableMapping('opportunity',DATABASE::Opportunity,TempNameValueBuffer);
      AddEntityTableMapping('opportunity',DATABASE::"CRM Opportunity",TempNameValueBuffer);

      // Only NAV
      AddEntityTableMapping('pricelevel',DATABASE::"Customer Price Group",TempNameValueBuffer);
      AddEntityTableMapping('transactioncurrency',DATABASE::Currency,TempNameValueBuffer);
      AddEntityTableMapping('uomschedule',DATABASE::"Unit of Measure",TempNameValueBuffer);

      // Only CRM
      AddEntityTableMapping('incident',DATABASE::"CRM Incident",TempNameValueBuffer);
      AddEntityTableMapping('quote',DATABASE::"CRM Quote",TempNameValueBuffer);
    END;

    LOCAL PROCEDURE AddEntityTableMapping@26(CRMEntityTypeName@1000 : Text;TableID@1001 : Integer;VAR TempNameValueBuffer@1002 : TEMPORARY Record "Name/Value Buffer");
    BEGIN
      with TempNameValueBuffer do begin
        INIT;
        ID := COUNT + 1;
        Name := COPYSTR(CRMEntityTypeName,1,MAXSTRLEN(Name));
        Value := FORMAT(TableID);
        INSERT;
      end;
    END;

    LOCAL PROCEDURE ResetAccountConfigTemplate@29() : Code[10];
    VAR
      AccountConfigTemplateHeader@1001 : Record "Config. Template Header";
      ConfigTemplateLine@1000 : Record "Config. Template Line";
      CRMAccount@1002 : Record "CRM Account";
    BEGIN
      ConfigTemplateLine.SETRANGE(
        "Data Template Code",COPYSTR(CRMAccountConfigTemplateCodeTok,1,MAXSTRLEN(AccountConfigTemplateHeader.Code)));
      ConfigTemplateLine.DELETEALL;
      AccountConfigTemplateHeader.SETRANGE(
        Code,COPYSTR(CRMAccountConfigTemplateCodeTok,1,MAXSTRLEN(AccountConfigTemplateHeader.Code)));
      AccountConfigTemplateHeader.DELETEALL;

      AccountConfigTemplateHeader.INIT;
      AccountConfigTemplateHeader.Code := COPYSTR(CRMAccountConfigTemplateCodeTok,1,MAXSTRLEN(AccountConfigTemplateHeader.Code));
      AccountConfigTemplateHeader.Description :=
        COPYSTR(CRMAccountConfigTemplateDescTxt,1,MAXSTRLEN(AccountConfigTemplateHeader.Description));
      AccountConfigTemplateHeader."Table ID" := DATABASE::"CRM Account";
      AccountConfigTemplateHeader.INSERT;
      ConfigTemplateLine.INIT;
      ConfigTemplateLine."Data Template Code" := AccountConfigTemplateHeader.Code;
      ConfigTemplateLine."Line No." := 1;
      ConfigTemplateLine.Type := ConfigTemplateLine.Type::Field;
      ConfigTemplateLine."Table ID" := DATABASE::"CRM Account";
      ConfigTemplateLine."Field ID" := CRMAccount.FIELDNO(CustomerTypeCode);
      ConfigTemplateLine."Field Name" := CRMAccount.FIELDNAME(CustomerTypeCode);
      ConfigTemplateLine."Default Value" := FORMAT(CRMAccount.CustomerTypeCode::Customer);
      ConfigTemplateLine.INSERT;

      exit(CRMAccountConfigTemplateCodeTok);
    END;

    LOCAL PROCEDURE ResetCustomerConfigTemplate@31() : Code[10];
    VAR
      ConfigTemplateHeader@1000 : Record "Config. Template Header";
      CustomerConfigTemplateHeader@1005 : Record "Config. Template Header";
      ConfigTemplateLine@1001 : Record "Config. Template Line";
      CustomerConfigTemplateLine@1006 : Record "Config. Template Line";
      Customer@1002 : Record Customer;
      FoundTemplateCode@1003 : Code[10];
    BEGIN
      CustomerConfigTemplateLine.SETRANGE(
        "Data Template Code",COPYSTR(CustomerConfigTemplateCodeTok,1,MAXSTRLEN(CustomerConfigTemplateLine."Data Template Code")));
      CustomerConfigTemplateLine.DELETEALL;
      CustomerConfigTemplateHeader.SETRANGE(
        Code,COPYSTR(CustomerConfigTemplateCodeTok,1,MAXSTRLEN(CustomerConfigTemplateHeader.Code)));
      CustomerConfigTemplateHeader.DELETEALL;

      // Base the customer config template off the first customer template with currency code '' (LCY);
      ConfigTemplateHeader.SETRANGE("Table ID",DATABASE::Customer);
      if ConfigTemplateHeader.FINDSET then
        repeat
          ConfigTemplateLine.SETRANGE("Data Template Code",ConfigTemplateHeader.Code);
          ConfigTemplateLine.SETRANGE("Field ID",Customer.FIELDNO("Currency Code"));
          ConfigTemplateLine.SETFILTER("Default Value",'');
          if ConfigTemplateLine.FINDFIRST then begin
            FoundTemplateCode := ConfigTemplateHeader.Code;
            break;
          end;
        until ConfigTemplateHeader.NEXT = 0;

      if FoundTemplateCode = '' then
        exit('');

      CustomerConfigTemplateHeader.INIT;
      CustomerConfigTemplateHeader.TRANSFERFIELDS(ConfigTemplateHeader,false);
      CustomerConfigTemplateHeader.Code := COPYSTR(CustomerConfigTemplateCodeTok,1,MAXSTRLEN(CustomerConfigTemplateHeader.Code));
      CustomerConfigTemplateHeader.Description :=
        COPYSTR(CustomerConfigTemplateDescTxt,1,MAXSTRLEN(CustomerConfigTemplateHeader.Description));
      CustomerConfigTemplateHeader.INSERT;

      ConfigTemplateLine.RESET;
      ConfigTemplateLine.SETRANGE("Data Template Code",ConfigTemplateHeader.Code);
      ConfigTemplateLine.FINDSET;
      repeat
        CustomerConfigTemplateLine.INIT;
        CustomerConfigTemplateLine.TRANSFERFIELDS(ConfigTemplateLine,true);
        CustomerConfigTemplateLine."Data Template Code" := CustomerConfigTemplateHeader.Code;
        CustomerConfigTemplateLine.INSERT;
      until ConfigTemplateLine.NEXT = 0;

      exit(CustomerConfigTemplateCodeTok);
    END;

    LOCAL PROCEDURE RegisterTempConnectionIfNeeded@15(CRMConnectionSetup@1000 : Record "CRM Connection Setup";VAR TempCRMConnectionSetup@1001 : TEMPORARY Record "CRM Connection Setup") ConnectionName : Text;
    BEGIN
      if CRMConnectionSetup."Is User Mapping Required" then begin
        ConnectionName := FORMAT(CREATEGUID);
        TempCRMConnectionSetup.TRANSFERFIELDS(CRMConnectionSetup);
        TempCRMConnectionSetup."Is User Mapping Required" := false;
        TempCRMConnectionSetup.RegisterConnectionWithName(ConnectionName);
      end;
    END;

    LOCAL PROCEDURE ResetDefaultCRMPricelevel@6(CRMConnectionSetup@1000 : Record "CRM Connection Setup");
    BEGIN
      CRMConnectionSetup.FIND;
      CLEAR(CRMConnectionSetup."Default CRM Price List ID");
      CRMConnectionSetup.MODIFY;
    END;

    LOCAL PROCEDURE SetIntegrationTableFilterForCRMProduct@17(VAR IntegrationTableMapping@1001 : Record "Integration Table Mapping";CRMProduct@1000 : Record "CRM Product";ProductTypeCode@1002 : Option);
    BEGIN
      CRMProduct.SETRANGE(ProductTypeCode,ProductTypeCode);
      IntegrationTableMapping.SetIntegrationTableFilter(
        GetTableFilterFromView(DATABASE::"CRM Product",CRMProduct.TABLECAPTION,CRMProduct.GETVIEW));
      IntegrationTableMapping.MODIFY;
    END;

    BEGIN
    END.
  }
}

