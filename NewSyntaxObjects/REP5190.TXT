OBJECT Report 5190 Delete Interaction Log Entries
{
  OBJECT-PROPERTIES
  {
    Date=20120907D;
    Time=120000T;
    Version List=NAVW17.00;
  }
  PROPERTIES
  {
    CaptionML=ENU=Delete Interaction Log Entries;
    ProcessingOnly=true;
    OnPostReport=BEGIN
                   MESSAGE(Text000,NoOfInteractions,"Interaction Log Entry".TABLECAPTION);
                 END;

  }
  DATASET
  {
    { 3056;    ;DataItem;Interaction Log Entry;
               DataItemTable="Interaction Log Entry";
               DataItemTableView=SORTING(Canceled,"Campaign No.","Campaign Entry No.",Date) WHERE(Canceled=CONST(true));
               OnAfterGetRecord=VAR
                                  SalesHeader@1000 : Record "Sales Header";
                                  SalesHeaderArchive@1001 : Record "Sales Header Archive";
                                  PurchHeader@1002 : Record "Purchase Header";
                                  PurchHeaderArchive@1003 : Record "Purchase Header Archive";
                                BEGIN
                                  if UniqueAttachment then begin
                                    Attachment.GET("Attachment No.");
                                    Attachment.DELETE(true);
                                  end;
                                  NoOfInteractions := NoOfInteractions + 1;

                                  if "Version No." <> 0 then
                                    case "Document Type" of
                                      "Document Type"::"Sales Qte.":
                                        begin
                                          SalesHeaderArchive.GET(
                                            SalesHeaderArchive."Document Type"::Quote,"Document No.",
                                            "Doc. No. Occurrence","Version No.");
                                          SalesHeader.SETRANGE("Document Type",SalesHeader."Document Type"::Quote);
                                          SalesHeader.SETRANGE("No.","Document No.");
                                          SalesHeader.SETRANGE("Doc. No. Occurrence","Doc. No. Occurrence");
                                          if SalesHeader.FINDFIRST then begin
                                            SalesHeaderArchive."Interaction Exist" := false;
                                            SalesHeaderArchive.MODIFY;
                                          end else
                                            SalesHeaderArchive.DELETE(true);
                                        end;
                                      "Document Type"::"Sales Ord. Cnfrmn.":
                                        begin
                                          SalesHeaderArchive.GET(
                                            SalesHeaderArchive."Document Type"::Order,"Document No.",
                                            "Doc. No. Occurrence","Version No.");
                                          SalesHeader.SETRANGE("Document Type",SalesHeader."Document Type"::Order);
                                          SalesHeader.SETRANGE("No.","Document No.");
                                          SalesHeader.SETRANGE("Doc. No. Occurrence","Doc. No. Occurrence");
                                          if SalesHeader.FINDFIRST then begin
                                            SalesHeaderArchive."Interaction Exist" := false;
                                            SalesHeaderArchive.MODIFY;
                                          end else
                                            SalesHeaderArchive.DELETE(true);
                                        end;
                                      "Document Type"::"Purch.Qte.":
                                        begin
                                          PurchHeaderArchive.GET(
                                            PurchHeaderArchive."Document Type"::Quote,"Document No.",
                                            "Doc. No. Occurrence","Version No.");
                                          PurchHeader.SETRANGE("Document Type",PurchHeader."Document Type"::Quote);
                                          PurchHeader.SETRANGE("No.","Document No.");
                                          PurchHeader.SETRANGE("Doc. No. Occurrence","Doc. No. Occurrence");
                                          if PurchHeader.FINDFIRST then begin
                                            PurchHeaderArchive."Interaction Exist" := false;
                                            PurchHeaderArchive.MODIFY;
                                          end else
                                            PurchHeaderArchive.DELETE(true);
                                        end;
                                      "Document Type"::"Purch. Ord.":
                                        begin
                                          PurchHeaderArchive.GET(
                                            PurchHeaderArchive."Document Type"::Order,"Document No.",
                                            "Doc. No. Occurrence","Version No.");
                                          PurchHeader.SETRANGE("Document Type",PurchHeader."Document Type"::Order);
                                          PurchHeader.SETRANGE("No.","Document No.");
                                          PurchHeader.SETRANGE("Doc. No. Occurrence","Doc. No. Occurrence");
                                          if PurchHeader.FINDFIRST then begin
                                            PurchHeaderArchive."Interaction Exist" := false;
                                            PurchHeaderArchive.MODIFY;
                                          end else
                                            PurchHeaderArchive.DELETE(true);
                                        end;
                                    end;
                                  DELETE(true);
                                END;

               ReqFilterFields="Entry No.","Contact No.",Date,"Campaign No.","Interaction Group Code","Interaction Template Code","Salesperson Code" }

  }
  REQUESTPAGE
  {
    PROPERTIES
    {
    }
    CONTROLS
    {
    }
  }
  LABELS
  {
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst 'ENU=%1 %2 has been deleted.';
      Attachment@1002 : Record Attachment;
      NoOfInteractions@1003 : Integer;

    BEGIN
    END.
  }
  RDLDATA
  {
  }
}

