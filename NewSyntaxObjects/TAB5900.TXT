OBJECT Table 5900 Service Header
{
  OBJECT-PROPERTIES
  {
    Date=20171006D;
    Time=120000T;
    Version List=NAVW111.0;
  }
  PROPERTIES
  {
    Permissions=TableData "Loaner Entry"=d,
                TableData "Service Order Allocation"=rimd;
    DataCaptionFields="No.",Name,Description;
    OnInsert=VAR
               ServShptHeader@1001 : Record "Service Shipment Header";
             BEGIN
               ServSetup.GET ;
               if "No." = '' then begin
                 TestNoSeries;
                 NoSeriesMgt.InitSeries(GetNoSeriesCode,xRec."No. Series",0D,"No.","No. Series");
               end;

               ServShptHeader.SETRANGE("Order No.","No.");
               if not ServShptHeader.ISEMPTY then
                 ERROR(Text008,FORMAT("Document Type"),FIELDCAPTION("No."),"No.");

               InitRecord;

               CLEAR(ServLogMgt);
               ServLogMgt.ServHeaderCreate(Rec);

               if "Salesperson Code" = '' then
                 SetDefaultSalesperson;

               if GETFILTER("Customer No.") <> '' then begin
                 CLEAR(xRec."Ship-to Code");
                 if GETRANGEMIN("Customer No.") = GETRANGEMAX("Customer No.") then
                   VALIDATE("Customer No.",GETRANGEMIN("Customer No."));
               end;

               if GETFILTER("Contact No.") <> '' then
                 if GETRANGEMIN("Contact No.") = GETRANGEMAX("Contact No.") then
                   VALIDATE("Contact No.",GETRANGEMIN("Contact No."));
             END;

    OnModify=BEGIN
               UpdateServiceOrderChangeLog(xRec);
             END;

    OnDelete=VAR
               ServDocRegister@1000 : Record "Service Document Register";
               ServDocLog@1001 : Record "Service Document Log";
               ServOrderAlloc@1007 : Record "Service Order Allocation";
               ServCommentLine@1008 : Record "Service Comment Line";
               WhseRequest@1003 : Record "Warehouse Request";
               Loaner@1006 : Record Loaner;
               LoanerEntry@1004 : Record "Loaner Entry";
               ServAllocMgt@1002 : Codeunit ServAllocationManagement;
               ReservMgt@1005 : Codeunit "Reservation Management";
             BEGIN
               if not UserSetupMgt.CheckRespCenter(2,"Responsibility Center") then
                 ERROR(Text000,UserSetupMgt.GetServiceFilter);

               if "Document Type" = "Document Type"::Invoice then begin
                 ServLine.RESET;
                 ServLine.SETRANGE("Document Type",ServLine."Document Type"::Invoice);
                 ServLine.SETRANGE("Document No.","No.");
                 ServLine.SETFILTER("Appl.-to Service Entry",'>%1',0);
                 if not ServLine.ISEMPTY then
                   ERROR(Text046,"No.");
               end;

               ServPost.DeleteHeader(Rec,ServShptHeader,ServInvHeader,ServCrMemoHeader);
               VALIDATE("Applies-to ID",'');

               ServLine.RESET;
               ServLine.LOCKTABLE;

               ReservMgt.DeleteDocumentReservation(DATABASE::"Service Line","Document Type","No.",HideValidationDialog);

               WhseRequest.DeleteRequest(DATABASE::"Service Line","Document Type","No.");

               ServLine.SETRANGE("Document Type","Document Type");
               ServLine.SETRANGE("Document No.","No.");
               ServLine.SuspendStatusCheck(true);
               ServLine.DELETEALL(true);

               ServCommentLine.RESET;
               ServCommentLine.SETRANGE("Table Name",ServCommentLine."Table Name"::"Service Header");
               ServCommentLine.SETRANGE("Table Subtype","Document Type");
               ServCommentLine.SETRANGE("No.","No.");
               ServCommentLine.DELETEALL;

               ServDocRegister.SETCURRENTKEY("Destination Document Type","Destination Document No.");
               case "Document Type" of
                 "Document Type"::Invoice:
                   begin
                     ServDocRegister.SETRANGE("Destination Document Type",ServDocRegister."Destination Document Type"::Invoice);
                     ServDocRegister.SETRANGE("Destination Document No.","No.");
                     ServDocRegister.DELETEALL;
                   end;
                 "Document Type"::"Credit Memo":
                   begin
                     ServDocRegister.SETRANGE("Destination Document Type",ServDocRegister."Destination Document Type"::"Credit Memo");
                     ServDocRegister.SETRANGE("Destination Document No.","No.");
                     ServDocRegister.DELETEALL;
                   end;
               end;

               ServOrderAlloc.RESET;
               ServOrderAlloc.SETCURRENTKEY("Document Type");
               ServOrderAlloc.SETRANGE("Document Type","Document Type");
               ServOrderAlloc.SETRANGE("Document No.","No.");
               ServOrderAlloc.SETRANGE(Posted,false);
               ServOrderAlloc.DELETEALL;
               ServAllocMgt.SetServOrderAllocStatus(Rec);

               ServItemLine.RESET;
               ServItemLine.SETRANGE("Document Type","Document Type");
               ServItemLine.SETRANGE("Document No.","No.");
               if ServItemLine.FIND('-') then
                 repeat
                   if ServItemLine."Loaner No." <> '' then begin
                     Loaner.GET(ServItemLine."Loaner No.");
                     LoanerEntry.SETRANGE("Document Type","Document Type" + 1);
                     LoanerEntry.SETRANGE("Document No.","No.");
                     LoanerEntry.SETRANGE("Loaner No.",ServItemLine."Loaner No.");
                     LoanerEntry.SETRANGE(Lent,true);
                     if not LoanerEntry.ISEMPTY then
                       ERROR(
                         Text040,
                         TABLECAPTION,
                         ServItemLine."Document No.",
                         ServItemLine."Line No.",
                         ServItemLine.FIELDCAPTION("Loaner No."),
                         ServItemLine."Loaner No.");

                     LoanerEntry.SETRANGE(Lent,true);
                     LoanerEntry.DELETEALL;
                   end;

                   CLEAR(ServLogMgt);
                   ServLogMgt.ServItemOffServOrder(ServItemLine);
                   ServItemLine.DELETE;
                 until ServItemLine.NEXT = 0;

               ServDocLog.RESET;
               ServDocLog.SETRANGE("Document Type","Document Type");
               ServDocLog.SETRANGE("Document No.","No.");
               ServDocLog.DELETEALL;

               ServDocLog.RESET;
               ServDocLog.SETRANGE(Before,"No.");
               ServDocLog.SETFILTER("Document Type",'%1|%2|%3',
                 ServDocLog."Document Type"::Shipment,ServDocLog."Document Type"::"Posted Invoice",
                 ServDocLog."Document Type"::"Posted Credit Memo");
               ServDocLog.DELETEALL;

               if (ServShptHeader."No." <> '') or
                  (ServInvHeader."No." <> '') or
                  (ServCrMemoHeader."No." <> '')
               then
                 MESSAGE(PostedDocsToPrintCreatedMsg);
             END;

    OnRename=BEGIN
               ERROR(Text044,TABLECAPTION);
             END;

    CaptionML=ENU=Service Header;
    LookupPageID="Service List";
    DrillDownPageID="Service List";
  }
  FIELDS
  {
    { 1   ;   ;Document Type       ;Option        ;CaptionML=ENU=Document Type;
                                                   OptionCaptionML=ENU=Quote,Order,Invoice,Credit Memo;
                                                   OptionString=Quote,Order,Invoice,"Credit Memo" }
    { 2   ;   ;Customer No.        ;Code20        ;TableRelation=Customer;
                                                   OnValidate=BEGIN
                                                                if ("Customer No." <> xRec."Customer No.") and (xRec."Customer No." <> '') then begin
                                                                  if "Contract No." <> '' then
                                                                    ERROR(
                                                                      Text003,
                                                                      FIELDCAPTION("Customer No."),
                                                                      "Document Type",FIELDCAPTION("No."),"No.",
                                                                      FIELDCAPTION("Contract No."),"Contract No.");
                                                                  if HideValidationDialog or not GUIALLOWED then
                                                                    Confirmed := true
                                                                  else
                                                                    if ServItemLineExists then
                                                                      Confirmed :=
                                                                        CONFIRM(
                                                                          Text004,
                                                                          false,FIELDCAPTION("Customer No."))
                                                                    else
                                                                      if ServLineExists then
                                                                        Confirmed :=
                                                                          CONFIRM(
                                                                            Text057,
                                                                            false,FIELDCAPTION("Customer No."))
                                                                      else
                                                                        Confirmed := CONFIRM(Text005,false,FIELDCAPTION("Customer No."));
                                                                  if Confirmed then begin
                                                                    ServLine.SETRANGE("Document Type","Document Type");
                                                                    ServLine.SETRANGE("Document No.","No.");
                                                                    if "Document Type" = "Document Type"::Order then
                                                                      ServLine.SETFILTER("Quantity Shipped",'<>0')
                                                                    else
                                                                      if "Document Type" = "Document Type"::Invoice then begin
                                                                        ServLine.SETRANGE("Customer No.",xRec."Customer No.");
                                                                        ServLine.SETFILTER("Shipment No.",'<>%1','');
                                                                      end;

                                                                    if ServLine.FINDFIRST then begin
                                                                      if "Document Type" = "Document Type"::Order then
                                                                        ServLine.TESTFIELD("Quantity Shipped",0)
                                                                      else
                                                                        ServLine.TESTFIELD("Shipment No.",'');
                                                                    end;
                                                                    MODIFY(true);

                                                                    ServLine.LOCKTABLE;
                                                                    ServLine.RESET;
                                                                    ServLine.SETRANGE("Document Type","Document Type");
                                                                    ServLine.SETRANGE("Document No.","No.");
                                                                    ServLine.DELETEALL(true);

                                                                    ServItemLine.LOCKTABLE;
                                                                    ServItemLine.RESET;
                                                                    ServItemLine.SETRANGE("Document Type","Document Type");
                                                                    ServItemLine.SETRANGE("Document No.","No.");
                                                                    ServItemLine.DELETEALL(true);

                                                                    GET("Document Type","No.");
                                                                    if "Customer No." = '' then begin
                                                                      INIT;
                                                                      ServSetup.GET;
                                                                      "No. Series" := xRec."No. Series";
                                                                      InitRecord;
                                                                      if xRec."Shipping No." <> '' then begin
                                                                        "Shipping No. Series" := xRec."Shipping No. Series";
                                                                        "Shipping No." := xRec."Shipping No.";
                                                                      end;
                                                                      if xRec."Posting No." <> '' then begin
                                                                        "Posting No. Series" := xRec."Posting No. Series";
                                                                        "Posting No." := xRec."Posting No.";
                                                                      end;
                                                                      exit;
                                                                    end;
                                                                  end else begin
                                                                    Rec := xRec;
                                                                    exit;
                                                                  end;
                                                                end;

                                                                GetCust("Customer No.");
                                                                if "Customer No." <> '' then begin
                                                                  Cust.CheckBlockedCustOnDocs(Cust,"Document Type",false,false);
                                                                  Cust.TESTFIELD("Gen. Bus. Posting Group");
                                                                  Name := Cust.Name;
                                                                  "Name 2" := Cust."Name 2";
                                                                  Address := Cust.Address;
                                                                  "Address 2" := Cust."Address 2";
                                                                  City := Cust.City;
                                                                  "Post Code" := Cust."Post Code";
                                                                  County := Cust.County;
                                                                  "Country/Region Code" := Cust."Country/Region Code";
                                                                  if not SkipContact then begin
                                                                    "Contact Name" := Cust.Contact;
                                                                    "Phone No." := Cust."Phone No.";
                                                                    "E-Mail" := Cust."E-Mail";
                                                                  end;
                                                                  "Gen. Bus. Posting Group" := Cust."Gen. Bus. Posting Group";
                                                                  "VAT Bus. Posting Group" := Cust."VAT Bus. Posting Group";
                                                                  "Tax Area Code" := Cust."Tax Area Code";
                                                                  "Tax Liable" := Cust."Tax Liable";
                                                                  "VAT Registration No." := Cust."VAT Registration No.";
                                                                  "Shipping Advice" := Cust."Shipping Advice";
                                                                  "Responsibility Center" := UserSetupMgt.GetRespCenter(2,Cust."Responsibility Center");
                                                                  VALIDATE("Location Code",UserSetupMgt.GetLocation(2,Cust."Location Code","Responsibility Center"));
                                                                end;

                                                                if "Customer No." = xRec."Customer No." then
                                                                  if ShippedServLinesExist then begin
                                                                    TESTFIELD("VAT Bus. Posting Group",xRec."VAT Bus. Posting Group");
                                                                    TESTFIELD("Gen. Bus. Posting Group",xRec."Gen. Bus. Posting Group");
                                                                  end;

                                                                COMMIT;
                                                                if Cust."Bill-to Customer No." <> '' then
                                                                  VALIDATE("Bill-to Customer No.",Cust."Bill-to Customer No.")
                                                                else begin
                                                                  if "Bill-to Customer No." = "Customer No." then
                                                                    SkipBillToContact := true;
                                                                  VALIDATE("Bill-to Customer No.","Customer No.");
                                                                  SkipBillToContact := false;
                                                                end;

                                                                VALIDATE("Ship-to Code",'');
                                                                VALIDATE("Service Zone Code");

                                                                if not SkipContact then
                                                                  UpdateCont("Customer No.");
                                                              END;

                                                   CaptionML=ENU=Customer No. }
    { 3   ;   ;No.                 ;Code20        ;OnValidate=BEGIN
                                                                if "No." <> xRec."No." then begin
                                                                  ServSetup.GET;
                                                                  TestNoSeriesManual;
                                                                  "No. Series" := '';
                                                                end;
                                                              END;

                                                   CaptionML=ENU=No. }
    { 4   ;   ;Bill-to Customer No.;Code20        ;TableRelation=Customer;
                                                   OnValidate=VAR
                                                                PaymentTerms@1001 : Record "Payment Terms";
                                                                CustCheckCrLimit@1000 : Codeunit "Cust-Check Cr. Limit";
                                                              BEGIN
                                                                if (xRec."Bill-to Customer No." <> "Bill-to Customer No.") and
                                                                   (xRec."Bill-to Customer No." <> '')
                                                                then begin
                                                                  if HideValidationDialog or not GUIALLOWED then
                                                                    Confirmed := true
                                                                  else
                                                                    Confirmed := CONFIRM(Text005,false,FIELDCAPTION("Bill-to Customer No."));
                                                                  if Confirmed then begin
                                                                    ServLine.SETRANGE("Document Type","Document Type");
                                                                    ServLine.SETRANGE("Document No.","No.");
                                                                    if "Document Type" = "Document Type"::Order then
                                                                      ServLine.SETFILTER("Quantity Shipped",'<>0')
                                                                    else
                                                                      if "Document Type" = "Document Type"::Invoice then
                                                                        ServLine.SETFILTER("Shipment No.",'<>%1','');

                                                                    if ServLine.FINDFIRST then
                                                                      if "Document Type" = "Document Type"::Order then
                                                                        ServLine.TESTFIELD("Quantity Shipped",0)
                                                                      else
                                                                        ServLine.TESTFIELD("Shipment No.",'');
                                                                    ServLine.RESET;
                                                                  end else
                                                                    "Bill-to Customer No." := xRec."Bill-to Customer No.";
                                                                end;

                                                                GetCust("Bill-to Customer No.");
                                                                Cust.CheckBlockedCustOnDocs(Cust,"Document Type",false,false);
                                                                Cust.TESTFIELD("Customer Posting Group");

                                                                if GUIALLOWED and not HideValidationDialog and
                                                                   ("Document Type" in ["Document Type"::Quote,"Document Type"::Order,"Document Type"::Invoice])
                                                                then
                                                                  CustCheckCrLimit.ServiceHeaderCheck(Rec);

                                                                "Bill-to Name" := Cust.Name;
                                                                "Bill-to Name 2" := Cust."Name 2";
                                                                "Bill-to Address" := Cust.Address;
                                                                "Bill-to Address 2" := Cust."Address 2";
                                                                "Bill-to City" := Cust.City;
                                                                "Bill-to Post Code" := Cust."Post Code";
                                                                "Bill-to County" := Cust.County;
                                                                "Bill-to Country/Region Code" := Cust."Country/Region Code";
                                                                if not SkipBillToContact then
                                                                  "Bill-to Contact" := Cust.Contact;
                                                                "Payment Terms Code" := Cust."Payment Terms Code";

                                                                if "Document Type" = "Document Type"::"Credit Memo" then begin
                                                                  "Payment Method Code" := '';
                                                                  if PaymentTerms.GET("Payment Terms Code") then
                                                                    if PaymentTerms."Calc. Pmt. Disc. on Cr. Memos" then
                                                                      "Payment Method Code" := Cust."Payment Method Code"
                                                                end else
                                                                  "Payment Method Code" := Cust."Payment Method Code";
                                                                GLSetup.GET;
                                                                if GLSetup."Bill-to/Sell-to VAT Calc." = GLSetup."Bill-to/Sell-to VAT Calc."::"Bill-to/Pay-to No." then begin
                                                                  "VAT Bus. Posting Group" := Cust."VAT Bus. Posting Group";
                                                                  "VAT Registration No." := Cust."VAT Registration No.";
                                                                  "VAT Country/Region Code" := Cust."Country/Region Code";
                                                                  "Gen. Bus. Posting Group" := Cust."Gen. Bus. Posting Group";
                                                                end;
                                                                "Customer Posting Group" := Cust."Customer Posting Group";
                                                                "Currency Code" := Cust."Currency Code";
                                                                "Customer Price Group" := Cust."Customer Price Group";
                                                                "Prices Including VAT" := Cust."Prices Including VAT";
                                                                "Allow Line Disc." := Cust."Allow Line Disc.";
                                                                "Invoice Disc. Code" := Cust."Invoice Disc. Code";
                                                                "Customer Disc. Group" := Cust."Customer Disc. Group";
                                                                "Language Code" := Cust."Language Code";
                                                                "Salesperson Code" := Cust."Salesperson Code";
                                                                Reserve := Cust.Reserve;
                                                                ValidateServPriceGrOnServItem;

                                                                if "Bill-to Customer No." = xRec."Bill-to Customer No." then
                                                                  if ShippedServLinesExist then begin
                                                                    TESTFIELD("Customer Disc. Group",xRec."Customer Disc. Group");
                                                                    TESTFIELD("Currency Code",xRec."Currency Code");
                                                                  end;

                                                                CreateDim(
                                                                  DATABASE::"Service Order Type","Service Order Type",
                                                                  DATABASE::Customer,"Bill-to Customer No.",
                                                                  DATABASE::"Salesperson/Purchaser","Salesperson Code",
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::"Service Contract Header","Contract No.");

                                                                VALIDATE("Payment Terms Code");
                                                                VALIDATE("Payment Method Code");
                                                                VALIDATE("Currency Code");

                                                                if (xRec."Customer No." = "Customer No.") and
                                                                   (xRec."Bill-to Customer No." <> "Bill-to Customer No.")
                                                                then
                                                                  RecreateServLines(FIELDCAPTION("Bill-to Customer No."));

                                                                if not SkipBillToContact then
                                                                  UpdateBillToCont("Bill-to Customer No.");
                                                              END;

                                                   CaptionML=ENU=Bill-to Customer No.;
                                                   NotBlank=true }
    { 5   ;   ;Bill-to Name        ;Text50        ;CaptionML=ENU=Bill-to Name }
    { 6   ;   ;Bill-to Name 2      ;Text50        ;CaptionML=ENU=Bill-to Name 2 }
    { 7   ;   ;Bill-to Address     ;Text50        ;CaptionML=ENU=Bill-to Address }
    { 8   ;   ;Bill-to Address 2   ;Text50        ;CaptionML=ENU=Bill-to Address 2 }
    { 9   ;   ;Bill-to City        ;Text30        ;TableRelation=IF ("Bill-to Country/Region Code"=CONST('')) "Post Code".City
                                                                 ELSE IF ("Bill-to Country/Region Code"=FILTER(<>'')) "Post Code".City WHERE ("Country/Region Code"=FIELD("Bill-to Country/Region Code"));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(
                                                                  "Bill-to City","Bill-to Post Code","Bill-to County","Bill-to Country/Region Code",(CurrFieldNo <> 0) and GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=false;
                                                   TestTableRelation=false;
                                                   CaptionML=ENU=Bill-to City }
    { 10  ;   ;Bill-to Contact     ;Text50        ;CaptionML=ENU=Bill-to Contact }
    { 11  ;   ;Your Reference      ;Text35        ;CaptionML=ENU=Your Reference }
    { 12  ;   ;Ship-to Code        ;Code10        ;TableRelation="Ship-to Address".Code WHERE ("Customer No."=FIELD("Customer No."));
                                                   OnValidate=VAR
                                                                ShipToAddr@1000 : Record "Ship-to Address";
                                                              BEGIN
                                                                if ("Ship-to Code" <> xRec."Ship-to Code") and
                                                                   ("Customer No." = xRec."Customer No.")
                                                                then begin
                                                                  if ("Contract No." <> '') and not HideValidationDialog then
                                                                    ERROR(
                                                                      Text003,
                                                                      FIELDCAPTION("Ship-to Code"),
                                                                      "Document Type",FIELDCAPTION("No."),"No.",
                                                                      FIELDCAPTION("Contract No."),"Contract No.");
                                                                  if ServItemLineExists then begin
                                                                    if not
                                                                       CONFIRM(
                                                                         Text004,
                                                                         false,FIELDCAPTION("Ship-to Code"))
                                                                    then begin
                                                                      "Ship-to Code" := xRec."Ship-to Code";
                                                                      exit;
                                                                    end;
                                                                  end else
                                                                    if ServLineExists then
                                                                      if not
                                                                         CONFIRM(
                                                                           Text057,
                                                                           false,FIELDCAPTION("Ship-to Code"))
                                                                      then begin
                                                                        "Ship-to Code" := xRec."Ship-to Code";
                                                                        exit;
                                                                      end;
                                                                end;

                                                                if "Document Type" <> "Document Type"::"Credit Memo" then
                                                                  if "Ship-to Code" <> '' then begin
                                                                    if xRec."Ship-to Code" <> '' then begin
                                                                      GetCust("Customer No.");
                                                                      if Cust."Location Code" <> '' then
                                                                        "Location Code" := Cust."Location Code";
                                                                      "Tax Area Code" := Cust."Tax Area Code";
                                                                    end;
                                                                    ShipToAddr.GET("Customer No.","Ship-to Code");
                                                                    SetShipToAddress(
                                                                      ShipToAddr.Name,ShipToAddr."Name 2",ShipToAddr.Address,ShipToAddr."Address 2",
                                                                      ShipToAddr.City,ShipToAddr."Post Code",ShipToAddr.County,ShipToAddr."Country/Region Code");
                                                                    "Ship-to Contact" := ShipToAddr.Contact;
                                                                    "Ship-to Phone" := ShipToAddr."Phone No.";
                                                                    if ShipToAddr."Location Code" <> '' then
                                                                      "Location Code" := ShipToAddr."Location Code";
                                                                    "Ship-to Fax No." := ShipToAddr."Fax No.";
                                                                    "Ship-to E-Mail" := ShipToAddr."E-Mail";
                                                                    if ShipToAddr."Tax Area Code" <> '' then
                                                                      "Tax Area Code" := ShipToAddr."Tax Area Code";
                                                                    "Tax Liable" := ShipToAddr."Tax Liable";
                                                                  end else
                                                                    if "Customer No." <> '' then begin
                                                                      GetCust("Customer No.");
                                                                      SetShipToAddress(
                                                                        Cust.Name,Cust."Name 2",Cust.Address,Cust."Address 2",
                                                                        Cust.City,Cust."Post Code",Cust.County,Cust."Country/Region Code");
                                                                      "Ship-to Contact" := Cust.Contact;
                                                                      "Ship-to Phone" := Cust."Phone No.";
                                                                      "Tax Area Code" := Cust."Tax Area Code";
                                                                      "Tax Liable" := Cust."Tax Liable";
                                                                      if Cust."Location Code" <> '' then
                                                                        "Location Code" := Cust."Location Code";
                                                                      "Ship-to Fax No." := Cust."Fax No.";
                                                                      "Ship-to E-Mail" := Cust."E-Mail";
                                                                    end;

                                                                if (xRec."Customer No." = "Customer No.") and
                                                                   (xRec."Ship-to Code" <> "Ship-to Code")
                                                                then
                                                                  if (xRec."VAT Country/Region Code" <> "VAT Country/Region Code") or
                                                                     (xRec."Tax Area Code" <> "Tax Area Code")
                                                                  then
                                                                    RecreateServLines(FIELDCAPTION("Ship-to Code"))
                                                                  else begin
                                                                    if xRec."Tax Liable" <> "Tax Liable" then
                                                                      VALIDATE("Tax Liable");
                                                                  end;

                                                                VALIDATE("Service Zone Code");

                                                                if ("Ship-to Code" <> xRec."Ship-to Code") and
                                                                   ("Customer No." = xRec."Customer No.")
                                                                then begin
                                                                  MODIFY(true);
                                                                  ServLine.LOCKTABLE;
                                                                  ServItemLine.LOCKTABLE;
                                                                  ServLine.RESET;
                                                                  ServLine.SETRANGE("Document Type","Document Type");
                                                                  ServLine.SETRANGE("Document No.","No.");
                                                                  ServLine.DELETEALL(true);
                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","No.");
                                                                  ServItemLine.DELETEALL(true);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Ship-to Code }
    { 13  ;   ;Ship-to Name        ;Text50        ;CaptionML=ENU=Ship-to Name }
    { 14  ;   ;Ship-to Name 2      ;Text50        ;CaptionML=ENU=Ship-to Name 2 }
    { 15  ;   ;Ship-to Address     ;Text50        ;CaptionML=ENU=Ship-to Address }
    { 16  ;   ;Ship-to Address 2   ;Text50        ;CaptionML=ENU=Ship-to Address 2 }
    { 17  ;   ;Ship-to City        ;Text30        ;TableRelation=IF ("Ship-to Country/Region Code"=CONST('')) "Post Code".City
                                                                 ELSE IF ("Ship-to Country/Region Code"=FILTER(<>'')) "Post Code".City WHERE ("Country/Region Code"=FIELD("Ship-to Country/Region Code"));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(
                                                                  "Ship-to City","Ship-to Post Code","Ship-to County","Ship-to Country/Region Code",(CurrFieldNo <> 0) and GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=false;
                                                   TestTableRelation=false;
                                                   CaptionML=ENU=Ship-to City }
    { 18  ;   ;Ship-to Contact     ;Text50        ;CaptionML=ENU=Ship-to Contact }
    { 19  ;   ;Order Date          ;Date          ;OnValidate=BEGIN
                                                                if "Order Date" <> xRec."Order Date" then begin
                                                                  if ("Order Date" > "Starting Date") and
                                                                     ("Starting Date" <> 0D)
                                                                  then
                                                                    ERROR(Text007,FIELDCAPTION("Order Date"),FIELDCAPTION("Starting Date"));

                                                                  if ("Order Date" > "Finishing Date") and
                                                                     ("Finishing Date" <> 0D)
                                                                  then
                                                                    ERROR(Text007,FIELDCAPTION("Order Date"),FIELDCAPTION("Finishing Date"));

                                                                  if "Starting Time" <> 000000T then
                                                                    VALIDATE("Starting Time");
                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETCURRENTKEY("Document Type","Document No.","Starting Date");
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","No.");
                                                                  ServItemLine.SETFILTER("Starting Date",'<>%1',0D);
                                                                  if ServItemLine.FIND('-') then
                                                                    repeat
                                                                      if ServItemLine."Starting Date" < "Order Date" then
                                                                        ERROR(
                                                                          Text027,FIELDCAPTION("Order Date"),
                                                                          ServItemLine.FIELDCAPTION("Starting Date"));
                                                                    until ServItemLine.NEXT = 0;

                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","No.");
                                                                  if ServItemLine.FIND('-') then
                                                                    repeat
                                                                      ServItemLine.CheckWarranty("Order Date");
                                                                      ServItemLine.CalculateResponseDateTime("Order Date","Order Time");
                                                                      ServItemLine.MODIFY;
                                                                    until ServItemLine.NEXT = 0;
                                                                  UpdateServLines(FIELDCAPTION("Order Date"),false);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Order Date;
                                                   NotBlank=true }
    { 20  ;   ;Posting Date        ;Date          ;OnValidate=VAR
                                                                NoSeries@1000 : Record "No. Series";
                                                              BEGIN
                                                                if ("Posting No." <> '') and ("Posting No. Series" <> '') then begin
                                                                  NoSeries.GET("Posting No. Series");
                                                                  if NoSeries."Date Order" then
                                                                    ERROR(
                                                                      Text045,
                                                                      FIELDCAPTION("Posting Date"),FIELDCAPTION("Posting No. Series"),"Posting No. Series",
                                                                      NoSeries.FIELDCAPTION("Date Order"),NoSeries."Date Order","Document Type",
                                                                      FIELDCAPTION("Posting No."),"Posting No.");
                                                                end;

                                                                VALIDATE("Document Date","Posting Date");

                                                                ServLine.SETRANGE("Document Type","Document Type");
                                                                ServLine.SETRANGE("Document No.","No.");
                                                                if ServLine.FINDSET then
                                                                  repeat
                                                                    if "Posting Date" <> ServLine."Posting Date" then begin
                                                                      ServLine."Posting Date" := "Posting Date";
                                                                      ServLine.MODIFY;
                                                                    end;
                                                                  until ServLine.NEXT = 0;

                                                                if ("Document Type" in ["Document Type"::Invoice,"Document Type"::"Credit Memo"]) and
                                                                   not ("Posting Date" = xRec."Posting Date")
                                                                then begin
                                                                  if ServLineExists then
                                                                    ServLine.MODIFYALL("Posting Date","Posting Date");
                                                                end;

                                                                if "Currency Code" <> '' then begin
                                                                  UpdateCurrencyFactor;
                                                                  if "Currency Factor" <> xRec."Currency Factor" then
                                                                    ConfirmUpdateCurrencyFactor;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Posting Date }
    { 22  ;   ;Posting Description ;Text50        ;CaptionML=ENU=Posting Description }
    { 23  ;   ;Payment Terms Code  ;Code10        ;TableRelation="Payment Terms";
                                                   OnValidate=VAR
                                                                PaymentTerms@1000 : Record "Payment Terms";
                                                              BEGIN
                                                                if ("Payment Terms Code" <> '') and ("Document Date" <> 0D) then begin
                                                                  PaymentTerms.GET("Payment Terms Code");
                                                                  if ("Document Type" in ["Document Type"::"Credit Memo"]) and
                                                                     not PaymentTerms."Calc. Pmt. Disc. on Cr. Memos"
                                                                  then begin
                                                                    VALIDATE("Due Date","Document Date");
                                                                    VALIDATE("Pmt. Discount Date",0D);
                                                                    VALIDATE("Payment Discount %",0);
                                                                  end else begin
                                                                    "Due Date" := CALCDATE(PaymentTerms."Due Date Calculation","Document Date");
                                                                    "Pmt. Discount Date" := CALCDATE(PaymentTerms."Discount Date Calculation","Document Date");
                                                                    VALIDATE("Payment Discount %",PaymentTerms."Discount %")
                                                                  end;
                                                                end else begin
                                                                  VALIDATE("Due Date","Document Date");
                                                                  VALIDATE("Pmt. Discount Date",0D);
                                                                  VALIDATE("Payment Discount %",0);
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Payment Terms Code }
    { 24  ;   ;Due Date            ;Date          ;CaptionML=ENU=Due Date }
    { 25  ;   ;Payment Discount %  ;Decimal       ;OnValidate=BEGIN
                                                                GLSetup.GET;
                                                                if "Payment Discount %" < GLSetup."VAT Tolerance %" then
                                                                  "VAT Base Discount %" := "Payment Discount %"
                                                                else
                                                                  "VAT Base Discount %" := GLSetup."VAT Tolerance %";
                                                                VALIDATE("VAT Base Discount %");
                                                              END;

                                                   CaptionML=ENU=Payment Discount %;
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 26  ;   ;Pmt. Discount Date  ;Date          ;CaptionML=ENU=Pmt. Discount Date }
    { 27  ;   ;Shipment Method Code;Code10        ;TableRelation="Shipment Method";
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Release Status","Release Status"::Open);
                                                              END;

                                                   CaptionML=ENU=Shipment Method Code }
    { 28  ;   ;Location Code       ;Code10        ;TableRelation=Location;
                                                   OnValidate=BEGIN
                                                                if ("Location Code" <> xRec."Location Code") and
                                                                   ("Customer No." = xRec."Customer No.")
                                                                then
                                                                  MessageIfServLinesExist(FIELDCAPTION("Location Code"));

                                                                UpdateShipToAddress;
                                                              END;

                                                   CaptionML=ENU=Location Code }
    { 29  ;   ;Shortcut Dimension 1 Code;Code20   ;TableRelation="Dimension Value".Code WHERE ("Global Dimension No."=CONST(1),
                                                                                               Blocked=CONST(false));
                                                   OnValidate=BEGIN
                                                                CheckHeaderDimension;
                                                                ValidateShortcutDimCode(1,"Shortcut Dimension 1 Code");
                                                              END;

                                                   CaptionML=ENU=Shortcut Dimension 1 Code;
                                                   CaptionClass='1,2,1' }
    { 30  ;   ;Shortcut Dimension 2 Code;Code20   ;TableRelation="Dimension Value".Code WHERE ("Global Dimension No."=CONST(2),
                                                                                               Blocked=CONST(false));
                                                   OnValidate=BEGIN
                                                                CheckHeaderDimension;
                                                                ValidateShortcutDimCode(2,"Shortcut Dimension 2 Code");
                                                              END;

                                                   CaptionML=ENU=Shortcut Dimension 2 Code;
                                                   CaptionClass='1,2,2' }
    { 31  ;   ;Customer Posting Group;Code20      ;TableRelation="Customer Posting Group";
                                                   CaptionML=ENU=Customer Posting Group;
                                                   Editable=false }
    { 32  ;   ;Currency Code       ;Code10        ;TableRelation=Currency;
                                                   OnValidate=BEGIN
                                                                if CurrFieldNo <> FIELDNO("Currency Code") then
                                                                  UpdateCurrencyFactor
                                                                else
                                                                  if "Currency Code" <> xRec."Currency Code" then begin
                                                                    if ServLineExists and ("Contract No." <> '') and
                                                                       ("Document Type" in ["Document Type"::Invoice,"Document Type"::"Credit Memo"])
                                                                    then
                                                                      ERROR(Text058,FIELDCAPTION("Currency Code"),"Document Type","No.","Contract No.");

                                                                    UpdateCurrencyFactor;
                                                                    ValidateServPriceGrOnServItem;
                                                                    RecreateServLines(FIELDCAPTION("Currency Code"));
                                                                  end else
                                                                    if "Currency Code" <> '' then begin
                                                                      UpdateCurrencyFactor;
                                                                      if "Currency Factor" <> xRec."Currency Factor" then
                                                                        ConfirmUpdateCurrencyFactor;
                                                                    end;
                                                              END;

                                                   CaptionML=ENU=Currency Code }
    { 33  ;   ;Currency Factor     ;Decimal       ;OnValidate=BEGIN
                                                                if "Currency Factor" <> xRec."Currency Factor" then
                                                                  UpdateServLines(FIELDCAPTION("Currency Factor"),false);
                                                              END;

                                                   CaptionML=ENU=Currency Factor;
                                                   DecimalPlaces=0:15;
                                                   MinValue=0;
                                                   Editable=false }
    { 34  ;   ;Customer Price Group;Code10        ;TableRelation="Customer Price Group";
                                                   OnValidate=BEGIN
                                                                PriceMsgIfServLinesExist(FIELDCAPTION("Customer Price Group"));
                                                              END;

                                                   CaptionML=ENU=Customer Price Group }
    { 35  ;   ;Prices Including VAT;Boolean       ;OnValidate=VAR
                                                                ServLine@1002 : Record "Service Line";
                                                                Currency@1001 : Record Currency;
                                                                RecalculatePrice@1000 : Boolean;
                                                              BEGIN
                                                                if "Prices Including VAT" <> xRec."Prices Including VAT" then begin
                                                                  TESTFIELD("Max. Labor Unit Price",0);
                                                                  ServLine.SETRANGE("Document Type","Document Type");
                                                                  ServLine.SETRANGE("Document No.","No.");
                                                                  ServLine.SETFILTER(Type,'>0');
                                                                  ServLine.SETFILTER(Quantity,'<>0');
                                                                  if ServLine.FIND('-') then
                                                                    repeat
                                                                      ServLine.Amount := 0;
                                                                      ServLine."Amount Including VAT" := 0;
                                                                      ServLine."VAT Base Amount" := 0;
                                                                      ServLine.InitOutstandingAmount;
                                                                      ServLine.MODIFY;
                                                                    until ServLine.NEXT = 0;
                                                                  ServLine.SETRANGE(Type);
                                                                  ServLine.SETRANGE(Quantity);

                                                                  ServLine.SETFILTER("Unit Price",'<>%1',0);
                                                                  ServLine.SETFILTER("VAT %",'<>%1',0);
                                                                  if ServLine.FIND('-') then begin
                                                                    RecalculatePrice :=
                                                                      CONFIRM(
                                                                        STRSUBSTNO(
                                                                          Text055,
                                                                          FIELDCAPTION("Prices Including VAT"),ServLine.FIELDCAPTION("Unit Price")),
                                                                        true);
                                                                    ServLine.SetServHeader(Rec);

                                                                    if "Currency Code" = '' then
                                                                      Currency.InitRoundingPrecision
                                                                    else
                                                                      Currency.GET("Currency Code");

                                                                    repeat
                                                                      ServLine.TESTFIELD("Quantity Invoiced",0);
                                                                      if not RecalculatePrice then begin
                                                                        ServLine."VAT Difference" := 0;
                                                                        ServLine.InitOutstandingAmount;
                                                                      end else
                                                                        if "Prices Including VAT" then begin
                                                                          ServLine."Unit Price" :=
                                                                            ROUND(
                                                                              ServLine."Unit Price" * (1 + (ServLine."VAT %" / 100)),
                                                                              Currency."Unit-Amount Rounding Precision");
                                                                          if ServLine.Quantity <> 0 then begin
                                                                            ServLine."Line Discount Amount" :=
                                                                              ROUND(
                                                                                ServLine.CalcChargeableQty * ServLine."Unit Price" * ServLine."Line Discount %" / 100,
                                                                                Currency."Amount Rounding Precision");
                                                                            ServLine.VALIDATE("Inv. Discount Amount",
                                                                              ROUND(
                                                                                ServLine."Inv. Discount Amount" * (1 + (ServLine."VAT %" / 100)),
                                                                                Currency."Amount Rounding Precision"));
                                                                          end;
                                                                        end else begin
                                                                          ServLine."Unit Price" :=
                                                                            ROUND(
                                                                              ServLine."Unit Price" / (1 + (ServLine."VAT %" / 100)),
                                                                              Currency."Unit-Amount Rounding Precision");
                                                                          if ServLine.Quantity <> 0 then begin
                                                                            ServLine."Line Discount Amount" :=
                                                                              ROUND(
                                                                                ServLine.CalcChargeableQty * ServLine."Unit Price" * ServLine."Line Discount %" / 100,
                                                                                Currency."Amount Rounding Precision");
                                                                            ServLine.VALIDATE("Inv. Discount Amount",
                                                                              ROUND(
                                                                                ServLine."Inv. Discount Amount" / (1 + (ServLine."VAT %" / 100)),
                                                                                Currency."Amount Rounding Precision"));
                                                                          end;
                                                                        end;
                                                                      ServLine.MODIFY;
                                                                    until ServLine.NEXT = 0;
                                                                  end;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Prices Including VAT }
    { 37  ;   ;Invoice Disc. Code  ;Code20        ;OnLookup=BEGIN
                                                              MessageIfServLinesExist(FIELDCAPTION("Invoice Disc. Code"));
                                                            END;

                                                   CaptionML=ENU=Invoice Disc. Code }
    { 40  ;   ;Customer Disc. Group;Code20        ;TableRelation="Customer Discount Group";
                                                   OnValidate=BEGIN
                                                                MessageIfServLinesExist(FIELDCAPTION("Customer Disc. Group"));
                                                              END;

                                                   CaptionML=ENU=Customer Disc. Group }
    { 41  ;   ;Language Code       ;Code10        ;TableRelation=Language;
                                                   OnValidate=BEGIN
                                                                MessageIfServLinesExist(FIELDCAPTION("Language Code"));
                                                              END;

                                                   CaptionML=ENU=Language Code }
    { 43  ;   ;Salesperson Code    ;Code20        ;TableRelation="Salesperson/Purchaser";
                                                   OnValidate=BEGIN
                                                                CreateDim(
                                                                  DATABASE::"Salesperson/Purchaser","Salesperson Code",
                                                                  DATABASE::Customer,"Bill-to Customer No.",
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::"Service Order Type","Service Order Type",
                                                                  DATABASE::"Service Contract Header","Contract No.");
                                                              END;

                                                   CaptionML=ENU=Salesperson Code }
    { 46  ;   ;Comment             ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Comment Line" WHERE ("Table Name"=CONST("Service Header"),
                                                                                                   "Table Subtype"=FIELD("Document Type"),
                                                                                                   "No."=FIELD("No."),
                                                                                                   Type=CONST(General)));
                                                   CaptionML=ENU=Comment;
                                                   Editable=false }
    { 47  ;   ;No. Printed         ;Integer       ;CaptionML=ENU=No. Printed;
                                                   Editable=false }
    { 52  ;   ;Applies-to Doc. Type;Option        ;CaptionML=ENU=Applies-to Doc. Type;
                                                   OptionCaptionML=ENU=" ,Payment,Invoice,Credit Memo,Finance Charge Memo,Reminder,Refund";
                                                   OptionString=" ",Payment,Invoice,"Credit Memo","Finance Charge Memo",Reminder,Refund }
    { 53  ;   ;Applies-to Doc. No. ;Code20        ;OnValidate=VAR
                                                                CustLedgEntry@1000 : Record "Cust. Ledger Entry";
                                                              BEGIN
                                                                if "Applies-to Doc. No." <> '' then
                                                                  TESTFIELD("Bal. Account No.",'');

                                                                if ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") and (xRec."Applies-to Doc. No." <> '') and
                                                                   ("Applies-to Doc. No." <> '')
                                                                then begin
                                                                  CustLedgEntry.SetAmountToApply("Applies-to Doc. No.","Customer No.");
                                                                  CustLedgEntry.SetAmountToApply(xRec."Applies-to Doc. No.","Customer No.");
                                                                end else
                                                                  if ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") and (xRec."Applies-to Doc. No." = '') then
                                                                    CustLedgEntry.SetAmountToApply("Applies-to Doc. No.","Customer No.")
                                                                  else
                                                                    if ("Applies-to Doc. No." <> xRec."Applies-to Doc. No.") and ("Applies-to Doc. No." = '') then
                                                                      CustLedgEntry.SetAmountToApply(xRec."Applies-to Doc. No.","Customer No.");
                                                              END;

                                                   OnLookup=VAR
                                                              CustLedgEntry@1001 : Record "Cust. Ledger Entry";
                                                              GenJnlLine@1002 : Record "Gen. Journal Line";
                                                              GenJnlApply@1003 : Codeunit "Gen. Jnl.-Apply";
                                                              ApplyCustEntries@1000 : Page "Apply Customer Entries";
                                                            BEGIN
                                                              TESTFIELD("Bal. Account No.",'');
                                                              CustLedgEntry.SetApplyToFilters("Bill-to Customer No.","Applies-to Doc. Type","Applies-to Doc. No.",0);

                                                              ApplyCustEntries.SetService(Rec,CustLedgEntry,ServHeader.FIELDNO("Applies-to Doc. No."));
                                                              ApplyCustEntries.SETTABLEVIEW(CustLedgEntry);
                                                              ApplyCustEntries.SETRECORD(CustLedgEntry);
                                                              ApplyCustEntries.LOOKUPMODE(true);
                                                              if ApplyCustEntries.RUNMODAL = ACTION::LookupOK then begin
                                                                ApplyCustEntries.GetCustLedgEntry(CustLedgEntry);
                                                                GenJnlApply.CheckAgainstApplnCurrency(
                                                                  "Currency Code",CustLedgEntry."Currency Code",GenJnlLine."Account Type"::Customer,true);
                                                                "Applies-to Doc. Type" := CustLedgEntry."Document Type";
                                                                "Applies-to Doc. No." := CustLedgEntry."Document No.";
                                                              end;
                                                              CLEAR(ApplyCustEntries);
                                                            END;

                                                   CaptionML=ENU=Applies-to Doc. No. }
    { 55  ;   ;Bal. Account No.    ;Code20        ;TableRelation=IF ("Bal. Account Type"=CONST("G/L Account")) "G/L Account"
                                                                 ELSE IF ("Bal. Account Type"=CONST("Bank Account")) "Bank Account";
                                                   OnValidate=VAR
                                                                GLAcc@1000 : Record "G/L Account";
                                                                BankAcc@1001 : Record "Bank Account";
                                                              BEGIN
                                                                if "Bal. Account No." <> '' then
                                                                  case "Bal. Account Type" of
                                                                    "Bal. Account Type"::"G/L Account":
                                                                      begin
                                                                        GLAcc.GET("Bal. Account No.");
                                                                        GLAcc.CheckGLAcc;
                                                                        GLAcc.TESTFIELD("Direct Posting",true);
                                                                      end;
                                                                    "Bal. Account Type"::"Bank Account":
                                                                      begin
                                                                        BankAcc.GET("Bal. Account No.");
                                                                        BankAcc.TESTFIELD(Blocked,false);
                                                                        BankAcc.TESTFIELD("Currency Code","Currency Code");
                                                                      end;
                                                                  end;
                                                              END;

                                                   CaptionML=ENU=Bal. Account No. }
    { 62  ;   ;Shipping No.        ;Code20        ;CaptionML=ENU=Shipping No. }
    { 63  ;   ;Posting No.         ;Code20        ;CaptionML=ENU=Posting No. }
    { 64  ;   ;Last Shipping No.   ;Code20        ;TableRelation="Service Shipment Header";
                                                   CaptionML=ENU=Last Shipping No.;
                                                   Editable=false }
    { 65  ;   ;Last Posting No.    ;Code20        ;TableRelation="Service Invoice Header";
                                                   CaptionML=ENU=Last Posting No.;
                                                   Editable=false }
    { 70  ;   ;VAT Registration No.;Text20        ;CaptionML=ENU=VAT Registration No. }
    { 73  ;   ;Reason Code         ;Code10        ;TableRelation="Reason Code";
                                                   CaptionML=ENU=Reason Code }
    { 74  ;   ;Gen. Bus. Posting Group;Code20     ;TableRelation="Gen. Business Posting Group";
                                                   OnValidate=VAR
                                                                GenBusPostingGroup@1000 : Record "Gen. Business Posting Group";
                                                              BEGIN
                                                                if "Gen. Bus. Posting Group" <> xRec."Gen. Bus. Posting Group" then begin
                                                                  if GenBusPostingGroup.ValidateVatBusPostingGroup(GenBusPostingGroup,"Gen. Bus. Posting Group") then
                                                                    "VAT Bus. Posting Group" := GenBusPostingGroup."Def. VAT Bus. Posting Group";
                                                                  RecreateServLines(FIELDCAPTION("Gen. Bus. Posting Group"));
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Gen. Bus. Posting Group }
    { 75  ;   ;EU 3-Party Trade    ;Boolean       ;CaptionML=ENU=EU 3-Party Trade }
    { 76  ;   ;Transaction Type    ;Code10        ;TableRelation="Transaction Type";
                                                   OnValidate=BEGIN
                                                                UpdateServLines(FIELDCAPTION("Transaction Type"),false);
                                                              END;

                                                   CaptionML=ENU=Transaction Type }
    { 77  ;   ;Transport Method    ;Code10        ;TableRelation="Transport Method";
                                                   OnValidate=BEGIN
                                                                UpdateServLines(FIELDCAPTION("Transport Method"),false);
                                                              END;

                                                   CaptionML=ENU=Transport Method }
    { 78  ;   ;VAT Country/Region Code;Code10     ;TableRelation="Country/Region";
                                                   CaptionML=ENU=VAT Country/Region Code }
    { 79  ;   ;Name                ;Text50        ;CaptionML=ENU=Name }
    { 80  ;   ;Name 2              ;Text50        ;CaptionML=ENU=Name 2 }
    { 81  ;   ;Address             ;Text50        ;OnValidate=BEGIN
                                                                UpdateShipToAddressFromGeneralAddress(FIELDNO("Ship-to Address"));
                                                              END;

                                                   CaptionML=ENU=Address }
    { 82  ;   ;Address 2           ;Text50        ;OnValidate=BEGIN
                                                                UpdateShipToAddressFromGeneralAddress(FIELDNO("Ship-to Address 2"));
                                                              END;

                                                   CaptionML=ENU=Address 2 }
    { 83  ;   ;City                ;Text30        ;TableRelation=IF ("Country/Region Code"=CONST('')) "Post Code".City
                                                                 ELSE IF ("Country/Region Code"=FILTER(<>'')) "Post Code".City WHERE ("Country/Region Code"=FIELD("Country/Region Code"));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidateCity(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) and GUIALLOWED);
                                                                UpdateShipToAddressFromGeneralAddress(FIELDNO("Ship-to City"));
                                                              END;

                                                   ValidateTableRelation=false;
                                                   TestTableRelation=false;
                                                   CaptionML=ENU=City }
    { 84  ;   ;Contact Name        ;Text50        ;CaptionML=ENU=Contact Name }
    { 85  ;   ;Bill-to Post Code   ;Code20        ;TableRelation=IF ("Bill-to Country/Region Code"=CONST('')) "Post Code"
                                                                 ELSE IF ("Bill-to Country/Region Code"=FILTER(<>'')) "Post Code" WHERE ("Country/Region Code"=FIELD("Bill-to Country/Region Code"));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(
                                                                  "Bill-to City","Bill-to Post Code","Bill-to County","Bill-to Country/Region Code",(CurrFieldNo <> 0) and GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=false;
                                                   TestTableRelation=false;
                                                   CaptionML=ENU=Bill-to Post Code }
    { 86  ;   ;Bill-to County      ;Text30        ;CaptionML=ENU=Bill-to County }
    { 87  ;   ;Bill-to Country/Region Code;Code10 ;TableRelation="Country/Region";
                                                   CaptionML=ENU=Bill-to Country/Region Code }
    { 88  ;   ;Post Code           ;Code20        ;TableRelation=IF ("Country/Region Code"=CONST('')) "Post Code"
                                                                 ELSE IF ("Country/Region Code"=FILTER(<>'')) "Post Code" WHERE ("Country/Region Code"=FIELD("Country/Region Code"));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(City,"Post Code",County,"Country/Region Code",(CurrFieldNo <> 0) and GUIALLOWED);
                                                                UpdateShipToAddressFromGeneralAddress(FIELDNO("Ship-to Post Code"));
                                                              END;

                                                   ValidateTableRelation=false;
                                                   TestTableRelation=false;
                                                   CaptionML=ENU=Post Code }
    { 89  ;   ;County              ;Text30        ;OnValidate=BEGIN
                                                                UpdateShipToAddressFromGeneralAddress(FIELDNO("Ship-to County"));
                                                              END;

                                                   CaptionML=ENU=County }
    { 90  ;   ;Country/Region Code ;Code10        ;TableRelation="Country/Region";
                                                   OnValidate=BEGIN
                                                                UpdateShipToAddressFromGeneralAddress(FIELDNO("Ship-to Country/Region Code"));

                                                                VALIDATE("Ship-to Country/Region Code");
                                                              END;

                                                   CaptionML=ENU=Country/Region Code }
    { 91  ;   ;Ship-to Post Code   ;Code20        ;TableRelation=IF ("Ship-to Country/Region Code"=CONST('')) "Post Code"
                                                                 ELSE IF ("Ship-to Country/Region Code"=FILTER(<>'')) "Post Code" WHERE ("Country/Region Code"=FIELD("Ship-to Country/Region Code"));
                                                   OnValidate=BEGIN
                                                                PostCode.ValidatePostCode(
                                                                  "Ship-to City","Ship-to Post Code","Ship-to County","Ship-to Country/Region Code",(CurrFieldNo <> 0) and GUIALLOWED);
                                                              END;

                                                   ValidateTableRelation=false;
                                                   TestTableRelation=false;
                                                   CaptionML=ENU=Ship-to Post Code }
    { 92  ;   ;Ship-to County      ;Text30        ;CaptionML=ENU=Ship-to County }
    { 93  ;   ;Ship-to Country/Region Code;Code10 ;TableRelation="Country/Region";
                                                   OnValidate=BEGIN
                                                                if "Ship-to Country/Region Code" <> '' then
                                                                  "VAT Country/Region Code" := "Ship-to Country/Region Code"
                                                                else
                                                                  "VAT Country/Region Code" := "Country/Region Code";
                                                              END;

                                                   CaptionML=ENU=Ship-to Country/Region Code }
    { 94  ;   ;Bal. Account Type   ;Option        ;CaptionML=ENU=Bal. Account Type;
                                                   OptionCaptionML=ENU=G/L Account,Bank Account;
                                                   OptionString="G/L Account","Bank Account" }
    { 97  ;   ;Exit Point          ;Code10        ;TableRelation="Entry/Exit Point";
                                                   OnValidate=BEGIN
                                                                UpdateServLines(FIELDCAPTION("Exit Point"),false);
                                                              END;

                                                   CaptionML=ENU=Exit Point }
    { 98  ;   ;Correction          ;Boolean       ;CaptionML=ENU=Correction }
    { 99  ;   ;Document Date       ;Date          ;OnValidate=BEGIN
                                                                VALIDATE("Payment Terms Code");
                                                              END;

                                                   CaptionML=ENU=Document Date }
    { 101 ;   ;Area                ;Code10        ;TableRelation=Area;
                                                   OnValidate=BEGIN
                                                                UpdateServLines(FIELDCAPTION(Area),false);
                                                              END;

                                                   CaptionML=ENU=Area }
    { 102 ;   ;Transaction Specification;Code10   ;TableRelation="Transaction Specification";
                                                   OnValidate=BEGIN
                                                                UpdateServLines(FIELDCAPTION("Transaction Specification"),false);
                                                              END;

                                                   CaptionML=ENU=Transaction Specification }
    { 104 ;   ;Payment Method Code ;Code10        ;TableRelation="Payment Method";
                                                   OnValidate=VAR
                                                                PaymentMethod@1000 : Record "Payment Method";
                                                              BEGIN
                                                                if PaymentMethod.GET("Payment Method Code") then begin
                                                                  "Bal. Account Type" := PaymentMethod."Bal. Account Type";
                                                                  "Bal. Account No." := PaymentMethod."Bal. Account No.";
                                                                end;
                                                                if "Bal. Account No." <> '' then begin
                                                                  TESTFIELD("Applies-to Doc. No.",'');
                                                                  TESTFIELD("Applies-to ID",'');
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Payment Method Code }
    { 105 ;   ;Shipping Agent Code ;Code10        ;TableRelation="Shipping Agent";
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Release Status","Release Status"::Open);
                                                                if xRec."Shipping Agent Code" = "Shipping Agent Code" then
                                                                  exit;

                                                                "Shipping Agent Service Code" := '';
                                                                GetShippingTime(FIELDNO("Shipping Agent Code"));
                                                                UpdateServLines(FIELDCAPTION("Shipping Agent Code"),CurrFieldNo <> 0);
                                                              END;

                                                   AccessByPermission=TableData "Shipping Agent Services"=R;
                                                   CaptionML=ENU=Shipping Agent Code }
    { 107 ;   ;No. Series          ;Code20        ;TableRelation="No. Series";
                                                   CaptionML=ENU=No. Series;
                                                   Editable=false }
    { 108 ;   ;Posting No. Series  ;Code20        ;TableRelation="No. Series";
                                                   OnValidate=BEGIN
                                                                if "Posting No. Series" <> '' then begin
                                                                  ServSetup.GET;
                                                                  TestNoSeries;
                                                                  NoSeriesMgt.TestSeries(GetPostingNoSeriesCode,"Posting No. Series");
                                                                end;
                                                                TESTFIELD("Posting No.",'');
                                                              END;

                                                   OnLookup=BEGIN
                                                              with ServHeader do begin
                                                                ServHeader := Rec;
                                                                ServSetup.GET;
                                                                TestNoSeries;
                                                                if NoSeriesMgt.LookupSeries(GetPostingNoSeriesCode,"Posting No. Series") then
                                                                  VALIDATE("Posting No. Series");
                                                                Rec := ServHeader;
                                                              end;
                                                            END;

                                                   CaptionML=ENU=Posting No. Series }
    { 109 ;   ;Shipping No. Series ;Code20        ;TableRelation="No. Series";
                                                   OnValidate=BEGIN
                                                                if "Shipping No. Series" <> '' then begin
                                                                  ServSetup.GET;
                                                                  ServSetup.TESTFIELD("Posted Service Shipment Nos.");
                                                                  NoSeriesMgt.TestSeries(ServSetup."Posted Service Shipment Nos.","Shipping No. Series");
                                                                end;
                                                                TESTFIELD("Shipping No.",'');
                                                              END;

                                                   CaptionML=ENU=Shipping No. Series }
    { 114 ;   ;Tax Area Code       ;Code20        ;TableRelation="Tax Area";
                                                   OnValidate=BEGIN
                                                                MessageIfServLinesExist(FIELDCAPTION("Tax Area Code"));
                                                              END;

                                                   CaptionML=ENU=Tax Area Code }
    { 115 ;   ;Tax Liable          ;Boolean       ;OnValidate=BEGIN
                                                                MessageIfServLinesExist(FIELDCAPTION("Tax Liable"));
                                                              END;

                                                   CaptionML=ENU=Tax Liable }
    { 116 ;   ;VAT Bus. Posting Group;Code20      ;TableRelation="VAT Business Posting Group";
                                                   OnValidate=BEGIN
                                                                if "VAT Bus. Posting Group" <> xRec."VAT Bus. Posting Group" then
                                                                  RecreateServLines(FIELDCAPTION("VAT Bus. Posting Group"));
                                                              END;

                                                   CaptionML=ENU=VAT Bus. Posting Group }
    { 117 ;   ;Reserve             ;Option        ;CaptionML=ENU=Reserve;
                                                   OptionCaptionML=ENU=Never,Optional,Always;
                                                   OptionString=Never,Optional,Always }
    { 118 ;   ;Applies-to ID       ;Code50        ;OnValidate=VAR
                                                                CustLedgEntry@1002 : Record "Cust. Ledger Entry";
                                                                TempCustLedgEntry@1000 : TEMPORARY Record "Cust. Ledger Entry";
                                                                CustEntrySetApplID@1001 : Codeunit "Cust. Entry-SetAppl.ID";
                                                              BEGIN
                                                                if "Applies-to ID" <> '' then
                                                                  TESTFIELD("Bal. Account No.",'');
                                                                if ("Applies-to ID" <> xRec."Applies-to ID") and (xRec."Applies-to ID" <> '') then begin
                                                                  CustLedgEntry.SETCURRENTKEY("Customer No.",Open);
                                                                  CustLedgEntry.SETRANGE("Customer No.","Bill-to Customer No.");
                                                                  CustLedgEntry.SETRANGE(Open,true);
                                                                  CustLedgEntry.SETRANGE("Applies-to ID",xRec."Applies-to ID");
                                                                  if CustLedgEntry.FINDFIRST then
                                                                    CustEntrySetApplID.SetApplId(CustLedgEntry,TempCustLedgEntry,'');
                                                                  CustLedgEntry.RESET;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Applies-to ID }
    { 119 ;   ;VAT Base Discount % ;Decimal       ;OnValidate=BEGIN
                                                                GLSetup.GET;
                                                                if "VAT Base Discount %" > GLSetup."VAT Tolerance %" then
                                                                  ERROR(
                                                                    Text011,
                                                                    FIELDCAPTION("VAT Base Discount %"),
                                                                    GLSetup.FIELDCAPTION("VAT Tolerance %"),
                                                                    GLSetup.TABLECAPTION);

                                                                if ("VAT Base Discount %" = xRec."VAT Base Discount %") and
                                                                   (CurrFieldNo <> 0)
                                                                then
                                                                  exit;

                                                                ServLine.RESET;
                                                                ServLine.SETRANGE("Document Type","Document Type");
                                                                ServLine.SETRANGE("Document No.","No.");
                                                                ServLine.SETFILTER(Type,'<>%1',ServLine.Type::" ");
                                                                ServLine.SETFILTER(Quantity,'<>0');
                                                                ServLine.LOCKTABLE;
                                                                LOCKTABLE;
                                                                if ServLine.FINDSET then begin
                                                                  MODIFY;
                                                                  repeat
                                                                    if (ServLine."Quantity Invoiced" <> ServLine.Quantity) or
                                                                       ("Shipping Advice" <> "Shipping Advice"::Partial) or
                                                                       (CurrFieldNo <> 0)
                                                                    then begin
                                                                      ServLine.UpdateAmounts;
                                                                      ServLine.MODIFY;
                                                                    end;
                                                                  until ServLine.NEXT = 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=VAT Base Discount %;
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   MaxValue=100 }
    { 120 ;   ;Status              ;Option        ;OnValidate=VAR
                                                                JobQueueEntry@1000 : Record "Job Queue Entry";
                                                                RepairStatus@1001 : Record "Repair Status";
                                                              BEGIN
                                                                ServItemLine.RESET;
                                                                ServItemLine.SETRANGE("Document Type","Document Type");
                                                                ServItemLine.SETRANGE("Document No.","No.");
                                                                LinesExist := true;
                                                                if ServItemLine.FIND('-') then
                                                                  repeat
                                                                    if ServItemLine."Repair Status Code" <> '' then begin
                                                                      RepairStatus.GET(ServItemLine."Repair Status Code");
                                                                      if ((Status = Status::Pending) and not RepairStatus."Pending Status Allowed") or
                                                                         ((Status = Status::"In Process") and not RepairStatus."In Process Status Allowed") or
                                                                         ((Status = Status::Finished) and not RepairStatus."Finished Status Allowed") or
                                                                         ((Status = Status::"On Hold") and not RepairStatus."On Hold Status Allowed")
                                                                      then
                                                                        ERROR(
                                                                          Text031,
                                                                          FIELDCAPTION(Status),FORMAT(Status),TABLECAPTION,"No.",ServItemLine.FIELDCAPTION("Repair Status Code"),
                                                                          ServItemLine."Repair Status Code",ServItemLine.TABLECAPTION,ServItemLine."Line No.")
                                                                    end;
                                                                  until ServItemLine.NEXT = 0
                                                                else
                                                                  LinesExist := false;

                                                                case Status of
                                                                  Status::"In Process":
                                                                    begin
                                                                      if not LinesExist then begin
                                                                        "Starting Date" := WORKDATE;
                                                                        VALIDATE("Starting Time",TIME);
                                                                      end else
                                                                        UpdateStartingDateTime;
                                                                    end;
                                                                  Status::Finished:
                                                                    begin
                                                                      TestMandatoryFields(ServLine);
                                                                      if Status <> xRec.Status then
                                                                        if "Notify Customer" = "Notify Customer"::"By Email" then begin
                                                                          TESTFIELD("Customer No.");
                                                                          CLEAR(NotifyCust);
                                                                          NotifyCust.RUN(Rec);
                                                                        end;
                                                                      if not LinesExist then begin
                                                                        if ("Finishing Date" = 0D) and ("Finishing Time" = 000000T) then begin
                                                                          "Finishing Date" := WORKDATE;
                                                                          "Finishing Time" := TIME;
                                                                        end;
                                                                      end else
                                                                        UpdateFinishingDateTime;
                                                                    end;
                                                                end;

                                                                if Status <> Status::Finished then begin
                                                                  "Finishing Date" := 0D;
                                                                  "Finishing Time" := 000000T;
                                                                  "Service Time (Hours)" := 0;
                                                                end;

                                                                if ("Starting Date" <> 0D) and
                                                                   ("Finishing Date" <> 0D) and
                                                                   not LinesExist
                                                                then begin
                                                                  CALCFIELDS("Contract Serv. Hours Exist");
                                                                  "Service Time (Hours)" :=
                                                                    ServOrderMgt.CalcServTime(
                                                                      "Starting Date","Starting Time","Finishing Date","Finishing Time",
                                                                      "Contract No.","Contract Serv. Hours Exist");
                                                                end;

                                                                if Status = Status::Pending then
                                                                  if ServSetup.GET then
                                                                    if ServSetup."First Warning Within (Hours)" <> 0 then
                                                                      if JobQueueEntry.WRITEPERMISSION then begin
                                                                        JobQueueEntry.SETRANGE("Object Type to Run",JobQueueEntry."Object Type to Run"::Codeunit);
                                                                        JobQueueEntry.SETRANGE("Object ID to Run",CODEUNIT::"ServOrder-Check Response Time");
                                                                        JobQueueEntry.SETRANGE(Status,JobQueueEntry.Status::"On Hold");
                                                                        if JobQueueEntry.FINDFIRST then
                                                                          JobQueueEntry.SetStatus(JobQueueEntry.Status::Ready);
                                                                      end;
                                                              END;

                                                   CaptionML=ENU=Status;
                                                   OptionCaptionML=ENU=Pending,In Process,Finished,On Hold;
                                                   OptionString=Pending,"In Process",Finished,"On Hold" }
    { 121 ;   ;Invoice Discount Calculation;Option;CaptionML=ENU=Invoice Discount Calculation;
                                                   OptionCaptionML=ENU=None,%,Amount;
                                                   OptionString=None,"%",Amount;
                                                   Editable=false }
    { 122 ;   ;Invoice Discount Value;Decimal     ;CaptionML=ENU=Invoice Discount Value;
                                                   Editable=false;
                                                   AutoFormatType=1 }
    { 130 ;   ;Release Status      ;Option        ;CaptionML=ENU=Release Status;
                                                   OptionCaptionML=ENU=Open,Released to Ship;
                                                   OptionString=Open,"Released to Ship";
                                                   Editable=false }
    { 480 ;   ;Dimension Set ID    ;Integer       ;TableRelation="Dimension Set Entry";
                                                   OnValidate=BEGIN
                                                                DimMgt.UpdateGlobalDimFromDimSetID("Dimension Set ID","Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
                                                              END;

                                                   OnLookup=BEGIN
                                                              ShowDocDim;
                                                            END;

                                                   CaptionML=ENU=Dimension Set ID;
                                                   Editable=false }
    { 5052;   ;Contact No.         ;Code20        ;TableRelation=Contact;
                                                   OnValidate=VAR
                                                                Cont@1000 : Record Contact;
                                                                ContBusinessRelation@1001 : Record "Contact Business Relation";
                                                              BEGIN
                                                                if ("Contact No." <> xRec."Contact No.") and
                                                                   (xRec."Contact No." <> '')
                                                                then begin
                                                                  if HideValidationDialog then
                                                                    Confirmed := true
                                                                  else
                                                                    Confirmed := CONFIRM(Text005,false,FIELDCAPTION("Contact No."));
                                                                  if Confirmed then begin
                                                                    ServLine.RESET;
                                                                    ServLine.SETRANGE("Document Type","Document Type");
                                                                    ServLine.SETRANGE("Document No.","No.");
                                                                    if ("Contact No." = '') and ("Customer No." = '') then begin
                                                                      if not ServLine.ISEMPTY then
                                                                        ERROR(Text050,FIELDCAPTION("Contact No."));
                                                                      InitRecordFromContact;
                                                                      exit;
                                                                    end;
                                                                  end else begin
                                                                    Rec := xRec;
                                                                    exit;
                                                                  end;
                                                                end;

                                                                if ("Customer No." <> '') and ("Contact No." <> '') then begin
                                                                  Cont.GET("Contact No.");
                                                                  if ContBusinessRelation.FindByRelation(ContBusinessRelation."Link to Table"::Customer,"Customer No.") and
                                                                     (ContBusinessRelation."Contact No." <> Cont."Company No.")
                                                                  then
                                                                    ERROR(Text038,Cont."No.",Cont.Name,"Customer No.");
                                                                end;

                                                                UpdateCust("Contact No.");
                                                              END;

                                                   OnLookup=VAR
                                                              Cont@1000 : Record Contact;
                                                              ContBusinessRelation@1001 : Record "Contact Business Relation";
                                                            BEGIN
                                                              if "Customer No." <> '' then
                                                                if Cont.GET("Contact No.") then
                                                                  Cont.SETRANGE("Company No.",Cont."Company No.")
                                                                else
                                                                  if ContBusinessRelation.FindByRelation(ContBusinessRelation."Link to Table"::Customer,"Customer No.") then
                                                                    Cont.SETRANGE("Company No.",ContBusinessRelation."Contact No.")
                                                                  else
                                                                    Cont.SETRANGE("No.",'');

                                                              if "Contact No." <> '' then
                                                                if Cont.GET("Contact No.") then ;
                                                              if PAGE.RUNMODAL(0,Cont) = ACTION::LookupOK then begin
                                                                xRec := Rec;
                                                                VALIDATE("Contact No.",Cont."No.");
                                                              end;
                                                            END;

                                                   CaptionML=ENU=Contact No. }
    { 5053;   ;Bill-to Contact No. ;Code20        ;TableRelation=Contact;
                                                   OnValidate=VAR
                                                                Cont@1001 : Record Contact;
                                                                ContBusinessRelation@1000 : Record "Contact Business Relation";
                                                              BEGIN
                                                                if ("Bill-to Contact No." <> xRec."Bill-to Contact No.") and
                                                                   (xRec."Bill-to Contact No." <> '')
                                                                then begin
                                                                  if HideValidationDialog then
                                                                    Confirmed := true
                                                                  else
                                                                    Confirmed := CONFIRM(Text005,false,FIELDCAPTION("Bill-to Contact No."));
                                                                  if Confirmed then begin
                                                                    ServLine.RESET;
                                                                    ServLine.SETRANGE("Document Type","Document Type");
                                                                    ServLine.SETRANGE("Document No.","No.");
                                                                    if ("Bill-to Contact No." = '') and ("Bill-to Customer No." = '') then begin
                                                                      if not ServLine.ISEMPTY then
                                                                        ERROR(Text050,FIELDCAPTION("Bill-to Contact No."));
                                                                      InitRecordFromContact;
                                                                      exit;
                                                                    end;
                                                                  end else begin
                                                                    "Bill-to Contact No." := xRec."Bill-to Contact No.";
                                                                    exit;
                                                                  end;
                                                                end;

                                                                if ("Bill-to Customer No." <> '') and ("Bill-to Contact No." <> '') then begin
                                                                  Cont.GET("Bill-to Contact No.");
                                                                  if ContBusinessRelation.FindByRelation(ContBusinessRelation."Link to Table"::Customer,"Bill-to Customer No.") and
                                                                     (ContBusinessRelation."Contact No." <> Cont."Company No.")
                                                                  then
                                                                    ERROR(Text038,Cont."No.",Cont.Name,"Bill-to Customer No.");
                                                                end;

                                                                UpdateBillToCust("Bill-to Contact No.");
                                                              END;

                                                   OnLookup=VAR
                                                              Cont@1001 : Record Contact;
                                                              ContBusinessRelation@1000 : Record "Contact Business Relation";
                                                            BEGIN
                                                              if "Bill-to Customer No." <> '' then
                                                                if Cont.GET("Bill-to Contact No.") then
                                                                  Cont.SETRANGE("Company No.",Cont."Company No.")
                                                                else
                                                                  if ContBusinessRelation.FindByRelation(ContBusinessRelation."Link to Table"::Customer,"Bill-to Customer No.") then
                                                                    Cont.SETRANGE("Company No.",ContBusinessRelation."Contact No.")
                                                                  else
                                                                    Cont.SETRANGE("No.",'');

                                                              if "Bill-to Contact No." <> '' then
                                                                if Cont.GET("Bill-to Contact No.") then ;
                                                              if PAGE.RUNMODAL(0,Cont) = ACTION::LookupOK then begin
                                                                xRec := Rec;
                                                                VALIDATE("Bill-to Contact No.",Cont."No.");
                                                              end;
                                                            END;

                                                   CaptionML=ENU=Bill-to Contact No. }
    { 5700;   ;Responsibility Center;Code10       ;TableRelation="Responsibility Center";
                                                   OnValidate=VAR
                                                                RespCenter@1000 : Record "Responsibility Center";
                                                              BEGIN
                                                                if not UserSetupMgt.CheckRespCenter(2,"Responsibility Center") then
                                                                  ERROR(
                                                                    Text010,
                                                                    RespCenter.TABLECAPTION,UserSetupMgt.GetServiceFilter);

                                                                UpdateShipToAddress;

                                                                CreateDim(
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::Customer,"Bill-to Customer No.",
                                                                  DATABASE::"Salesperson/Purchaser","Salesperson Code",
                                                                  DATABASE::"Service Order Type","Service Order Type",
                                                                  DATABASE::"Service Contract Header","Contract No.");

                                                                ServItemLine.RESET;
                                                                ServItemLine.SETRANGE("Document Type","Document Type");
                                                                ServItemLine.SETRANGE("Document No.","No.");
                                                                if ServItemLine.FIND('-') then
                                                                  repeat
                                                                    ServItemLine.VALIDATE("Responsibility Center","Responsibility Center");
                                                                    ServItemLine.MODIFY(true);
                                                                  until ServItemLine.NEXT = 0;

                                                                if xRec."Responsibility Center" <> "Responsibility Center" then begin
                                                                  RecreateServLines(FIELDCAPTION("Responsibility Center"));
                                                                  VALIDATE("Location Code",UserSetupMgt.GetLocation(2,'',"Responsibility Center"));
                                                                  "Assigned User ID" := '';
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Responsibility Center }
    { 5750;   ;Shipping Advice     ;Option        ;OnValidate=VAR
                                                                WhseValidateSourceHeader@1000 : Codeunit "Whse. Validate Source Header";
                                                              BEGIN
                                                                TESTFIELD("Release Status","Release Status"::Open);
                                                                if InventoryPickConflict("Document Type","No.","Shipping Advice") then
                                                                  ERROR(Text064,FIELDCAPTION("Shipping Advice"),FORMAT("Shipping Advice"),TABLECAPTION);
                                                                if WhseShpmntConflict("Document Type","No.","Shipping Advice") then
                                                                  ERROR(STRSUBSTNO(Text065,FIELDCAPTION("Shipping Advice"),FORMAT("Shipping Advice"),TABLECAPTION));
                                                                WhseValidateSourceHeader.ServiceHeaderVerifyChange(Rec,xRec);
                                                              END;

                                                   CaptionML=ENU=Shipping Advice;
                                                   OptionCaptionML=ENU=Partial,Complete;
                                                   OptionString=Partial,Complete }
    { 5752;   ;Completely Shipped  ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Min("Service Line"."Completely Shipped" WHERE ("Document Type"=FIELD("Document Type"),
                                                                                                              "Document No."=FIELD("No."),
                                                                                                              Type=FILTER(<>" "),
                                                                                                              "Location Code"=FIELD("Location Filter")));
                                                   CaptionML=ENU=Completely Shipped;
                                                   Editable=false }
    { 5754;   ;Location Filter     ;Code10        ;FieldClass=FlowFilter;
                                                   TableRelation=Location.Code;
                                                   CaptionML=ENU=Location Filter }
    { 5792;   ;Shipping Time       ;DateFormula   ;OnValidate=BEGIN
                                                                TESTFIELD("Release Status","Release Status"::Open);
                                                                if "Shipping Time" <> xRec."Shipping Time" then
                                                                  UpdateServLines(FIELDCAPTION("Shipping Time"),CurrFieldNo <> 0);
                                                              END;

                                                   AccessByPermission=TableData "Shipping Agent Services"=R;
                                                   CaptionML=ENU=Shipping Time }
    { 5794;   ;Shipping Agent Service Code;Code10 ;TableRelation="Shipping Agent Services".Code WHERE ("Shipping Agent Code"=FIELD("Shipping Agent Code"));
                                                   OnValidate=BEGIN
                                                                TESTFIELD("Release Status","Release Status"::Open);
                                                                GetShippingTime(FIELDNO("Shipping Agent Service Code"));
                                                                UpdateServLines(FIELDCAPTION("Shipping Agent Service Code"),CurrFieldNo <> 0);
                                                              END;

                                                   CaptionML=ENU=Shipping Agent Service Code }
    { 5796;   ;Date Filter         ;Date          ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Date Filter }
    { 5902;   ;Description         ;Text50        ;CaptionML=ENU=Description }
    { 5904;   ;Service Order Type  ;Code10        ;TableRelation="Service Order Type";
                                                   OnValidate=BEGIN
                                                                CreateDim(
                                                                  DATABASE::"Service Order Type","Service Order Type",
                                                                  DATABASE::Customer,"Bill-to Customer No.",
                                                                  DATABASE::"Salesperson/Purchaser","Salesperson Code",
                                                                  DATABASE::"Responsibility Center","Responsibility Center",
                                                                  DATABASE::"Service Contract Header","Contract No.");
                                                              END;

                                                   CaptionML=ENU=Service Order Type }
    { 5905;   ;Link Service to Service Item;Boolean;
                                                   OnValidate=BEGIN
                                                                if "Link Service to Service Item" <> xRec."Link Service to Service Item" then begin
                                                                  ServLine.RESET;
                                                                  ServLine.SETRANGE("Document Type","Document Type");
                                                                  ServLine.SETRANGE("Document No.","No.");
                                                                  ServLine.SETFILTER(Type,'<>%1',ServLine.Type::Cost);
                                                                  if ServLine.FIND('-') then
                                                                    MESSAGE(
                                                                      Text001,
                                                                      FIELDCAPTION("Link Service to Service Item"),
                                                                      "No.");
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Link Service to Service Item }
    { 5907;   ;Priority            ;Option        ;CaptionML=ENU=Priority;
                                                   OptionCaptionML=ENU=Low,Medium,High;
                                                   OptionString=Low,Medium,High;
                                                   Editable=false }
    { 5911;   ;Allocated Hours     ;Decimal       ;FieldClass=FlowField;
                                                   CalcFormula=Sum("Service Order Allocation"."Allocated Hours" WHERE ("Document Type"=FIELD("Document Type"),
                                                                                                                       "Document No."=FIELD("No."),
                                                                                                                       "Allocation Date"=FIELD("Date Filter"),
                                                                                                                       "Resource No."=FIELD("Resource Filter"),
                                                                                                                       Status=FILTER(Active|Finished),
                                                                                                                       "Resource Group No."=FIELD("Resource Group Filter")));
                                                   CaptionML=ENU=Allocated Hours;
                                                   DecimalPlaces=0:5;
                                                   Editable=false }
    { 5915;   ;Phone No.           ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=ENU=Phone No. }
    { 5916;   ;E-Mail              ;Text80        ;OnValidate=VAR
                                                                MailManagement@1000 : Codeunit "Mail Management";
                                                              BEGIN
                                                                MailManagement.ValidateEmailAddressField("E-Mail");
                                                              END;

                                                   ExtendedDatatype=E-Mail;
                                                   CaptionML=ENU=Email }
    { 5917;   ;Phone No. 2         ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=ENU=Phone No. 2 }
    { 5918;   ;Fax No.             ;Text30        ;CaptionML=ENU=Fax No. }
    { 5921;   ;No. of Unallocated Items;Integer   ;FieldClass=FlowField;
                                                   CalcFormula=Count("Service Item Line" WHERE ("Document Type"=FIELD("Document Type"),
                                                                                                "Document No."=FIELD("No."),
                                                                                                "No. of Active/Finished Allocs"=CONST(0)));
                                                   CaptionML=ENU=No. of Unallocated Items;
                                                   Editable=false }
    { 5923;   ;Order Time          ;Time          ;OnValidate=BEGIN
                                                                if "Order Time" <> xRec."Order Time" then begin
                                                                  if ("Order Time" > "Starting Time") and
                                                                     ("Starting Time" <> 000000T) and
                                                                     ("Order Date" = "Starting Date")
                                                                  then
                                                                    ERROR(Text007,FIELDCAPTION("Order Time"),FIELDCAPTION("Starting Time"));
                                                                  if "Starting Time" <> 000000T then
                                                                    VALIDATE("Starting Time");
                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","No.");
                                                                  if ServItemLine.FIND('-') then
                                                                    repeat
                                                                      ServItemLine.CalculateResponseDateTime("Order Date","Order Time");
                                                                      ServItemLine.MODIFY;
                                                                    until ServItemLine.NEXT = 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Order Time;
                                                   NotBlank=true }
    { 5924;   ;Default Response Time (Hours);Decimal;
                                                   CaptionML=ENU=Default Response Time (Hours);
                                                   DecimalPlaces=0:5;
                                                   MinValue=0 }
    { 5925;   ;Actual Response Time (Hours);Decimal;
                                                   CaptionML=ENU=Actual Response Time (Hours);
                                                   DecimalPlaces=0:5;
                                                   MinValue=0;
                                                   Editable=false }
    { 5926;   ;Service Time (Hours);Decimal       ;CaptionML=ENU=Service Time (Hours);
                                                   DecimalPlaces=0:5;
                                                   Editable=false }
    { 5927;   ;Response Date       ;Date          ;CaptionML=ENU=Response Date;
                                                   Editable=false }
    { 5928;   ;Response Time       ;Time          ;CaptionML=ENU=Response Time;
                                                   Editable=false }
    { 5929;   ;Starting Date       ;Date          ;OnValidate=BEGIN
                                                                if "Starting Date" <> 0D then begin
                                                                  if "Starting Date" < "Order Date" then
                                                                    ERROR(Text026,FIELDCAPTION("Starting Date"),FIELDCAPTION("Order Date"));

                                                                  if ("Starting Date" > "Finishing Date") and
                                                                     ("Finishing Date" <> 0D)
                                                                  then
                                                                    ERROR(Text007,FIELDCAPTION("Starting Date"),FIELDCAPTION("Finishing Time"));

                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETCURRENTKEY("Document Type","Document No.","Starting Date");
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","No.");
                                                                  ServItemLine.SETFILTER("Starting Date",'<>%1',0D);
                                                                  if ServItemLine.FIND('-') then
                                                                    repeat
                                                                      if ServItemLine."Starting Date" < "Starting Date" then
                                                                        ERROR(Text024,FIELDCAPTION("Starting Date"));
                                                                    until ServItemLine.NEXT = 0;

                                                                  if TIME < "Order Time" then
                                                                    VALIDATE("Starting Time","Order Time")
                                                                  else
                                                                    VALIDATE("Starting Time",TIME);
                                                                end else begin
                                                                  "Starting Time" := 000000T;
                                                                  "Actual Response Time (Hours)" := 0;
                                                                  "Finishing Date" := 0D;
                                                                  "Finishing Time" := 000000T;
                                                                  "Service Time (Hours)" := 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Starting Date }
    { 5930;   ;Starting Time       ;Time          ;OnValidate=BEGIN
                                                                TESTFIELD("Starting Date");

                                                                if ("Starting Date" = "Finishing Date") and
                                                                   ("Starting Time" > "Finishing Time")
                                                                then
                                                                  ERROR(Text007,FIELDCAPTION("Starting Time"),FIELDCAPTION("Finishing Time"));

                                                                if ("Starting Date" = "Order Date") and
                                                                   ("Starting Time" < "Order Time")
                                                                then
                                                                  ERROR(Text026,FIELDCAPTION("Starting Time"),FIELDCAPTION("Order Time"));

                                                                if ("Starting Time" = 000000T) and (xRec."Starting Time" <> 000000T) then begin
                                                                  "Finishing Time" := 000000T;
                                                                  "Finishing Date" := 0D;
                                                                  "Service Time (Hours)" := 0;
                                                                end;

                                                                if ("Starting Time" <> 000000T) and
                                                                   ("Starting Date" <> 0D)
                                                                then begin
                                                                  CALCFIELDS("Contract Serv. Hours Exist");
                                                                  "Actual Response Time (Hours)" :=
                                                                    ServOrderMgt.CalcServTime(
                                                                      "Order Date","Order Time","Starting Date","Starting Time",
                                                                      "Contract No.","Contract Serv. Hours Exist");
                                                                end else
                                                                  "Actual Response Time (Hours)" := 0;
                                                                if "Finishing Time" <> 000000T then
                                                                  VALIDATE("Finishing Time");
                                                              END;

                                                   CaptionML=ENU=Starting Time }
    { 5931;   ;Finishing Date      ;Date          ;OnValidate=BEGIN
                                                                if "Finishing Date" <> 0D then begin
                                                                  if "Finishing Date" < "Starting Date" then
                                                                    ERROR(Text026,FIELDCAPTION("Finishing Date"),FIELDCAPTION("Starting Date"));

                                                                  if "Finishing Date" < "Order Date" then
                                                                    ERROR(
                                                                      Text026,
                                                                      FIELDCAPTION("Finishing Date"),
                                                                      FIELDCAPTION("Order Date"));

                                                                  if "Starting Date" = 0D then begin
                                                                    "Starting Date" := "Finishing Date";
                                                                    "Starting Time" := TIME;
                                                                    CALCFIELDS("Contract Serv. Hours Exist");
                                                                    "Actual Response Time (Hours)" :=
                                                                      ServOrderMgt.CalcServTime(
                                                                        "Order Date","Order Time","Starting Date","Starting Time",
                                                                        "Contract No.","Contract Serv. Hours Exist");
                                                                  end;

                                                                  if "Finishing Date" <> xRec."Finishing Date" then begin
                                                                    if TIME < "Starting Time" then
                                                                      "Finishing Time" := "Starting Time"
                                                                    else
                                                                      "Finishing Time" := TIME;
                                                                    VALIDATE("Finishing Time");
                                                                  end;

                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETCURRENTKEY("Document Type","Document No.","Finishing Date");
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","No.");
                                                                  ServItemLine.SETFILTER("Finishing Date",'<>%1',0D);
                                                                  if ServItemLine.FIND('-') then
                                                                    repeat
                                                                      if ServItemLine."Finishing Date" > "Finishing Date" then
                                                                        ERROR(Text025,FIELDCAPTION("Finishing Date"));
                                                                    until ServItemLine.NEXT = 0;
                                                                end else begin
                                                                  "Finishing Time" := 000000T;
                                                                  "Service Time (Hours)" := 0;
                                                                end;
                                                              END;

                                                   CaptionML=ENU=Finishing Date }
    { 5932;   ;Finishing Time      ;Time          ;OnValidate=BEGIN
                                                                TESTFIELD("Finishing Date");
                                                                if "Finishing Time" <> 000000T then begin
                                                                  if ("Starting Date" = "Finishing Date") and
                                                                     ("Finishing Time" < "Starting Time")
                                                                  then
                                                                    ERROR(
                                                                      Text026,FIELDCAPTION("Finishing Time"),
                                                                      FIELDCAPTION("Starting Time"));

                                                                  if ("Finishing Date" = "Order Date") and
                                                                     ("Finishing Time" < "Order Time")
                                                                  then
                                                                    ERROR(
                                                                      Text026,FIELDCAPTION("Finishing Time"),
                                                                      FIELDCAPTION("Order Time"));

                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETCURRENTKEY("Document Type","Document No.","Finishing Date");
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","No.");
                                                                  ServItemLine.SETFILTER("Finishing Date",'<>%1',0D);
                                                                  if ServItemLine.FIND('-') then
                                                                    repeat
                                                                      if (ServItemLine."Finishing Date" = "Finishing Date") and
                                                                         (ServItemLine."Finishing Time" > "Finishing Time")
                                                                      then
                                                                        ERROR(Text025,FIELDCAPTION("Finishing Time"));
                                                                    until ServItemLine.NEXT = 0;

                                                                  CALCFIELDS("Contract Serv. Hours Exist");
                                                                  "Service Time (Hours)" :=
                                                                    ServOrderMgt.CalcServTime(
                                                                      "Starting Date","Starting Time","Finishing Date","Finishing Time",
                                                                      "Contract No.","Contract Serv. Hours Exist");
                                                                end else
                                                                  "Service Time (Hours)" := 0;
                                                              END;

                                                   CaptionML=ENU=Finishing Time }
    { 5933;   ;Contract Serv. Hours Exist;Boolean ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Hour" WHERE ("Service Contract No."=FIELD("Contract No.")));
                                                   CaptionML=ENU=Contract Serv. Hours Exist;
                                                   Editable=false }
    { 5934;   ;Reallocation Needed ;Boolean       ;FieldClass=FlowField;
                                                   CalcFormula=Exist("Service Order Allocation" WHERE (Status=CONST("Reallocation Needed"),
                                                                                                       "Resource No."=FIELD("Resource Filter"),
                                                                                                       "Document Type"=FIELD("Document Type"),
                                                                                                       "Document No."=FIELD("No."),
                                                                                                       "Resource Group No."=FIELD("Resource Group Filter")));
                                                   CaptionML=ENU=Reallocation Needed;
                                                   Editable=false }
    { 5936;   ;Notify Customer     ;Option        ;CaptionML=ENU=Notify Customer;
                                                   OptionCaptionML=ENU=No,By Phone 1,By Phone 2,By Fax,By Email;
                                                   OptionString=No,"By Phone 1","By Phone 2","By Fax","By Email" }
    { 5937;   ;Max. Labor Unit Price;Decimal      ;OnValidate=BEGIN
                                                                if ServLineExists then
                                                                  MESSAGE(
                                                                    Text001,
                                                                    FIELDCAPTION("Max. Labor Unit Price"),
                                                                    "No.");
                                                              END;

                                                   CaptionML=ENU=Max. Labor Unit Price;
                                                   BlankZero=true;
                                                   AutoFormatType=2;
                                                   AutoFormatExpr="Currency Code" }
    { 5938;   ;Warning Status      ;Option        ;CaptionML=ENU=Warning Status;
                                                   OptionCaptionML=ENU=" ,First Warning,Second Warning,Third Warning";
                                                   OptionString=" ","First Warning","Second Warning","Third Warning" }
    { 5939;   ;No. of Allocations  ;Integer       ;FieldClass=FlowField;
                                                   CalcFormula=Count("Service Order Allocation" WHERE ("Document Type"=FIELD("Document Type"),
                                                                                                       "Document No."=FIELD("No."),
                                                                                                       "Resource No."=FIELD("Resource Filter"),
                                                                                                       "Resource Group No."=FIELD("Resource Group Filter"),
                                                                                                       "Allocation Date"=FIELD("Date Filter"),
                                                                                                       Status=FILTER(Active|Finished)));
                                                   CaptionML=ENU=No. of Allocations;
                                                   Editable=false }
    { 5940;   ;Contract No.        ;Code20        ;TableRelation="Service Contract Header"."Contract No." WHERE ("Contract Type"=CONST(Contract),
                                                                                                                 "Customer No."=FIELD("Customer No."),
                                                                                                                 "Ship-to Code"=FIELD("Ship-to Code"),
                                                                                                                 "Bill-to Customer No."=FIELD("Bill-to Customer No."));
                                                   OnValidate=VAR
                                                                ServContractHeader@1001 : Record "Service Contract Header";
                                                                ServContractLine@1000 : Record "Service Contract Line";
                                                              BEGIN
                                                                if "Contract No." <> xRec."Contract No." then begin
                                                                  if "Contract No." <> '' then begin
                                                                    TESTFIELD("Order Date");
                                                                    ServContractHeader.GET(ServContractHeader."Contract Type"::Contract,"Contract No.");
                                                                    if ServContractHeader.Status <> ServContractHeader.Status::Signed then
                                                                      ERROR(Text041,"Contract No.");
                                                                    if ServContractHeader."Starting Date" > "Order Date" then
                                                                      ERROR(Text042,"Contract No.");
                                                                    if (ServContractHeader."Expiration Date" <> 0D) and
                                                                       (ServContractHeader."Expiration Date" < "Order Date")
                                                                    then
                                                                      ERROR(Text043,"Contract No.");
                                                                  end;
                                                                  ServItemLine.RESET;
                                                                  ServItemLine.SETRANGE("Document Type","Document Type");
                                                                  ServItemLine.SETRANGE("Document No.","No.");
                                                                  if ServItemLine.FIND('-') then
                                                                    ERROR(Text028,
                                                                      FIELDCAPTION("Contract No."),ServItemLine.TABLECAPTION);
                                                                  if not
                                                                     CONFIRM(
                                                                       Text029,
                                                                       false,ServContractLine.FIELDCAPTION("Next Planned Service Date"),
                                                                       ServContractLine.TABLECAPTION,
                                                                       FIELDCAPTION("Contract No."))
                                                                  then begin
                                                                    "Contract No." := xRec."Contract No.";
                                                                    exit;
                                                                  end;

                                                                  if "Contract No." <> '' then begin
                                                                    TESTFIELD("Customer No.");
                                                                    TESTFIELD("Bill-to Customer No.");
                                                                    "Default Response Time (Hours)" := ServContractHeader."Response Time (Hours)";
                                                                    TESTFIELD("Ship-to Code",ServContractHeader."Ship-to Code");
                                                                    "Service Order Type" := ServContractHeader."Service Order Type";
                                                                    VALIDATE("Currency Code",ServContractHeader."Currency Code");
                                                                    "Max. Labor Unit Price" := ServContractHeader."Max. Labor Unit Price";
                                                                    "Your Reference" := ServContractHeader."Your Reference";
                                                                    "Service Zone Code" := ServContractHeader."Service Zone Code";
                                                                  end;
                                                                end;

                                                                if "Contract No." <> '' then
                                                                  CreateDim(
                                                                    DATABASE::"Service Contract Header","Contract No.",
                                                                    DATABASE::"Service Order Type","Service Order Type",
                                                                    DATABASE::Customer,"Bill-to Customer No.",
                                                                    DATABASE::"Salesperson/Purchaser","Salesperson Code",
                                                                    DATABASE::"Responsibility Center","Responsibility Center");
                                                              END;

                                                   OnLookup=VAR
                                                              ServContractHeader@1000 : Record "Service Contract Header";
                                                              ServContractList@1001 : Page "Service Contract List";
                                                            BEGIN
                                                              if "Contract No." <> '' then
                                                                if ServContractHeader.GET(ServContractHeader."Contract Type"::Contract,"Contract No.") then
                                                                  ServContractList.SETRECORD(ServContractHeader);

                                                              ServContractHeader.RESET;
                                                              ServContractHeader.FILTERGROUP(2);
                                                              ServContractHeader.SETCURRENTKEY("Customer No.","Ship-to Code");
                                                              ServContractHeader.SETRANGE("Customer No.","Customer No.");
                                                              ServContractHeader.SETRANGE("Ship-to Code","Ship-to Code");
                                                              ServContractHeader.SETRANGE("Contract Type",ServContractHeader."Contract Type"::Contract);
                                                              ServContractHeader.SETRANGE("Bill-to Customer No.","Bill-to Customer No.");
                                                              ServContractHeader.SETRANGE(Status,ServContractHeader.Status::Signed);
                                                              ServContractHeader.SETFILTER("Starting Date",'<=%1',"Order Date");
                                                              ServContractHeader.SETFILTER("Expiration Date",'>=%1 | =%2',"Order Date",0D);
                                                              ServContractHeader.FILTERGROUP(0);
                                                              CLEAR(ServContractList);
                                                              ServContractList.SETTABLEVIEW(ServContractHeader);
                                                              ServContractList.LOOKUPMODE(true);
                                                              if ServContractList.RUNMODAL = ACTION::LookupOK then begin
                                                                ServContractList.GETRECORD(ServContractHeader);
                                                                VALIDATE("Contract No.",ServContractHeader."Contract No.");
                                                              end;
                                                            END;

                                                   CaptionML=ENU=Contract No. }
    { 5951;   ;Type Filter         ;Option        ;FieldClass=FlowFilter;
                                                   CaptionML=ENU=Type Filter;
                                                   OptionCaptionML=ENU=" ,Resource,Item,Service Cost,Service Contract";
                                                   OptionString=" ",Resource,Item,"Service Cost","Service Contract" }
    { 5952;   ;Customer Filter     ;Code20        ;FieldClass=FlowFilter;
                                                   TableRelation=Customer."No.";
                                                   CaptionML=ENU=Customer Filter }
    { 5953;   ;Resource Filter     ;Code20        ;FieldClass=FlowFilter;
                                                   TableRelation=Resource;
                                                   CaptionML=ENU=Resource Filter }
    { 5954;   ;Contract Filter     ;Code20        ;FieldClass=FlowFilter;
                                                   TableRelation="Service Contract Header"."Contract No." WHERE ("Contract Type"=CONST(Contract));
                                                   CaptionML=ENU=Contract Filter }
    { 5955;   ;Ship-to Fax No.     ;Text30        ;CaptionML=ENU=Ship-to Fax No. }
    { 5956;   ;Ship-to E-Mail      ;Text80        ;OnValidate=VAR
                                                                MailManagement@1000 : Codeunit "Mail Management";
                                                              BEGIN
                                                                MailManagement.ValidateEmailAddressField("Ship-to E-Mail");
                                                              END;

                                                   ExtendedDatatype=E-Mail;
                                                   CaptionML=ENU=Ship-to Email }
    { 5957;   ;Resource Group Filter;Code20       ;FieldClass=FlowFilter;
                                                   TableRelation="Resource Group";
                                                   CaptionML=ENU=Resource Group Filter }
    { 5958;   ;Ship-to Phone       ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=ENU=Ship-to Phone }
    { 5959;   ;Ship-to Phone 2     ;Text30        ;ExtendedDatatype=Phone No.;
                                                   CaptionML=ENU=Ship-to Phone 2 }
    { 5966;   ;Service Zone Filter ;Code10        ;FieldClass=FlowFilter;
                                                   TableRelation="Service Zone".Code;
                                                   CaptionML=ENU=Service Zone Filter }
    { 5968;   ;Service Zone Code   ;Code10        ;TableRelation="Service Zone".Code;
                                                   OnValidate=VAR
                                                                ShipToAddr@1000 : Record "Ship-to Address";
                                                              BEGIN
                                                                if ShipToAddr.GET("Customer No.","Ship-to Code") then
                                                                  "Service Zone Code" := ShipToAddr."Service Zone Code"
                                                                else
                                                                  if Cust.GET("Customer No.") then
                                                                    "Service Zone Code" := Cust."Service Zone Code"
                                                                  else
                                                                    "Service Zone Code" := '';
                                                              END;

                                                   CaptionML=ENU=Service Zone Code;
                                                   Editable=false }
    { 5981;   ;Expected Finishing Date;Date       ;CaptionML=ENU=Expected Finishing Date }
    { 7001;   ;Allow Line Disc.    ;Boolean       ;OnValidate=BEGIN
                                                                MessageIfServLinesExist(FIELDCAPTION("Allow Line Disc."));
                                                              END;

                                                   CaptionML=ENU=Allow Line Disc. }
    { 9000;   ;Assigned User ID    ;Code50        ;TableRelation="User Setup";
                                                   OnValidate=BEGIN
                                                                if not UserSetupMgt.CheckRespCenter2(2,"Responsibility Center","Assigned User ID") then
                                                                  ERROR(Text060,"Assigned User ID",UserSetupMgt.GetServiceFilter2("Assigned User ID"));
                                                              END;

                                                   CaptionML=ENU=Assigned User ID }
    { 9001;   ;Quote No.           ;Code20        ;CaptionML=ENU=Quote No. }
  }
  KEYS
  {
    {    ;"Document Type","No."                   ;Clustered=true }
    {    ;"No.","Document Type"                    }
    {    ;"Customer No.","Order Date"              }
    {    ;"Contract No.",Status,"Posting Date"     }
    {    ;Status,"Response Date","Response Time",Priority }
    {    ;Status,Priority,"Response Date","Response Time" }
    {    ;"Document Type","Customer No.","Order Date";
                                                   MaintainSQLIndex=false }
  }
  FIELDGROUPS
  {
    { 1   ;DropDown            ;"Document Type","No.","Customer No.","Posting Date",Status }
  }
  CODE
  {
    VAR
      Text000@1000 : TextConst '@@@="%1=User management service filter;";ENU=You cannot delete this document. Your identification is set up to process from Responsibility Center %1 only.';
      Text001@1001 : TextConst 'ENU=Changing %1 in service header %2 will not update the existing service lines.\You must update the existing service lines manually.';
      Text003@1003 : TextConst '@@@="%1=Customer number field caption;%2=Document type;%3=Number field caption;%4=Number;%5=Contract number field caption;%6=Contract number; ";ENU=You cannot change the %1 because the %2 %3 %4 is associated with a %5 %6.';
      Text004@1004 : TextConst 'ENU=When you change the %1 the existing Service item line and service line will be deleted.\Do you want to change the %1?';
      Text005@1005 : TextConst 'ENU=Do you want to change the %1?';
      Text007@1007 : TextConst 'ENU=%1 cannot be greater than %2.';
      Text008@1008 : TextConst '@@@="%1=Document type format;%2=Number field caption;%3=Number;";ENU="You cannot create Service %1 with %2=%3 because this number has already been used in the system."';
      Text010@1010 : TextConst '@@@="%1=Resposibility center table caption;%2=User management service filter;";ENU=Your identification is set up to process from %1 %2 only.';
      Text011@1011 : TextConst 'ENU=%1 cannot be greater than %2 in the %3 table.';
      Text012@1012 : TextConst 'ENU=If you change %1, the existing service lines will be deleted and the program will create new service lines based on the new information on the header.\Do you want to change the %1?';
      Text013@1089 : TextConst 'ENU=Deleting this document will cause a gap in the number series for posted credit memos. An empty posted credit memo %1 will be created to fill this gap in the number series.\\Do you want to continue?';
      Text015@1015 : TextConst 'ENU=Do you want to update the exchange rate?';
      Text016@1016 : TextConst 'ENU=You have modified %1.\Do you want to update the service lines?';
      Text018@1018 : TextConst '@@@="%1=Service order type field caption;%2=table caption;%3=Document type field caption;%4=Document type format;%5=Number field caption;%6=Number format;";ENU="You have not specified the %1 for %2 %3=%4, %5=%6."';
      Text019@1019 : TextConst 'ENU=You have changed %1 on the service header, but it has not been changed on the existing service lines.\The change may affect the exchange rate used in the price calculation of the service lines.';
      Text021@1021 : TextConst 'ENU=You have changed %1 on the %2, but it has not been changed on the existing service lines.\You must update the existing service lines manually.';
      ServSetup@1023 : Record "Service Mgt. Setup";
      Cust@1024 : Record Customer;
      ServHeader@1025 : Record "Service Header";
      ServLine@1026 : Record "Service Line";
      ServItemLine@1027 : Record "Service Item Line";
      PostCode@1031 : Record "Post Code";
      CurrExchRate@1033 : Record "Currency Exchange Rate";
      GLSetup@1034 : Record "General Ledger Setup";
      ServShptHeader@1085 : Record "Service Shipment Header";
      ServInvHeader@1084 : Record "Service Invoice Header";
      ServCrMemoHeader@1077 : Record "Service Cr.Memo Header";
      ReservEntry@1076 : Record "Reservation Entry";
      TempReservEntry@1075 : TEMPORARY Record "Reservation Entry";
      ServOrderMgt@1037 : Codeunit ServOrderManagement;
      DimMgt@1038 : Codeunit DimensionManagement;
      NoSeriesMgt@1039 : Codeunit NoSeriesManagement;
      ServLogMgt@1040 : Codeunit ServLogManagement;
      UserSetupMgt@1043 : Codeunit "User Setup Management";
      NotifyCust@1044 : Codeunit "Customer-Notify by Email";
      ServPost@1101 : Codeunit "Service-Post";
      CurrencyDate@1046 : Date;
      TempLinkToServItem@1047 : Boolean;
      HideValidationDialog@1048 : Boolean;
      Text024@1002 : TextConst 'ENU=The %1 cannot be greater than the minimum %1 of the\ Service Item Lines.';
      Text025@1050 : TextConst 'ENU=The %1 cannot be less than the maximum %1 of the related\ Service Item Lines.';
      Text026@1051 : TextConst 'ENU=%1 cannot be earlier than the %2.';
      Text027@1052 : TextConst 'ENU=The %1 cannot be greater than the minimum %2 of the related\ Service Item Lines.';
      ValidatingFromLines@1053 : Boolean;
      LinesExist@1054 : Boolean;
      Text028@1057 : TextConst 'ENU=You cannot change the %1 because %2 exists.';
      Text029@1056 : TextConst 'ENU=The %1 field on the %2 will be updated if you change %3 manually.\Do you want to continue?';
      Text031@1059 : TextConst '@@@="%1=Status field caption;%2=Status format;%3=table caption;%4=Number;%5=ServItemLine repair status code field caption;%6=ServItemLine repair status code;%7=ServItemLine table caption;%8=ServItemLine line number;";ENU=You cannot change %1 to %2 in %3 %4.\\%5 %6 in %7 %8 line is preventing it.';
      Text037@1060 : TextConst '@@@="%1=Contact number;%2=Contact name;%3=Customer number;";ENU=Contact %1 %2 is not related to customer %3.';
      Text038@1013 : TextConst '@@@="%1=Contact number;%2=Contact name;%3=Customer number;";ENU=Contact %1 %2 is related to a different company than customer %3.';
      Text039@1061 : TextConst '@@@="%1=Contact number;%2=Contact name;";ENU=Contact %1 %2 is not related to a customer.';
      ContactNo@1045 : Code[20];
      Text040@1063 : TextConst '@@@="%1=table caption;%2=ServItemLine document number;%3=ServItemLine line number;%4=ServItemLine loaner number field caption;%5=ServItemLine loaner number;";ENU=You cannot delete %1 %2 because the %4 %5 for Service Item Line %3 has not been received.';
      SkipContact@1064 : Boolean;
      SkipBillToContact@1062 : Boolean;
      Text041@1068 : TextConst 'ENU=Contract %1 is not signed.';
      Text042@1069 : TextConst 'ENU=The service period for contract %1 has not yet started.';
      Text043@1070 : TextConst 'ENU=The service period for contract %1 has expired.';
      Text044@1073 : TextConst 'ENU=You cannot rename a %1.';
      Confirmed@1080 : Boolean;
      Text045@1083 : TextConst '@@@="%1=Posting date field caption;%2=Posting number series field caption;%3=Posting number series;%4=NoSeries date order field caption;%5=NoSeries date order;%6=Document type;%7=posting number field caption;%8=Posting number;";ENU="You can not change the %1 field because %2 %3 has %4 = %5 and the %6 has already been assigned %7 %8."';
      Text046@1104 : TextConst 'ENU=You cannot delete invoice %1 because one or more service ledger entries exist for this invoice.';
      Text047@1100 : TextConst 'ENU=You cannot change %1 because reservation, item tracking, or order tracking exists on the sales order.';
      Text050@1094 : TextConst 'ENU=You cannot reset %1 because the document still has one or more lines.';
      Text051@1082 : TextConst '@@@="%1=Document type format;%2=Number;";ENU=The service %1 %2 already exists.';
      Text053@1093 : TextConst 'ENU=Deleting this document will cause a gap in the number series for shipments. An empty shipment %1 will be created to fill this gap in the number series.\\Do you want to continue?';
      Text054@1091 : TextConst 'ENU=Deleting this document will cause a gap in the number series for posted invoices. An empty posted invoice %1 will be created to fill this gap in the number series.\\Do you want to continue?';
      Text055@1079 : TextConst 'ENU=You have modified the %1 field. Note that the recalculation of VAT may cause penny differences, so you must check the amounts afterwards. Do you want to update the %2 field on the lines to reflect the new value of %1?';
      Text057@1103 : TextConst 'ENU=When you change the %1 the existing service line will be deleted.\Do you want to change the %1?';
      Text058@1088 : TextConst '@@@="%1=Currency code field caption;%2=Document type;%3=Number;%4=Contract number;";ENU=You cannot change %1 because %2 %3 is linked to Contract %4.';
      Text060@1154 : TextConst '@@@="%1=Assigned user ID;%2=User management service filter assigned user id;";ENU=Responsibility Center is set up to process from %1 %2 only.';
      Text061@1099 : TextConst 'ENU=You may have changed a dimension.\\Do you want to update the lines?';
      Text062@1087 : TextConst 'ENU=An open inventory pick exists for the %1 and because %2 is %3.\\You must first post or delete the inventory pick or change %2 to Partial.';
      Text063@1102 : TextConst 'ENU=An open warehouse shipment exists for the %1 and %2 is %3.\\You must add the item(s) as new line(s) to the existing warehouse shipment or change %2 to Partial.';
      Text064@1105 : TextConst 'ENU=You cannot change %1 to %2 because an open inventory pick on the %3.';
      Text065@1106 : TextConst 'ENU=You cannot change %1  to %2 because an open warehouse shipment exists for the %3.';
      Text066@1017 : TextConst 'ENU=You cannot change the dimension because there are service entries connected to this line.';
      PostedDocsToPrintCreatedMsg@1022 : TextConst 'ENU=One or more related posted documents have been generated during deletion to fill gaps in the posting number series. You can view or print the documents from the respective document archive.';
      DocumentNotPostedClosePageQst@1020 : TextConst 'ENU=The document has not been posted.\Are you sure you want to exit?';

    PROCEDURE AssistEdit@1(OldServHeader@1000 : Record "Service Header") : Boolean;
    VAR
      ServHeader2@1001 : Record "Service Header";
    BEGIN
      with ServHeader do begin
        COPY(Rec);
        ServSetup.GET;
        TestNoSeries;
        if NoSeriesMgt.SelectSeries(GetNoSeriesCode,OldServHeader."No. Series","No. Series") then begin
          if ("Customer No." = '') and ("Contact No." = '') then
            CheckCreditMaxBeforeInsert(false);

          NoSeriesMgt.SetSeries("No.");
          if ServHeader2.GET("Document Type","No.") then
            ERROR(Text051,LOWERCASE(FORMAT("Document Type")),"No.");
          Rec := ServHeader;
          exit(true);
        end;
      end;
    END;

    LOCAL PROCEDURE CreateDim@16(Type1@1000 : Integer;No1@1001 : Code[20];Type2@1002 : Integer;No2@1003 : Code[20];Type3@1004 : Integer;No3@1005 : Code[20];Type4@1006 : Integer;No4@1007 : Code[20];Type5@1012 : Integer;No5@1011 : Code[20]);
    VAR
      SourceCodeSetup@1008 : Record "Source Code Setup";
      ServiceContractHeader@1015 : Record "Service Contract Header";
      No@1010 : ARRAY [10] OF Code[20];
      TableID@1009 : ARRAY [10] OF Integer;
      ContractDimensionSetID@1014 : Integer;
      OldDimSetID@1013 : Integer;
    BEGIN
      SourceCodeSetup.GET;

      TableID[1] := Type1;
      No[1] := No1;
      TableID[2] := Type2;
      No[2] := No2;
      TableID[3] := Type3;
      No[3] := No3;
      TableID[4] := Type4;
      No[4] := No4;
      TableID[5] := Type5;
      No[5] := No5;
      OnAfterCreateDimTableIDs(Rec,CurrFieldNo,TableID,No);

      "Shortcut Dimension 1 Code" := '';
      "Shortcut Dimension 2 Code" := '';
      OldDimSetID := "Dimension Set ID";

      if "Contract No." <> '' then begin
        ServiceContractHeader.GET(ServiceContractHeader."Contract Type"::Contract,"Contract No.");
        ContractDimensionSetID := ServiceContractHeader."Dimension Set ID";
      end;

      "Dimension Set ID" :=
        DimMgt.GetRecDefaultDimID(
          Rec,CurrFieldNo,TableID,No,SourceCodeSetup."Service Management",
          "Shortcut Dimension 1 Code","Shortcut Dimension 2 Code",ContractDimensionSetID,DATABASE::"Service Contract Header");

      if ("Dimension Set ID" <> OldDimSetID) and (ServItemLineExists or ServLineExists) then begin
        MODIFY;
        UpdateAllLineDim("Dimension Set ID",OldDimSetID);
      end;
    END;

    [External]
    PROCEDURE UpdateAllLineDim@41(NewParentDimSetID@1000 : Integer;OldParentDimSetID@1001 : Integer);
    VAR
      NewDimSetID@1002 : Integer;
    BEGIN
      // Update all lines with changed dimensions.
      if NewParentDimSetID = OldParentDimSetID then
        exit;
      if not CONFIRM(Text061) then
        exit;

      ServLine.RESET;
      ServLine.SETRANGE("Document Type","Document Type");
      ServLine.SETRANGE("Document No.","No.");
      ServLine.LOCKTABLE;
      if ServLine.FIND('-') then
        repeat
          NewDimSetID := DimMgt.GetDeltaDimSetID(ServLine."Dimension Set ID",NewParentDimSetID,OldParentDimSetID);
          if ServLine."Dimension Set ID" <> NewDimSetID then begin
            ServLine."Dimension Set ID" := NewDimSetID;
            DimMgt.UpdateGlobalDimFromDimSetID(
              ServLine."Dimension Set ID",ServLine."Shortcut Dimension 1 Code",ServLine."Shortcut Dimension 2 Code");
            ServLine.MODIFY;
          end;
        until ServLine.NEXT = 0;

      ServItemLine.RESET;
      ServItemLine.SETRANGE("Document Type","Document Type");
      ServItemLine.SETRANGE("Document No.","No.");
      ServItemLine.LOCKTABLE;
      if ServItemLine.FIND('-') then
        repeat
          NewDimSetID := DimMgt.GetDeltaDimSetID(ServItemLine."Dimension Set ID",NewParentDimSetID,OldParentDimSetID);
          if ServItemLine."Dimension Set ID" <> NewDimSetID then begin
            ServItemLine."Dimension Set ID" := NewDimSetID;
            DimMgt.UpdateGlobalDimFromDimSetID(
              ServItemLine."Dimension Set ID",ServItemLine."Shortcut Dimension 1 Code",ServItemLine."Shortcut Dimension 2 Code");
            ServItemLine.MODIFY;
          end;
        until ServItemLine.NEXT = 0;
    END;

    LOCAL PROCEDURE ValidateShortcutDimCode@19(FieldNumber@1000 : Integer;VAR ShortcutDimCode@1001 : Code[20]);
    VAR
      OldDimSetID@1002 : Integer;
    BEGIN
      OldDimSetID := "Dimension Set ID";
      DimMgt.ValidateShortcutDimValues(FieldNumber,ShortcutDimCode,"Dimension Set ID");

      if ServItemLineExists or ServLineExists then
        UpdateAllLineDim("Dimension Set ID",OldDimSetID);
    END;

    LOCAL PROCEDURE UpdateCurrencyFactor@12();
    BEGIN
      if "Currency Code" <> '' then begin
        CurrencyDate := "Posting Date";
        "Currency Factor" := CurrExchRate.ExchangeRate(CurrencyDate,"Currency Code");
      end else
        "Currency Factor" := 0;
    END;

    LOCAL PROCEDURE RecreateServLines@2(ChangedFieldName@1000 : Text[100]);
    VAR
      TempServLine@1002 : TEMPORARY Record "Service Line";
      ServDocReg@1005 : Record "Service Document Register";
      TempServDocReg@1004 : TEMPORARY Record "Service Document Register";
      ExtendedTextAdded@1003 : Boolean;
    BEGIN
      if ServLineExists then begin
        if HideValidationDialog or not GUIALLOWED then
          Confirmed := true
        else
          Confirmed :=
            CONFIRM(
              Text012,
              false,ChangedFieldName);
        if Confirmed then begin
          ServLine.LOCKTABLE;
          ReservEntry.LOCKTABLE;
          MODIFY;

          ServLine.RESET;
          ServLine.SETRANGE("Document Type","Document Type");
          ServLine.SETRANGE("Document No.","No.");
          if ServLine.FIND('-') then begin
            repeat
              ServLine.TESTFIELD("Quantity Shipped",0);
              ServLine.TESTFIELD("Quantity Invoiced",0);
              ServLine.TESTFIELD("Shipment No.",'');
              TempServLine := ServLine;
              if ServLine.Nonstock then begin
                ServLine.Nonstock := false;
                ServLine.MODIFY;
              end;
              TempServLine.INSERT;
              CopyReservEntryToTemp(ServLine);
            until ServLine.NEXT = 0;

            if "Location Code" <> xRec."Location Code" then
              if not TempReservEntry.ISEMPTY then
                ERROR(Text047,FIELDCAPTION("Location Code"));

            if "Document Type" = "Document Type"::Invoice then begin
              ServDocReg.SETCURRENTKEY("Destination Document Type","Destination Document No.");
              ServDocReg.SETRANGE("Destination Document Type",ServDocReg."Destination Document Type"::Invoice);
              ServDocReg.SETRANGE("Destination Document No.",TempServLine."Document No.");
              if ServDocReg.FIND('-') then
                repeat
                  TempServDocReg := ServDocReg;
                  TempServDocReg.INSERT;
                until ServDocReg.NEXT = 0;
            end;
            ServLine.DELETEALL(true);

            if "Document Type" = "Document Type"::Invoice then begin
              if TempServDocReg.FIND('-') then
                repeat
                  ServDocReg := TempServDocReg;
                  ServDocReg.INSERT;
                until TempServDocReg.NEXT = 0;
            end;

            CreateServiceLines(TempServLine,ExtendedTextAdded);
            TempServLine.SETRANGE(Type);
            TempServLine.DELETEALL;
          end;
        end else
          ERROR('');
      end;
    END;

    LOCAL PROCEDURE ConfirmUpdateCurrencyFactor@13();
    BEGIN
      if CONFIRM(Text015,false) then
        VALIDATE("Currency Factor")
      else
        "Currency Factor" := xRec."Currency Factor";
    END;

    LOCAL PROCEDURE UpdateServLines@15(ChangedFieldName@1000 : Text[100];AskQuestion@1001 : Boolean);
    VAR
      Question@1002 : Text[250];
    BEGIN
      if ServLineExists and AskQuestion then begin
        Question := STRSUBSTNO(
            Text016,
            ChangedFieldName);
        if GUIALLOWED then
          if not CONFIRM(Question,true) then
            exit
      end;

      if ServLineExists then begin
        ServLine.LOCKTABLE;
        ServLine.RESET;
        ServLine.SETRANGE("Document Type","Document Type");
        ServLine.SETRANGE("Document No.","No.");

        ServLine.SETRANGE("Quantity Shipped",0);
        ServLine.SETRANGE("Quantity Invoiced",0);
        ServLine.SETRANGE("Quantity Consumed",0);
        ServLine.SETRANGE("Shipment No.",'');

        if ServLine.FIND('-') then
          repeat
            case ChangedFieldName of
              FIELDCAPTION("Currency Factor"):
                if (ServLine."Posting Date" = "Posting Date") and (ServLine.Type <> ServLine.Type::" ") then begin
                  ServLine.VALIDATE("Unit Price");
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Posting Date"):
                begin
                  ServLine.VALIDATE("Posting Date","Posting Date");
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Responsibility Center"):
                begin
                  ServLine.VALIDATE("Responsibility Center","Responsibility Center");
                  ServLine.MODIFY(true);
                  ServItemLine.RESET;
                  ServItemLine.SETRANGE("Document Type","Document Type");
                  ServItemLine.SETRANGE("Document No.","No.");
                  if ServItemLine.FIND('-') then
                    repeat
                      ServItemLine.VALIDATE("Responsibility Center","Responsibility Center");
                      ServItemLine.MODIFY(true);
                    until ServItemLine.NEXT = 0;
                end;
              FIELDCAPTION("Order Date"):
                begin
                  ServLine."Order Date" := "Order Date";
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Transaction Type"):
                begin
                  ServLine.VALIDATE("Transaction Type","Transaction Type");
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Transport Method"):
                begin
                  ServLine.VALIDATE("Transport Method","Transport Method");
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Exit Point"):
                begin
                  ServLine.VALIDATE("Exit Point","Exit Point");
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION(Area):
                begin
                  ServLine.VALIDATE(Area,Area);
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Transaction Specification"):
                begin
                  ServLine.VALIDATE("Transaction Specification","Transaction Specification");
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Shipping Agent Code"):
                begin
                  ServLine.VALIDATE("Shipping Agent Code","Shipping Agent Code");
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Shipping Time"):
                begin
                  ServLine.VALIDATE("Shipping Time","Shipping Time");
                  ServLine.MODIFY(true);
                end;
              FIELDCAPTION("Shipping Agent Service Code"):
                begin
                  ServLine.VALIDATE("Shipping Agent Service Code","Shipping Agent Service Code");
                  ServLine.MODIFY(true);
                end;
              else
                OnUpdateServLineByChangedFieldName(ServHeader,ServLine,ChangedFieldName);
            end;
          until ServLine.NEXT = 0;
      end;
    END;

    [External]
    PROCEDURE TestMandatoryFields@9(VAR PassedServLine@1002 : Record "Service Line");
    BEGIN
      ServSetup.GET;
      CheckMandSalesPersonOrderData(ServSetup);
      PassedServLine.RESET;
      ServLine.RESET;
      ServLine.SETRANGE("Document Type","Document Type");
      ServLine.SETRANGE("Document No.","No.");

      if PassedServLine.FIND('-') then
        repeat
          if (PassedServLine."Qty. to Ship" <> 0) or
             (PassedServLine."Qty. to Invoice" <> 0) or
             (PassedServLine."Qty. to Consume" <> 0)
          then begin
            if ("Document Type" = "Document Type"::Order) and
               "Link Service to Service Item" and
               (PassedServLine.Type in [PassedServLine.Type::Item,PassedServLine.Type::Resource])
            then
              PassedServLine.TESTFIELD("Service Item Line No.");

            case PassedServLine.Type of
              PassedServLine.Type::Item:
                begin
                  if ServSetup."Unit of Measure Mandatory" then
                    PassedServLine.TESTFIELD("Unit of Measure Code");
                end;
              PassedServLine.Type::Resource:
                begin
                  if ServSetup."Work Type Code Mandatory" then
                    PassedServLine.TESTFIELD("Work Type Code");
                  if ServSetup."Unit of Measure Mandatory" then
                    PassedServLine.TESTFIELD("Unit of Measure Code");
                end;
              PassedServLine.Type::Cost:
                if ServSetup."Unit of Measure Mandatory" then
                  PassedServLine.TESTFIELD("Unit of Measure Code");
            end;

            if PassedServLine."Job No." <> '' then
              PassedServLine.TESTFIELD("Qty. to Consume",PassedServLine."Qty. to Ship");
          end;
        until PassedServLine.NEXT = 0
      else
        if ServLine.FIND('-') then
          repeat
            if (ServLine."Qty. to Ship" <> 0) or
               (ServLine."Qty. to Invoice" <> 0) or
               (ServLine."Qty. to Consume" <> 0)
            then begin
              if ("Document Type" = "Document Type"::Order) and
                 "Link Service to Service Item" and
                 (ServLine.Type in [ServLine.Type::Item,ServLine.Type::Resource])
              then
                ServLine.TESTFIELD("Service Item Line No.");

              case ServLine.Type of
                ServLine.Type::Item:
                  begin
                    if ServSetup."Unit of Measure Mandatory" then
                      ServLine.TESTFIELD("Unit of Measure Code");
                  end;
                ServLine.Type::Resource:
                  begin
                    if ServSetup."Work Type Code Mandatory" then
                      ServLine.TESTFIELD("Work Type Code");
                    if ServSetup."Unit of Measure Mandatory" then
                      ServLine.TESTFIELD("Unit of Measure Code");
                  end;
                ServLine.Type::Cost:
                  if ServSetup."Unit of Measure Mandatory" then
                    ServLine.TESTFIELD("Unit of Measure Code");
              end;

              if ServLine."Job No." <> '' then
                ServLine.TESTFIELD("Qty. to Consume",ServLine."Qty. to Ship");
            end;
          until ServLine.NEXT = 0;
    END;

    [External]
    PROCEDURE UpdateResponseDateTime@3();
    BEGIN
      ServItemLine.RESET;
      ServItemLine.SETCURRENTKEY("Document Type","Document No.","Response Date");
      ServItemLine.SETRANGE("Document Type","Document Type");
      ServItemLine.SETRANGE("Document No.","No.");
      if ServItemLine.FIND('-') then begin
        "Response Date" := ServItemLine."Response Date";
        "Response Time" := ServItemLine."Response Time";
        MODIFY(true);
      end;
    END;

    LOCAL PROCEDURE UpdateStartingDateTime@5();
    BEGIN
      if ValidatingFromLines then
        exit;
      ServItemLine.RESET;
      ServItemLine.SETCURRENTKEY("Document Type","Document No.","Starting Date");
      ServItemLine.SETRANGE("Document Type","Document Type");
      ServItemLine.SETRANGE("Document No.","No.");
      ServItemLine.SETFILTER("Starting Date",'<>%1',0D);
      if ServItemLine.FIND('-') then begin
        "Starting Date" := ServItemLine."Starting Date";
        "Starting Time" := ServItemLine."Starting Time";
        MODIFY(true);
      end else begin
        "Starting Date" := 0D;
        "Starting Time" := 000000T;
      end;
    END;

    LOCAL PROCEDURE UpdateFinishingDateTime@8();
    BEGIN
      if ValidatingFromLines then
        exit;
      ServItemLine.RESET;
      ServItemLine.SETCURRENTKEY("Document Type","Document No.","Finishing Date");
      ServItemLine.ASCENDING := false;
      ServItemLine.SETRANGE("Document Type","Document Type");
      ServItemLine.SETRANGE("Document No.","No.");
      ServItemLine.SETFILTER("Finishing Date",'<>%1',0D);
      if ServItemLine.FIND('-') then begin
        "Finishing Date" := ServItemLine."Finishing Date";
        "Finishing Time" := ServItemLine."Finishing Time";
        MODIFY(true);
      end else begin
        "Finishing Date" := 0D;
        "Finishing Time" := 000000T;
      end;
    END;

    LOCAL PROCEDURE PriceMsgIfServLinesExist@10(ChangedFieldName@1000 : Text[100]);
    BEGIN
      if ServLineExists then
        MESSAGE(
          Text019,
          ChangedFieldName);
    END;

    LOCAL PROCEDURE ServItemLineExists@4() : Boolean;
    VAR
      ServItemLine@1000 : Record "Service Item Line";
    BEGIN
      ServItemLine.RESET;
      ServItemLine.SETRANGE("Document Type","Document Type");
      ServItemLine.SETRANGE("Document No.","No.");
      exit(ServItemLine.FINDFIRST);
    END;

    LOCAL PROCEDURE ServLineExists@11() : Boolean;
    BEGIN
      ServLine.RESET;
      ServLine.SETRANGE("Document Type","Document Type");
      ServLine.SETRANGE("Document No.","No.");
      exit(ServLine.FIND('-'));
    END;

    LOCAL PROCEDURE MessageIfServLinesExist@7(ChangedFieldName@1000 : Text[100]);
    BEGIN
      if ServLineExists and not HideValidationDialog then
        MESSAGE(
          Text021,
          ChangedFieldName,TABLECAPTION);
    END;

    LOCAL PROCEDURE ValidateServPriceGrOnServItem@6();
    BEGIN
      ServItemLine.RESET;
      ServItemLine.SETRANGE("Document Type","Document Type");
      ServItemLine.SETRANGE("Document No.","No.");
      if ServItemLine.FIND('-') then begin
        ServItemLine.SetServHeader(Rec);
        repeat
          if ServItemLine."Service Price Group Code" <> '' then begin
            ServItemLine.VALIDATE("Service Price Group Code");
            ServItemLine.MODIFY;
          end;
        until ServItemLine.NEXT = 0
      end;
    END;

    [External]
    PROCEDURE SetHideValidationDialog@14(NewHideValidationDialog@1000 : Boolean);
    BEGIN
      HideValidationDialog := NewHideValidationDialog;
    END;

    [External]
    PROCEDURE SetValidatingFromLines@17(NewValidatingFromLines@1000 : Boolean);
    BEGIN
      ValidatingFromLines := NewValidatingFromLines;
    END;

    LOCAL PROCEDURE TestNoSeries@21();
    BEGIN
      case "Document Type" of
        "Document Type"::Quote:
          ServSetup.TESTFIELD("Service Quote Nos.");
        "Document Type"::Order:
          ServSetup.TESTFIELD("Service Order Nos.");
      end;
    END;

    LOCAL PROCEDURE GetNoSeriesCode@20() : Code[10];
    BEGIN
      case "Document Type" of
        "Document Type"::Quote:
          exit(ServSetup."Service Quote Nos.");
        "Document Type"::Order:
          exit(ServSetup."Service Order Nos.");
        "Document Type"::Invoice:
          exit(ServSetup."Service Invoice Nos.");
        "Document Type"::"Credit Memo":
          exit(ServSetup."Service Credit Memo Nos.");
      end;
    END;

    LOCAL PROCEDURE TestNoSeriesManual@33();
    BEGIN
      case "Document Type" of
        "Document Type"::Quote:
          NoSeriesMgt.TestManual(ServSetup."Service Quote Nos.");
        "Document Type"::Order:
          NoSeriesMgt.TestManual(ServSetup."Service Order Nos.");
        "Document Type"::Invoice:
          NoSeriesMgt.TestManual(ServSetup."Service Invoice Nos.");
        "Document Type"::"Credit Memo":
          NoSeriesMgt.TestManual(ServSetup."Service Credit Memo Nos.");
      end;
    END;

    LOCAL PROCEDURE UpdateCont@24(CustomerNo@1000 : Code[20]);
    VAR
      ContBusRel@1003 : Record "Contact Business Relation";
      Cont@1002 : Record Contact;
      Cust@1004 : Record Customer;
    BEGIN
      if Cust.GET(CustomerNo) then begin
        CLEAR(ServOrderMgt);
        ContactNo := ServOrderMgt.FindContactInformation(Cust."No.");
        if Cont.GET(ContactNo) then begin
          "Contact No." := Cont."No.";
          "Contact Name" := Cont.Name;
          "Phone No." := Cont."Phone No.";
          "E-Mail" := Cont."E-Mail";
        end else begin
          if Cust."Primary Contact No." <> '' then
            "Contact No." := Cust."Primary Contact No."
          else
            if ContBusRel.FindByRelation(ContBusRel."Link to Table"::Customer,"Customer No.") then
              "Contact No." := ContBusRel."Contact No."
            else
              "Contact No." := '';
          "Contact Name" := Cust.Contact;
        end;
      end;
    END;

    LOCAL PROCEDURE UpdateBillToCont@27(CustomerNo@1000 : Code[20]);
    VAR
      ContBusRel@1003 : Record "Contact Business Relation";
      Cont@1002 : Record Contact;
      Cust@1001 : Record Customer;
    BEGIN
      if Cust.GET(CustomerNo) then begin
        CLEAR(ServOrderMgt);
        ContactNo := ServOrderMgt.FindContactInformation("Bill-to Customer No.");
        if Cont.GET(ContactNo) then begin
          "Bill-to Contact No." := Cont."No.";
          "Bill-to Contact" := Cont.Name;
        end else begin
          if Cust."Primary Contact No." <> '' then
            "Bill-to Contact No." := Cust."Primary Contact No."
          else
            if ContBusRel.FindByRelation(ContBusRel."Link to Table"::Customer,"Bill-to Customer No.") then
              "Bill-to Contact No." := ContBusRel."Contact No."
            else
              "Bill-to Contact No." := '';
          "Bill-to Contact" := Cust.Contact;
        end;
      end;
    END;

    LOCAL PROCEDURE UpdateCust@25(ContactNo@1002 : Code[20]);
    VAR
      ContBusinessRelation@1007 : Record "Contact Business Relation";
      Cust@1006 : Record Customer;
      Cont@1005 : Record Contact;
    BEGIN
      if Cont.GET(ContactNo) then begin
        "Contact No." := Cont."No.";
        "Phone No." := Cont."Phone No.";
        "E-Mail" := Cont."E-Mail";
      end else begin
        "Phone No." := '';
        "E-Mail" := '';
        "Contact Name" := '';
        exit;
      end;

      if Cont.Type = Cont.Type::Person then
        "Contact Name" := Cont.Name
      else
        if Cust.GET("Customer No.") then
          "Contact Name" := Cust.Contact
        else
          "Contact Name" := '';

      if ContBusinessRelation.FindByContact(ContBusinessRelation."Link to Table"::Customer,Cont."Company No.") then begin
        if ("Customer No." <> '') and
           ("Customer No." <> ContBusinessRelation."No.")
        then
          ERROR(Text037,Cont."No.",Cont.Name,"Customer No.");

        if "Customer No." = '' then begin
          SkipContact := true;
          VALIDATE("Customer No.",ContBusinessRelation."No.");
          SkipContact := false;
        end;
      end else
        ERROR(Text039,Cont."No.",Cont.Name);

      if ("Customer No." = "Bill-to Customer No.") or
         ("Bill-to Customer No." = '')
      then
        VALIDATE("Bill-to Contact No.","Contact No.");
    END;

    LOCAL PROCEDURE UpdateBillToCust@26(ContactNo@1000 : Code[20]);
    VAR
      ContBusinessRelation@1005 : Record "Contact Business Relation";
      Cust@1004 : Record Customer;
      Cont@1003 : Record Contact;
    BEGIN
      if Cont.GET(ContactNo) then begin
        "Bill-to Contact No." := Cont."No.";
        if Cont.Type = Cont.Type::Person then
          "Bill-to Contact" := Cont.Name
        else
          if Cust.GET("Bill-to Customer No.") then
            "Bill-to Contact" := Cust.Contact
          else
            "Bill-to Contact" := '';
      end else begin
        "Bill-to Contact" := '';
        exit;
      end;

      if ContBusinessRelation.FindByContact(ContBusinessRelation."Link to Table"::Customer,Cont."Company No.") then begin
        if "Bill-to Customer No." = '' then begin
          SkipBillToContact := true;
          VALIDATE("Bill-to Customer No.",ContBusinessRelation."No.");
          SkipBillToContact := false;
        end else
          if "Bill-to Customer No." <> ContBusinessRelation."No." then
            ERROR(Text037,Cont."No.",Cont.Name,"Bill-to Customer No.");
      end else
        ERROR(Text039,Cont."No.",Cont.Name);
    END;

    PROCEDURE CheckCreditMaxBeforeInsert@28(HideCreditCheckDialogue@1004 : Boolean);
    VAR
      ServHeader@1001 : Record "Service Header";
      ContBusinessRelation@1002 : Record "Contact Business Relation";
      Cont@1003 : Record Contact;
      CustCheckCreditLimit@1000 : Codeunit "Cust-Check Cr. Limit";
    BEGIN
      if HideCreditCheckDialogue then
        exit;
      if GETFILTER("Customer No.") <> '' then begin
        if GETRANGEMIN("Customer No.") = GETRANGEMAX("Customer No.") then begin
          ServHeader."Bill-to Customer No." := GETRANGEMIN("Customer No.");
          CustCheckCreditLimit.ServiceHeaderCheck(ServHeader);
        end
      end else
        if GETFILTER("Contact No.") <> '' then
          if GETRANGEMIN("Contact No.") = GETRANGEMAX("Contact No.") then begin
            Cont.GET(GETRANGEMIN("Contact No."));
            if ContBusinessRelation.FindByContact(ContBusinessRelation."Link to Table"::Customer,Cont."Company No.") then begin
              ServHeader."Bill-to Customer No." := ContBusinessRelation."No.";
              CustCheckCreditLimit.ServiceHeaderCheck(ServHeader);
            end;
          end;
    END;

    [External]
    PROCEDURE UpdateServiceOrderChangeLog@22(VAR OldServHeader@1000 : Record "Service Header");
    BEGIN
      if Status <> OldServHeader.Status then
        ServLogMgt.ServHeaderStatusChange(Rec,OldServHeader);

      if "Customer No." <> OldServHeader."Customer No." then
        ServLogMgt.ServHeaderCustomerChange(Rec,OldServHeader);

      if "Ship-to Code" <> OldServHeader."Ship-to Code" then
        ServLogMgt.ServHeaderShiptoChange(Rec,OldServHeader);

      if "Contract No." <> OldServHeader."Contract No." then
        ServLogMgt.ServHeaderContractNoChanged(Rec,OldServHeader);
    END;

    LOCAL PROCEDURE GetPostingNoSeriesCode@39() : Code[10];
    BEGIN
      if "Document Type" in ["Document Type"::"Credit Memo"] then
        exit(ServSetup."Posted Serv. Credit Memo Nos.");
      exit(ServSetup."Posted Service Invoice Nos.");
    END;

    [External]
    PROCEDURE InitRecord@32();
    BEGIN
      case "Document Type" of
        "Document Type"::Quote,"Document Type"::Order:
          begin
            NoSeriesMgt.SetDefaultSeries("Posting No. Series",ServSetup."Posted Service Invoice Nos.");
            NoSeriesMgt.SetDefaultSeries("Shipping No. Series",ServSetup."Posted Service Shipment Nos.");
          end;
        "Document Type"::Invoice:
          begin
            if ("No. Series" <> '') and
               (ServSetup."Service Invoice Nos." = ServSetup."Posted Service Invoice Nos.")
            then
              "Posting No. Series" := "No. Series"
            else
              NoSeriesMgt.SetDefaultSeries("Posting No. Series",ServSetup."Posted Service Invoice Nos.");
            if ServSetup."Shipment on Invoice" then
              NoSeriesMgt.SetDefaultSeries("Shipping No. Series",ServSetup."Posted Service Shipment Nos.");
          end;
        "Document Type"::"Credit Memo":
          begin
            if ("No. Series" <> '') and
               (ServSetup."Service Credit Memo Nos." = ServSetup."Posted Serv. Credit Memo Nos.")
            then
              "Posting No. Series" := "No. Series"
            else
              NoSeriesMgt.SetDefaultSeries("Posting No. Series",ServSetup."Posted Serv. Credit Memo Nos.");
          end;
      end;

      if "Document Type" in ["Document Type"::Order,"Document Type"::Invoice,"Document Type"::Quote]
      then begin
        "Order Date" := WORKDATE;
        "Order Time" := TIME;
      end;

      "Posting Date" := WORKDATE;
      "Document Date" := WORKDATE;
      "Default Response Time (Hours)" := ServSetup."Default Response Time (Hours)";
      "Link Service to Service Item" := ServSetup."Link Service to Service Item";

      if Cust.GET("Customer No.") then
        VALIDATE("Location Code",UserSetupMgt.GetLocation(2,Cust."Location Code","Responsibility Center"));

      if "Document Type" in ["Document Type"::"Credit Memo"] then begin
        GLSetup.GET;
        Correction := GLSetup."Mark Cr. Memos as Corrections";
      end;

      "Posting Description" := FORMAT("Document Type") + ' ' + "No.";

      Reserve := Reserve::Optional;

      if Cust.GET("Customer No.") then
        if Cust."Responsibility Center" <> '' then
          "Responsibility Center" := UserSetupMgt.GetRespCenter(2,Cust."Responsibility Center")
        else
          "Responsibility Center" := UserSetupMgt.GetRespCenter(2,"Responsibility Center")
      else
        "Responsibility Center" := UserSetupMgt.GetServiceFilter;

      OnAfterInitRecord(Rec);
    END;

    LOCAL PROCEDURE InitRecordFromContact@43();
    BEGIN
      INIT;
      ServSetup.GET;
      InitRecord;
      "No. Series" := xRec."No. Series";
      if xRec."Shipping No." <> '' then begin
        "Shipping No. Series" := xRec."Shipping No. Series";
        "Shipping No." := xRec."Shipping No.";
      end;
      if xRec."Posting No." <> '' then begin
        "Posting No. Series" := xRec."Posting No. Series";
        "Posting No." := xRec."Posting No.";
      end;
    END;

    LOCAL PROCEDURE GetCust@30(CustNo@1000 : Code[20]);
    BEGIN
      if not (("Document Type" = "Document Type"::Quote) and (CustNo = '')) then begin
        if CustNo <> Cust."No." then
          Cust.GET(CustNo);
      end else
        CLEAR(Cust);
    END;

    LOCAL PROCEDURE ShippedServLinesExist@31() : Boolean;
    BEGIN
      ServLine.RESET;
      ServLine.SETRANGE("Document Type","Document Type");
      ServLine.SETRANGE("Document No.","No.");
      ServLine.SETFILTER("Quantity Shipped",'<>0');
      exit(ServLine.FIND('-'));
    END;

    LOCAL PROCEDURE UpdateShipToAddress@29();
    VAR
      Location@1000 : Record Location;
      CompanyInfo@1001 : Record "Company Information";
    BEGIN
      if "Document Type" = "Document Type"::"Credit Memo" then begin
        if "Location Code" <> '' then begin
          Location.GET("Location Code");
          SetShipToAddress(
            Location.Name,Location."Name 2",Location.Address,Location."Address 2",
            Location.City,Location."Post Code",Location.County,Location."Country/Region Code");
          "Ship-to Contact" := Location.Contact;
        end else begin
          CompanyInfo.GET;
          "Ship-to Code" := '';
          SetShipToAddress(
            CompanyInfo."Ship-to Name",CompanyInfo."Ship-to Name 2",CompanyInfo."Ship-to Address",CompanyInfo."Ship-to Address 2",
            CompanyInfo."Ship-to City",CompanyInfo."Ship-to Post Code",CompanyInfo."Ship-to County",
            CompanyInfo."Ship-to Country/Region Code");
          "Ship-to Contact" := CompanyInfo."Ship-to Contact";
        end;
        "VAT Country/Region Code" := "Country/Region Code";
      end;

      OnAfterUpdateShipToAddress(Rec);
    END;

    [External]
    PROCEDURE SetShipToAddress@117(ShipToName@1000 : Text[50];ShipToName2@1001 : Text[50];ShipToAddress@1002 : Text[50];ShipToAddress2@1003 : Text[50];ShipToCity@1004 : Text[30];ShipToPostCode@1005 : Code[20];ShipToCounty@1006 : Text[30];ShipToCountryRegionCode@1007 : Code[10]);
    BEGIN
      "Ship-to Name" := ShipToName;
      "Ship-to Name 2" := ShipToName2;
      "Ship-to Address" := ShipToAddress;
      "Ship-to Address 2" := ShipToAddress2;
      "Ship-to City" := ShipToCity;
      "Ship-to Post Code" := ShipToPostCode;
      "Ship-to County" := ShipToCounty;
      VALIDATE("Ship-to Country/Region Code",ShipToCountryRegionCode);
    END;

    [External]
    PROCEDURE ConfirmDeletion@36() : Boolean;
    BEGIN
      ServPost.TestDeleteHeader(Rec,ServShptHeader,ServInvHeader,ServCrMemoHeader);
      if ServShptHeader."No." <> '' then
        if not
           CONFIRM(
             Text053,
             true,ServShptHeader."No.")
        then
          exit;
      if ServInvHeader."No." <> '' then
        if not
           CONFIRM(
             Text054,
             true,ServInvHeader."No.")
        then
          exit;
      if ServCrMemoHeader."No." <> '' then
        if not
           CONFIRM(
             Text013,
             true,ServCrMemoHeader."No.")
        then
          exit;
      exit(true);
    END;

    LOCAL PROCEDURE CopyReservEntryToTemp@44(OldServLine@1001 : Record "Service Line");
    BEGIN
      ReservEntry.RESET;
      ReservEntry.SetSourceFilter(
        DATABASE::"Service Line",OldServLine."Document Type",OldServLine."Document No.",OldServLine."Line No.",false);
      if ReservEntry.FINDSET then
        repeat
          TempReservEntry := ReservEntry;
          TempReservEntry.INSERT;
        until ReservEntry.NEXT = 0;
      ReservEntry.DELETEALL;
    END;

    LOCAL PROCEDURE CopyReservEntryFromTemp@56(OldServLine@1001 : Record "Service Line";NewSourceRefNo@1000 : Integer);
    BEGIN
      TempReservEntry.RESET;
      TempReservEntry.SetSourceFilter(
        DATABASE::"Service Line",OldServLine."Document Type",OldServLine."Document No.",OldServLine."Line No.",false);
      if TempReservEntry.FINDSET then
        repeat
          ReservEntry := TempReservEntry;
          ReservEntry."Source Ref. No." := NewSourceRefNo;
          if not ReservEntry.INSERT then;
        until TempReservEntry.NEXT = 0;
      TempReservEntry.DELETEALL;
    END;

    [External]
    PROCEDURE ShowDocDim@23();
    VAR
      OldDimSetID@1000 : Integer;
    BEGIN
      OldDimSetID := "Dimension Set ID";
      "Dimension Set ID" :=
        DimMgt.EditDimensionSet2(
          "Dimension Set ID",STRSUBSTNO('%1 %2',"Document Type","No."),
          "Shortcut Dimension 1 Code","Shortcut Dimension 2 Code");
      if OldDimSetID <> "Dimension Set ID" then begin
        MODIFY;
        if ServItemLineExists or ServLineExists then
          UpdateAllLineDim("Dimension Set ID",OldDimSetID);
      end;
    END;

    [External]
    PROCEDURE LookupAdjmtValueEntries@37(QtyType@1000 : 'General,Invoicing');
    VAR
      ItemLedgEntry@1004 : Record "Item Ledger Entry";
      ServiceLine@1001 : Record "Service Line";
      ServiceShptLine@1005 : Record "Service Shipment Line";
      TempValueEntry@1003 : TEMPORARY Record "Value Entry";
    BEGIN
      ServiceLine.SETRANGE("Document Type","Document Type");
      ServiceLine.SETRANGE("Document No.","No.");
      TempValueEntry.RESET;
      TempValueEntry.DELETEALL;

      case "Document Type" of
        "Document Type"::Order,"Document Type"::Invoice:
          begin
            if ServiceLine.FINDSET then
              repeat
                if (ServiceLine.Type = ServiceLine.Type::Item) and (ServiceLine.Quantity <> 0) then
                  if ServiceLine."Shipment No." <> '' then begin
                    ServiceShptLine.SETRANGE("Document No.",ServiceLine."Shipment No.");
                    ServiceShptLine.SETRANGE("Line No.",ServiceLine."Shipment Line No.");
                  end else begin
                    ServiceShptLine.SETCURRENTKEY("Order No.","Order Line No.");
                    ServiceShptLine.SETRANGE("Order No.",ServiceLine."Document No.");
                    ServiceShptLine.SETRANGE("Order Line No.",ServiceLine."Line No.");
                  end;
                ServiceShptLine.SETRANGE(Correction,false);
                if QtyType = QtyType::Invoicing then
                  ServiceShptLine.SETFILTER("Qty. Shipped Not Invoiced",'<>0');

                if ServiceShptLine.FINDSET then
                  repeat
                    ServiceShptLine.FilterPstdDocLnItemLedgEntries(ItemLedgEntry);
                    if ItemLedgEntry.FINDSET then
                      repeat
                        CreateTempAdjmtValueEntries(TempValueEntry,ItemLedgEntry."Entry No.");
                      until ItemLedgEntry.NEXT = 0;
                  until ServiceShptLine.NEXT = 0;
              until ServiceLine.NEXT = 0;
          end;
      end;
      PAGE.RUNMODAL(0,TempValueEntry);
    END;

    LOCAL PROCEDURE CreateTempAdjmtValueEntries@38(VAR TempValueEntry@1001 : TEMPORARY Record "Value Entry";ItemLedgEntryNo@1000 : Integer);
    VAR
      ValueEntry@1002 : Record "Value Entry";
    BEGIN
      ValueEntry.SETCURRENTKEY("Item Ledger Entry No.");
      ValueEntry.SETRANGE("Item Ledger Entry No.",ItemLedgEntryNo);
      if ValueEntry.FINDSET then
        repeat
          if ValueEntry.Adjustment then begin
            TempValueEntry := ValueEntry;
            if TempValueEntry.INSERT then;
          end;
        until ValueEntry.NEXT = 0;
    END;

    [Internal]
    PROCEDURE CalcInvDiscForHeader@45();
    VAR
      ServiceInvDisc@1000 : Codeunit "Service-Calc. Discount";
    BEGIN
      ServiceInvDisc.CalculateIncDiscForHeader(Rec);
    END;

    [External]
    PROCEDURE SetSecurityFilterOnRespCenter@42();
    BEGIN
      if UserSetupMgt.GetServiceFilter <> '' then begin
        FILTERGROUP(2);
        SETRANGE("Responsibility Center",UserSetupMgt.GetServiceFilter);
        FILTERGROUP(0);
      end;

      SETRANGE("Date Filter",0D,WORKDATE - 1);
    END;

    LOCAL PROCEDURE CheckMandSalesPersonOrderData@40(ServiceMgtSetup@1000 : Record "Service Mgt. Setup");
    BEGIN
      if ServiceMgtSetup."Salesperson Mandatory" then
        TESTFIELD("Salesperson Code");

      if "Document Type" = "Document Type"::Order then begin
        if ServiceMgtSetup."Service Order Type Mandatory" and ("Service Order Type" = '') then
          ERROR(Text018,
            FIELDCAPTION("Service Order Type"),TABLECAPTION,
            FIELDCAPTION("Document Type"),FORMAT("Document Type"),
            FIELDCAPTION("No."),FORMAT("No."));
        if ServiceMgtSetup."Service Order Start Mandatory" then begin
          TESTFIELD("Starting Date");
          TESTFIELD("Starting Time");
        end;
        if ServiceMgtSetup."Service Order Finish Mandatory" then begin
          TESTFIELD("Finishing Date");
          TESTFIELD("Finishing Time");
        end;
        if ServiceMgtSetup."Fault Reason Code Mandatory" and not ValidatingFromLines then begin
          ServItemLine.RESET;
          ServItemLine.SETRANGE("Document Type","Document Type");
          ServItemLine.SETRANGE("Document No.","No.");
          if ServItemLine.FIND('-') then
            repeat
              ServItemLine.TESTFIELD("Fault Reason Code");
            until ServItemLine.NEXT = 0;
        end;
      end;
    END;

    [External]
    PROCEDURE InventoryPickConflict@47(DocType@1004 : 'Quote,Order,Invoice,"Credit Memo"';DocNo@1003 : Code[20];ShippingAdvice@1002 : 'Partial,Complete') : Boolean;
    VAR
      WarehouseActivityLine@1000 : Record "Warehouse Activity Line";
      ServiceLine@1001 : Record "Service Line";
    BEGIN
      if ShippingAdvice <> ShippingAdvice::Complete then
        exit(false);
      WarehouseActivityLine.SETCURRENTKEY("Source Type","Source Subtype","Source No.");
      WarehouseActivityLine.SETRANGE("Source Type",DATABASE::"Service Line");
      WarehouseActivityLine.SETRANGE("Source Subtype",DocType);
      WarehouseActivityLine.SETRANGE("Source No.",DocNo);
      if WarehouseActivityLine.ISEMPTY then
        exit(false);
      ServiceLine.SETRANGE("Document Type",DocType);
      ServiceLine.SETRANGE("Document No.",DocNo);
      ServiceLine.SETRANGE(Type,ServiceLine.Type::Item);
      if ServiceLine.ISEMPTY then
        exit(false);
      exit(true);
    END;

    [External]
    PROCEDURE InvPickConflictResolutionTxt@48() : Text[500];
    BEGIN
      exit(STRSUBSTNO(Text062,TABLECAPTION,FIELDCAPTION("Shipping Advice"),FORMAT("Shipping Advice")));
    END;

    [External]
    PROCEDURE WhseShpmntConflict@52(DocType@1002 : 'Quote,Order,Invoice,"Credit Memo"';DocNo@1001 : Code[20];ShippingAdvice@1000 : 'Partial,Complete') : Boolean;
    VAR
      WarehouseShipmentLine@1003 : Record "Warehouse Shipment Line";
    BEGIN
      if ShippingAdvice <> ShippingAdvice::Complete then
        exit(false);
      WarehouseShipmentLine.SETCURRENTKEY("Source Type","Source Subtype","Source No.","Source Line No.");
      WarehouseShipmentLine.SETRANGE("Source Type",DATABASE::"Service Line");
      WarehouseShipmentLine.SETRANGE("Source Subtype",DocType);
      WarehouseShipmentLine.SETRANGE("Source No.",DocNo);
      if WarehouseShipmentLine.ISEMPTY then
        exit(false);
      exit(true);
    END;

    [External]
    PROCEDURE WhseShpmtConflictResolutionTxt@54() : Text[500];
    BEGIN
      exit(STRSUBSTNO(Text063,TABLECAPTION,FIELDCAPTION("Shipping Advice"),FORMAT("Shipping Advice")));
    END;

    LOCAL PROCEDURE GetShippingTime@49(CalledByFieldNo@1000 : Integer);
    VAR
      ShippingAgentServices@1001 : Record "Shipping Agent Services";
    BEGIN
      if (CalledByFieldNo <> CurrFieldNo) and (CurrFieldNo <> 0) then
        exit;

      if ShippingAgentServices.GET("Shipping Agent Code","Shipping Agent Service Code") then
        "Shipping Time" := ShippingAgentServices."Shipping Time"
      else begin
        GetCust("Customer No.");
        "Shipping Time" := Cust."Shipping Time"
      end;
      if not (CalledByFieldNo in [FIELDNO("Shipping Agent Code"),FIELDNO("Shipping Agent Service Code")]) then
        VALIDATE("Shipping Time");
    END;

    LOCAL PROCEDURE CheckHeaderDimension@46();
    BEGIN
      if ("Contract No." <> '') and ("Document Type" = "Document Type"::Invoice) then
        ERROR(Text066);
    END;

    LOCAL PROCEDURE CreateServiceLines@50(VAR TempServLine@1004 : TEMPORARY Record "Service Line";VAR ExtendedTextAdded@1000 : Boolean);
    VAR
      TransferExtendedText@1001 : Codeunit "Transfer Extended Text";
    BEGIN
      ServLine.INIT;
      ServLine."Line No." := 0;
      TempServLine.FIND('-');
      ExtendedTextAdded := false;

      repeat
        if TempServLine."Attached to Line No." = 0 then begin
          ServLine.INIT;
          ServLine.SetHideReplacementDialog(true);
          ServLine.SetHideCostWarning(true);
          ServLine."Line No." := ServLine."Line No." + 10000;
          ServLine.VALIDATE(Type,TempServLine.Type);
          if TempServLine."No." <> '' then begin
            ServLine.VALIDATE("No.",TempServLine."No.");
            if ServLine.Type <> ServLine.Type::" " then begin
              ServLine.VALIDATE("Unit of Measure Code",TempServLine."Unit of Measure Code");
              ServLine.VALIDATE("Variant Code",TempServLine."Variant Code");
              if TempServLine.Quantity <> 0 then
                ServLine.VALIDATE(Quantity,TempServLine.Quantity);
            end;
          end;

          ServLine."Serv. Price Adjmt. Gr. Code" := TempServLine."Serv. Price Adjmt. Gr. Code";
          ServLine."Document No." := TempServLine."Document No.";
          ServLine."Service Item No." := TempServLine."Service Item No.";
          ServLine."Appl.-to Service Entry" := TempServLine."Appl.-to Service Entry";
          ServLine."Service Item Line No." := TempServLine."Service Item Line No.";
          ServLine.VALIDATE(Description,TempServLine.Description);
          ServLine.VALIDATE("Description 2",TempServLine."Description 2");

          if TempServLine."No." <> '' then begin
            TempLinkToServItem := "Link Service to Service Item";
            if "Link Service to Service Item" then begin
              "Link Service to Service Item" := false;
              MODIFY(true);
            end;
            ServLine."Spare Part Action" := TempServLine."Spare Part Action";
            ServLine."Component Line No." := TempServLine."Component Line No.";
            ServLine."Replaced Item No." := TempServLine."Replaced Item No.";
            ServLine.VALIDATE("Work Type Code",TempServLine."Work Type Code");

            ServLine."Location Code" := TempServLine."Location Code";
            if ServLine.Type <> ServLine.Type::" " then begin
              if ServLine.Type = ServLine.Type::Item then begin
                ServLine.VALIDATE("Variant Code",TempServLine."Variant Code");
                if ServLine."Location Code" <> '' then
                  ServLine."Bin Code" := TempServLine."Bin Code";
              end;
              ServLine."Fault Reason Code" := TempServLine."Fault Reason Code";
              ServLine."Exclude Warranty" := TempServLine."Exclude Warranty";
              ServLine."Exclude Contract Discount" := TempServLine."Exclude Contract Discount";
              ServLine.VALIDATE("Contract No.",TempServLine."Contract No.");
              ServLine.VALIDATE(Warranty,TempServLine.Warranty);
            end;
            ServLine."Fault Area Code" := TempServLine."Fault Area Code";
            ServLine."Symptom Code" := TempServLine."Symptom Code";
            ServLine."Resolution Code" := TempServLine."Resolution Code";
            ServLine."Fault Code" := TempServLine."Fault Code";
          end;
          "Link Service to Service Item" := TempLinkToServItem;

          ServLine.INSERT;
          ExtendedTextAdded := false;
        end else
          if not ExtendedTextAdded then begin
            TransferExtendedText.ServCheckIfAnyExtText(ServLine,true);
            TransferExtendedText.InsertServExtText(ServLine);
            ServLine.FIND('+');
            ExtendedTextAdded := true;
          end;
        CopyReservEntryFromTemp(TempServLine,ServLine."Line No.");
      until TempServLine.NEXT = 0;
    END;

    [External]
    PROCEDURE SetCustomerFromFilter@186();
    VAR
      CustomerNo@1000 : Code[20];
    BEGIN
      CustomerNo := GetFilterCustNo;
      if CustomerNo = '' then begin
        FILTERGROUP(2);
        CustomerNo := GetFilterCustNo;
        FILTERGROUP(0);
      end;
      if CustomerNo <> '' then
        VALIDATE("Customer No.",CustomerNo);
    END;

    LOCAL PROCEDURE GetFilterCustNo@64() : Code[20];
    BEGIN
      if GETFILTER("Customer No.") <> '' then
        if GETRANGEMIN("Customer No.") = GETRANGEMAX("Customer No.") then
          exit(GETRANGEMAX("Customer No."));
    END;

    LOCAL PROCEDURE UpdateShipToAddressFromGeneralAddress@53(FieldNumber@1000 : Integer);
    BEGIN
      if ("Ship-to Code" = '') and (not ShipToAddressModified) then
        case FieldNumber of
          FIELDNO("Ship-to Address"):
            if xRec.Address = "Ship-to Address" then
              "Ship-to Address" := Address;
          FIELDNO("Ship-to Address 2"):
            if xRec."Address 2" = "Ship-to Address 2" then
              "Ship-to Address 2" := "Address 2";
          FIELDNO("Ship-to City"), FIELDNO("Ship-to Post Code"):
            begin
              if xRec.City = "Ship-to City" then
                "Ship-to City" := City;
              if xRec."Post Code" = "Ship-to Post Code" then
                "Ship-to Post Code" := "Post Code";
              if xRec.County = "Ship-to County" then
                "Ship-to County" := County;
              if xRec."Country/Region Code" = "Ship-to Country/Region Code" then
                "Ship-to Country/Region Code" := "Country/Region Code";
            end;
          FIELDNO("Ship-to County"):
            if xRec.County = "Ship-to County" then
              "Ship-to County" := County;
          FIELDNO("Ship-to Country/Region Code"):
            if  xRec."Country/Region Code" = "Ship-to Country/Region Code" then
              "Ship-to Country/Region Code" := "Country/Region Code";
        end;
    END;

    [External]
    PROCEDURE CopyCustomerFilter@51();
    VAR
      CustomerFilter@1000 : Text;
    BEGIN
      CustomerFilter := GETFILTER("Customer No.");
      if CustomerFilter <> '' then begin
        FILTERGROUP(2);
        SETFILTER("Customer No.",CustomerFilter);
        FILTERGROUP(0)
      end;
    END;

    LOCAL PROCEDURE ShipToAddressModified@55() : Boolean;
    BEGIN
      if (xRec.Address <> "Ship-to Address") or
         (xRec."Address 2" <> "Ship-to Address 2") or
         (xRec.City <> "Ship-to City") or
         (xRec.County <> "Ship-to County") or
         (xRec."Post Code" <> "Ship-to Post Code") or
         (xRec."Country/Region Code" <> "Ship-to Country/Region Code")
      then
        exit(true);
      exit(false);
    END;

    [External]
    PROCEDURE ConfirmCloseUnposted@98() : Boolean;
    VAR
      InstructionMgt@1000 : Codeunit "Instruction Mgt.";
    BEGIN
      if ServLineExists or ServItemLineExists then
        exit(InstructionMgt.ShowConfirm(DocumentNotPostedClosePageQst,InstructionMgt.QueryPostOnCloseCode));
      exit(true)
    END;

    LOCAL PROCEDURE SetDefaultSalesperson@18();
    VAR
      UserSetup@1000 : Record "User Setup";
    BEGIN
      if not UserSetup.GET(USERID) then
        exit;

      if UserSetup."Salespers./Purch. Code" <> '' then
        VALIDATE("Salesperson Code",UserSetup."Salespers./Purch. Code");
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterInitRecord@34(VAR ServiceHeader@1000 : Record "Service Header");
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterUpdateShipToAddress@137(VAR ServiceHeader@1000 : Record "Service Header");
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnUpdateServLineByChangedFieldName@139(ServiceHeader@1000 : Record "Service Header";VAR ServiceLine@1001 : Record "Service Line";ChangedFieldName@1002 : Text[100]);
    BEGIN
    END;

    [Integration]
    LOCAL PROCEDURE OnAfterCreateDimTableIDs@138(VAR ServiceHeader@1000 : Record "Service Header";FieldNo@1001 : Integer;TableID@1003 : ARRAY [10] OF Integer;No@1002 : ARRAY [10] OF Code[20]);
    BEGIN
    END;

    BEGIN
    END.
  }
}

