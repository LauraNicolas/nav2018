OBJECT Codeunit 2800 Native - Setup APIs
{
  OBJECT-PROPERTIES
  {
    Date=06.10.17;
    Time=12:00:00;
    Version List=NAVW111.0;
  }
  PROPERTIES
  {
    OnRun=BEGIN
            IF NOT GUIALLOWED THEN
              EXIT;

            // SetupApis;
            InsertTenantWebServices;
            COMMIT;
          END;

  }
  CODE
  {
    VAR
      ApiPrefixTxt@1000 : TextConst '@@@={Locked};ENU=nativeInvoicing';

    [EventSubscriber(Codeunit,5465,ApiSetup)]
    PROCEDURE SetupApis@1();
    VAR
      NativeEDMTypes@1000 : Codeunit 2801;
    BEGIN
      NativeEDMTypes.UpdateEDMTypes;
    END;

    PROCEDURE InsertTenantWebServices@2();
    BEGIN
      InsertOrUpdateTenantWebService(PAGE::"Native - KPIs Entity",ApiPrefixTxt + 'KPIs');
      InsertOrUpdateTenantWebService(PAGE::"Native - Customer Entity",ApiPrefixTxt + 'Customers');
      InsertOrUpdateTenantWebService(PAGE::"Native - Item Entity",ApiPrefixTxt + 'Items');
      InsertOrUpdateTenantWebService(PAGE::"Native - Sales Inv. Entity",ApiPrefixTxt + 'SalesInvoices');
      InsertOrUpdateTenantWebService(PAGE::"Native - Sales Quotes",ApiPrefixTxt + 'SalesQuotes');
      InsertOrUpdateTenantWebService(PAGE::"Native - Tax Area",ApiPrefixTxt + 'TaxAreas');
      InsertOrUpdateTenantWebService(PAGE::"Native - Tax Group Entity",ApiPrefixTxt + 'TaxGroups');
      InsertOrUpdateTenantWebService(PAGE::"Native - Units of Measure",ApiPrefixTxt + 'UnitsOfMeasure');
      InsertOrUpdateTenantWebService(PAGE::"Native - Payment Terms",ApiPrefixTxt + 'PaymentTerms');
      InsertOrUpdateTenantWebService(PAGE::"Native - Payment Methods",ApiPrefixTxt + 'PaymentMethods');
      InsertOrUpdateTenantWebService(PAGE::"Native - Attachments",ApiPrefixTxt + 'Attachments');
      InsertOrUpdateTenantWebService(PAGE::"Native - General Setting",ApiPrefixTxt + 'GeneralSettings');
      InsertOrUpdateTenantWebService(PAGE::"Native - SMTP Mail Setup",ApiPrefixTxt + 'SMTPMailSetup');
      InsertOrUpdateTenantWebService(PAGE::"Native - Email Setting",ApiPrefixTxt + 'EmailSetting');
      InsertOrUpdateTenantWebService(PAGE::"Native Country/Regions Entity",ApiPrefixTxt + 'CountryRegion');
      InsertOrUpdateTenantWebService(PAGE::"Native - PDFs",ApiPrefixTxt + 'PDFs');
      InsertOrUpdateTenantWebService(PAGE::"Native - Email Preview",ApiPrefixTxt + 'EmailPreview');
      InsertOrUpdateTenantWebService(PAGE::"Native - Export Invoices",ApiPrefixTxt + 'ExportInvoices');
      InsertOrUpdateTenantWebService(PAGE::"Native - Test Mail",ApiPrefixTxt + 'TestMail');
      InsertOrUpdateTenantWebService(PAGE::"Native - Sales Tax Setup",ApiPrefixTxt + 'SalesTaxSetup');
      InsertOrUpdateTenantWebService(PAGE::"Native - VAT Setup",ApiPrefixTxt + 'VATSetup');
      InsertOrUpdateTenantWebService(PAGE::"Native - Languages",ApiPrefixTxt + 'Languages');
    END;

    LOCAL PROCEDURE InsertOrUpdateTenantWebService@6(PageNumber@1000 : Integer;ServiceName@1002 : Text);
    VAR
      TenantWebService@1001 : Record 2000000168;
    BEGIN
      IF TenantWebService.GET(TenantWebService."Object Type"::Page,ServiceName) THEN BEGIN
        TenantWebService.Published := TRUE;
        TenantWebService."Object ID" := PageNumber;
        TenantWebService.MODIFY(TRUE);
        EXIT;
      END;

      TenantWebService."Object Type" := TenantWebService."Object Type"::Page;
      TenantWebService."Service Name" := COPYSTR(ServiceName,1,MAXSTRLEN(TenantWebService."Service Name"));
      TenantWebService."Object ID" := PageNumber;
      TenantWebService.Published := TRUE;
      TenantWebService.INSERT(TRUE);
    END;

    PROCEDURE CreatePaymentRegistrationSetup@16();
    VAR
      PaymentRegistrationSetup@1000 : Record 980;
    BEGIN
      WITH PaymentRegistrationSetup DO BEGIN
        IF GET(USERID) THEN
          EXIT;
        IF GET THEN BEGIN
          "User ID" := USERID;
          INSERT(TRUE);
          COMMIT;
          EXIT;
        END;
        CODEUNIT.RUN(CODEUNIT::"O365 Sales Initial Setup");
        COMMIT;
      END;
    END;

    PROCEDURE GetAPIPrefix@3() : Text;
    BEGIN
      EXIT(ApiPrefixTxt);
    END;

    BEGIN
    END.
  }
}

