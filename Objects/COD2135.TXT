OBJECT Codeunit 2135 O365 Setup Email
{
  OBJECT-PROPERTIES
  {
    Date=28.05.17;
    Time=12:00:00;
    Version List=NAVW110.0;
  }
  PROPERTIES
  {
    OnRun=BEGIN
            SetupEmail;
          END;

  }
  CODE
  {
    VAR
      MailNotConfiguredErr@1000 : TextConst 'ENU=An email account must be configured to send emails.';

    [External]
    PROCEDURE SetupEmail@15();
    BEGIN
      IF NOT SMTPEmailIsSetUp THEN BEGIN
        IF CURRENTCLIENTTYPE = CLIENTTYPE::Tablet THEN BEGIN
          IF PAGE.RUNMODAL(PAGE::"BC O365 Email Setup Wizard") = ACTION::LookupOK THEN;
        END ELSE
          PAGE.RUNMODAL(PAGE::"O365 Email Setup Wizard");
        IF NOT SMTPEmailIsSetUp THEN
          ERROR(MailNotConfiguredErr);
      END;
    END;

    PROCEDURE SMTPEmailIsSetUp@1() : Boolean;
    VAR
      SMTPMailSetup@1001 : Record 409;
      MailManagement@1002 : Codeunit 9520;
    BEGIN
      IF NOT MailManagement.IsSMTPEnabled THEN
        EXIT(FALSE);

      IF SMTPMailSetup.FIND THEN
        EXIT((SMTPMailSetup."User ID" <> '') AND (NOT ISNULLGUID(SMTPMailSetup."Password Key")));
    END;

    BEGIN
    END.
  }
}

